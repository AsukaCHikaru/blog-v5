{"pageProps":{"postContent":[{"type":"heading","children":[{"type":"plain","text":"TL;DR:"}],"depth":1},{"type":"list","ordered":false,"children":[{"type":"listItem","children":[{"type":"inlineCode","text":"fs.stat"},{"type":"plain","text":"\nfor getting file size"}]},{"type":"listItem","children":[{"type":"inlineCode","text":"readline.clearLine"}]},{"type":"listItem","children":[{"type":"inlineCode","text":"readline.cursorTo(0)"}]},{"type":"listItem","children":[{"type":"inlineCode","text":"process.stdout.write"}]}]},{"type":"paragraph","children":[{"type":"plain","text":"Combine these 3 to update command line instead of printing new line"}]},{"type":"heading","children":[{"type":"plain","text":"Get file size"}],"depth":1},{"type":"paragraph","children":[{"type":"inlineCode","text":"fs.stat"},{"type":"plain","text":" returns an object contains several stats of the file from url you're downloading."}]},{"type":"paragraph","children":[{"type":"link","text":"Detailed explanation of fs.stat","url":"https://nodejs.org/api/fs.html#fs_class_fs_stats"},{"type":"plain","text":"."}]},{"type":"paragraph","children":[{"type":"plain","text":"Inside of the object, there is "},{"type":"inlineCode","text":"size"},{"type":"plain","text":" property, which is obviously the size of file, in bytes."}]},{"type":"code","lang":"js","text":"let fileSize = 0;\nfs.stat('url/to/your/file', (stats)=>{\n\tfileSize = stats.size;\n});"},{"type":"heading","children":[{"type":"plain","text":"Get current progression"}],"depth":1},{"type":"paragraph","children":[{"type":"plain","text":"In the response from "},{"type":"inlineCode","text":"https.get"},{"type":"plain","text":" when downloading, track and add up the total length of chunks piped into "},{"type":"inlineCode","text":"fs.writeStream"},{"type":"plain","text":". This total length devided by file size is the download progression we need."}]},{"type":"heading","children":[{"type":"plain","text":"Write to terminal, but in same line"}],"depth":1},{"type":"paragraph","children":[{"type":"inlineCode","text":"console.log"},{"type":"plain","text":" "},{"type":"link","text":"implementation","url":"https://nodejs.org/docs/v0.3.1/api/process.html#process.stdout"},{"type":"plain","text":" in Node is actually based on "},{"type":"inlineCode","text":"process.stdout.write"},{"type":"plain","text":". But since there's a "},{"type":"inlineCode","text":"\\\\n"},{"type":"plain","text":" at end of every "},{"type":"inlineCode","text":"console.log"},{"type":"plain","text":", new line is printed everytime instead of being updated. Therefore we can't use "},{"type":"inlineCode","text":"console.log"}]},{"type":"paragraph","children":[{"type":"plain","text":"By combine "},{"type":"inlineCode","text":"readline.clearLine"},{"type":"plain","text":" and "},{"type":"inlineCode","text":"readline.cursorTo(0)"},{"type":"plain","text":", terminal will erase the last line of currently printed line, then move cursor to the starting position. Then we can use "},{"type":"inlineCode","text":"process.stdout.write"},{"type":"plain","text":" to print out current progress without "},{"type":"inlineCode","text":"\\\\n"},{"type":"plain","text":" in "},{"type":"inlineCode","text":"console.log"},{"type":"plain","text":" implementation that causes changing line."}]},{"type":"code","lang":"js","text":"let progress = 0;\nlet req = https.get('url/to/your/file', (res, err)=>{\n\tres.on('data', (chunk)=>{\n\t\tprogress += chunk.length;\n\t\tconst dlPercentage = ((progress/fileSize)*100).toFixed(2);\n\t\treadline.clearLine(); readline.cursorTo(0);\n\t\tprocess.stdout.write(`Downloading... ${dlPercentage}%`);\n\t});\n});"}],"postMetadata":{"id":"download-progress-tool-in-terminal-using-nodejs","title":"Download Progress Tool in Terminal Using Node.JS","description":"","category":"Programming","tags":[],"publishDate":"2019-06-07","pathname":"download-progress-tool-in-terminal-using-nodejs"},"last5posts":[{"id":"site-patch-notes-2024-redesign","title":"Site Patch Notes: 2024 Redesign","description":"The 2024 redesign is finally here! I went on a journey of learning editorial design, and did an overhaul to this site's design, both functionality-wise and visual-wise.","category":"Meta","tags":[],"publishDate":"2024-08-18","pathname":"site-patch-notes-2024-redesign"},{"id":"a-peek-of-the-world","title":"A Peek of the World","description":"I went to Copenhagen and London for my honeymoon, the first trip to Europe in my life. Some memories keep staying on my mind and I have many thoughts about them.","category":"Life","tags":[],"publishDate":"2024-06-16","pathname":"a-peek-of-the-world"},{"id":"godot-essentials","title":"Godot Essentials","description":"The biggest lessons I learned in my first Godot project.","category":"Game Development","tags":[],"publishDate":"2024-04-21","pathname":"godot-essentials"},{"id":"4-years-reflection","title":"4 Years Reflection","description":"Another two years of life as a full-time developer has passed. Many things changed and many lessons learned. It's a perfect timing to look back and reflect.","category":"Life","tags":[],"publishDate":"2024-04-08","pathname":"4-years-reflection"},{"id":"improving-greatness","title":"Improving Greatness","description":"Breath of the Wild is one of the most impactful game in last decade. Yet for its successor, Nintendo built an even more polished version on an already magnificent fundamental.","category":"Gaming","tags":[],"publishDate":"2024-03-17","pathname":"improving-greatness"}],"categoryPosts":[],"categories":[{"name":"Meta","count":5},{"name":"Life","count":6},{"name":"Game Development","count":5},{"name":"Gaming","count":12},{"name":"League of Legends","count":8},{"name":"Web Development","count":4},{"name":"HKT48","count":4},{"name":"Programming","count":3},{"name":"Movie","count":2}]},"__N_SSG":true}