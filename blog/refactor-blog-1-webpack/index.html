<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>Refactor Blog: (1) Webpack | Asuka Wang</title><meta name="description" content="Asuka Wang&#x27;s blog"/><meta property="og:title" content="Refactor Blog: (1) Webpack | Asuka Wang"/><meta property="twitter:title" content="Refactor Blog: (1) Webpack | Asuka Wang"/><meta name="next-head-count" content="6"/><link rel="preconnect" href="/" crossorigin="anonymous"/><script id="theme-document" data-nscript="beforeInteractive">
        if (typeof window !== "undefined") {
          const savedTheme = localStorage.getItem("ASUKACHIKARU_THEME");
          const html = document.documentElement;
          const systemTheme = window.matchMedia('(prefers-color-scheme: dark)').matches
            ? 'DARK'
            : 'LIGHT';
          if (savedTheme === "DARK" || systemTheme === "DARK") {
            html.classList.add('dark');
            html.style.backgroundColor = "#27211F";
          } else {
            html.classList.remove('dark');
            html.style.backgroundColor = "#F5F2E8";
          }
        }
      </script><link rel="preload" href="/_next/static/css/411e8f07e13c70fa.css" as="style"/><link rel="stylesheet" href="/_next/static/css/411e8f07e13c70fa.css" data-n-g=""/><link rel="preload" href="/_next/static/css/d8403707d10b0477.css" as="style"/><link rel="stylesheet" href="/_next/static/css/d8403707d10b0477.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-b8f8d6679aaa5f42.js" defer=""></script><script src="/_next/static/chunks/framework-114634acb84f8baa.js" defer=""></script><script src="/_next/static/chunks/main-f2ca60db2beb93ed.js" defer=""></script><script src="/_next/static/chunks/pages/_app-ba071d4eaf9a2c50.js" defer=""></script><script src="/_next/static/chunks/542-7be5b5539309fe0b.js" defer=""></script><script src="/_next/static/chunks/986-347b45c0cb7e6276.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5Bpathname%5D-25a78fdd03cb7e80.js" defer=""></script><script src="/_next/static/Ct-zOyv_Ohd6ncbBqnMnN/_buildManifest.js" defer=""></script><script src="/_next/static/Ct-zOyv_Ohd6ncbBqnMnN/_ssgManifest.js" defer=""></script></head><body><div id="__next"><main class="
        __variable_e0546c
        __variable_9d551b
        __variable_ef4fb7
        __variable_23fcf6
        __variable_6fb08b
        __variable_4de8ae
        font-serif"><div class="text-color"><div class="mx-fb2 lg:mx-auto max-w-[1280px]"><div class="mt-fb1 lg:mt-fb2"><div class="flex justify-end"><button class="font-noto-sans text-fb2 interactive-color">dark mode</button></div><div class="flex justify-between w-full mt-fb8 mb-fb2"><div class="w-fit flex flex-col lg:flex-row gap-fb1 lg:gap-fb3"><a class="text-fb2 lg:text-fb3 leading-fb3 lg:leading-fb5 interactive-color text-color" href="/blog/">BLOG</a><a class="text-fb2 lg:text-fb3 leading-fb3 lg:leading-fb5 interactive-color " href="/about/">ABOUT</a></div><a class="text-fb3 lg:text-fb5 leading-none font-abhaya-libre font-bold" href="/">ASUKA WANG</a></div><div class="mb-fb2 lg:mb-fb3 border-t-2 border-b h-2 border-color-100"></div></div><div><div class="flex flex-col gap-fb1 mb-fb5 lg:mb-fb8"><h1 class="text-fb8 lg:text-fb13 font-abril leading-none">REFACTOR BLOG: (1) WEBPACK</h1><div class="text-fb2 lg:text-fb3 font-noto-sans">March 9, 2021</div></div><div class="w-full grid grid-cols-4 gap-fb3"><div class="col-span-4 lg:col-span-3"><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><span>Recently, I rewrote my </span><a href="https://asukachikaru.com/blog" class="text-blue-400 underline" rel="noreferrer noopener" target="_blank">blog</a><span> for the second time. Every time, I rewrite to solve particular problems.</span></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><span>The previous version&#x27;s problems are the architecture: I used </span><a href="https://www.gatsbyjs.com/" class="text-blue-400 underline" rel="noreferrer noopener" target="_blank">Gatsby</a><span> for v2, and I didn&#x27;t enjoy it. There are many plugins that I don&#x27;t fully understand, and they handle a lot of things. I don&#x27;t know what&#x27;s under the hood of my blog while building it.</span></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><span>I wanted more control over my project.</span></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><span>That&#x27;s why after I felt I had grasped enough knowledge to start a project from scratch, I started the rewrite straightaway. This time -- for the first time -- I&#x27;m not using </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">npx create-react-app</code><span> or </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">gatsby new</code><span>. I&#x27;m writing every line of the configs by myself.</span></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><span>If you&#x27;ve struggled with all those config setups, ex. </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">webpack.config.js</code><span>, </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">babelrc</code><span>, </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">tsconfig.json</code><span> -- I know the feeling. I used to be afraid of dealing with them, but not anymore. I hope this article helps others to achieve that too.</span></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><h2 class="mt-8 text-2xl lg:text-4xl font-semibold" id="Dependencies"><span>Dependencies</span></h2></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><span>I used React and Typescript for this project. The minimum dependencies for this architecture are:</span></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><ul class="list-disc list-inside mx-8"><li><span>webpack, webpack-cli, @babel/core</span></li><li><span>babel-loader, @babel/preset-react</span></li><li><span>ts-loader, @babel/preset-typescript</span></li><li><span>babel-plugin-styled-components</span></li><li><span>@babel/preset-env, @babel/plugin-proposal-class-propoties, @babel/plugin-proposal-object-rest-spread, webpack-node-externals</span></li><li><span>all the @types</span></li></ul></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><h2 class="mt-8 text-2xl lg:text-4xl font-semibold" id=".babelrc"><span>.babelrc</span></h2></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><span>Some of the syntaxes or features that React development needs are not supported by all browsers yet. To ensure the project works in all environments, the source code needs to be compiled into a backward-compatible version. That&#x27;s what babel does.</span></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><pre class="my-6 border rounded-md text-base leading-4"><code class="font-courier language-json rounded-md">{
	&quot;presets&quot;: [
		&quot;@babel/preset-react&quot;,
		// tell babel it has to compile React
		&quot;@babel/preset-typescript&quot;
		// tell babel it has to compile Typescript
	],
	&quot;plugins&quot;: [
		&quot;@babel/proposal-class-properties&quot;,
		&quot;@babel/proposal-object-rest-spread&quot;,
		// enables above features of JavaScript in development
		&quot;babel-plugin-styled-components&quot;
		// I used styled-components in this project, this is the plugin to help babel process it
	]
}</code></pre></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><h2 class="mt-8 text-2xl lg:text-4xl font-semibold" id="tsconfig.json"><span>tsconfig.json</span></h2></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><span>The configurations for typescript.</span></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><pre class="my-6 border rounded-md text-base leading-4"><code class="font-courier language-json rounded-md">{
  &quot;compilerOptions&quot;: {
    &quot;target&quot;: &quot;ES5&quot;,
    &quot;module&quot;: &quot;CommonJS&quot;,
    &quot;lib&quot;: [&quot;DOM&quot;, &quot;ES2020&quot;],
    &quot;strict&quot;: true,
    &quot;noImplicitAny&quot;: true,
    &quot;moduleResolution&quot;: &quot;Node&quot;,
    &quot;jsx&quot;: &quot;react&quot;
  },
  &quot;include&quot;: [&quot;src&quot;],
  &quot;exclude&quot;: [&quot;node_modules&quot;]
}</code></pre></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><h3 class="mt-8 text-xl lg:text-3xl font-semibold" id="includes"><span>includes</span></h3></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><span>Define the paths with </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">.ts</code><span> files that need to be compiled.</span></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><h3 class="mt-8 text-xl lg:text-3xl font-semibold" id="excludes"><span>excludes</span></h3></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><span>The opposite of </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">includes</code><span>, define the paths that do NOT need compiling.</span></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><h3 class="mt-8 text-xl lg:text-3xl font-semibold" id="compilerOptions"><span>compilerOptions</span></h3></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><span>Most of the typescript compiling options</span></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><h4 class="mt-8 text-lg lg:text-2xl font-semibold" id="target"><span>target</span></h4></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><span>The js (ECMA) version of the output. Use </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">ES5</code><span> or a newer version without worrying about compatibility issues because babel will compile again.</span></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><h4 class="mt-8 text-lg lg:text-2xl font-semibold" id="module"><span>module</span></h4></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><span>Which pattern to use regarding modules (export). Use </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">commonJS</code><span> for applications running on node.</span></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><h4 class="mt-8 text-lg lg:text-2xl font-semibold" id="lib"><span>lib</span></h4></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><span>Other libraries to be used in compilation. Add </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">DOM</code><span> if features like </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">document</code><span> or </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">window</code><span> are used.</span></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><h4 class="mt-8 text-lg lg:text-2xl font-semibold" id="moduleResolution"><span>moduleResolution</span></h4></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><span>How ts compilation deals with modules (import). Use </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">node</code><span> to mock node&#x27;s way to resolve module importing.</span></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><h4 class="mt-8 text-lg lg:text-2xl font-semibold" id="jsx"><span>jsx</span></h4></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><span>How to deal with </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">.jsx</code><span> files. Since we&#x27;re developing React app, use </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">react</code><span>.</span></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><h2 class="mt-8 text-2xl lg:text-4xl font-semibold" id="webpack.client.config.ts"><span>webpack.client.config.ts</span></h2></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><span>I split the webpack configs for the front-end and the SSR server for clarity. Also, I write both my webpack config files in typescript instead of javascript, but it&#x27;s totally optional. I only did so because I wanted to try. Choose the one you&#x27;re more comfortable with.</span></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><pre class="my-6 border rounded-md text-base leading-4"><code class="font-courier language-ts rounded-md">import * as webpack from &quot;webpack&quot;;
import { resolve } from &quot;path&quot;;

const config: webpack.Configuration = {
  mode: &quot;development&quot;,
  entry: &quot;./src/client/index.tsx&quot;,
  context: resolve(__dirname),
  output: {
    filename: &quot;[name].bundle.js&quot;,
    path: resolve(__dirname, &quot;dist&quot;, &quot;static&quot;),
  },
  module: {
    rules: [
      {
        test: /\\.tsx?$/,
        exclude: /node_modules/,
        use: [
          {
            loader: &quot;babel-loader&quot;,
          },
          {
            loader: &quot;ts-loader&quot;,
            options: {
              configFile: &quot;tsconfig.json&quot;,
            },
          },
        ],
      },
    ],
  },
  optimization: {
    minimize: true,
    splitChunks: {
      cacheGroups: {
        commons: {
          test: /node_modules/,
          name: &quot;vendor&quot;,
          chunks: &quot;initial&quot;,
        },
      },
    },
  },
  resolve: {
    extensions: [&quot;.ts&quot;, &quot;.tsx&quot;, &quot;.js&quot;, &quot;.json&quot;],
  },
  plugins: [
    new webpack.DefinePlugin({
      &quot;process.env&quot;: {
        CONTENTFUL_TOKEN: JSON.stringify(process.env.CONTENTFUL_TOKEN || &quot;&quot;),
        CONTENTFUL_SPACE_ID: JSON.stringify(
          process.env.CONTENTFUL_SPACE_ID || &quot;&quot;
        ),
      },
    }),
  ],
  devtool: &quot;inline-source-map&quot;,
};

export default config;</code></pre></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><h3 class="mt-8 text-xl lg:text-3xl font-semibold" id="mode"><span>mode</span></h3></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><span>Mostly changes the value of </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">process.env.NODE_ENV</code><span> on </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">DefinePlugin</code><span>. This can be set in command line parameter </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">--mode</code><span> too. I set this to </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">develop</code><span> and add </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">--mode production</code><span> in scripts for production building.</span></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><h3 class="mt-8 text-xl lg:text-3xl font-semibold" id="entry"><span>entry</span></h3></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><span>The starting point of the project; the root file for every other file imported or used. Likely the </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">index.js</code><span> in </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">src</code><span> folder for MVVM frameworks.</span></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><span>There might be multiple entry files in an optimized setup. I plan to do it in the future.</span></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><h3 class="mt-8 text-xl lg:text-3xl font-semibold" id="context"><span>context</span></h3></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><span>The reference directory for the path of entry and loaders. The default value is the webpack config file&#x27;s location, so it shouldn&#x27;t be a big problem without it. However, it&#x27;s still recommended to set context, so the configuration is independent of its location when dealing with paths.</span></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><h3 class="mt-8 text-xl lg:text-3xl font-semibold" id="output"><span>output</span></h3></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><span>The building result. This can be very optimized and complex, but I&#x27;m only using the minimum configuration here: </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">filename</code><span> for, well, the output filename, and </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">path</code><span> for the output folder path.</span></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><h3 class="mt-8 text-xl lg:text-3xl font-semibold" id="module"><span>module</span></h3></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><span>Options for specifying where (target files)and how (which tool)to build the source codes. One of the most important parts of webpack configuration.</span></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><h4 class="mt-8 text-lg lg:text-2xl font-semibold" id="test"><span>test</span></h4></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><span>The paths of target files, using regular expressions.</span></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><h4 class="mt-8 text-lg lg:text-2xl font-semibold" id="use"><span>use</span></h4></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><span>The loaders for building. At default, webpack can only parse </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">.js</code><span> and </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">.json</code><span> files, so we need to add custom loaders for packaging other types of files.</span></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><span>Pass an array to use multiple loaders for the same target. The loaders&#x27; applying order depends on their order in the array: from last to first (from right to left/ from bottom to top).</span></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><span>For packaging </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">.ts</code><span> files, you can add </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">configFile</code><span> in </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">use</code><span> to specifying the typescript config you want to use.</span></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><h4 class="mt-8 text-lg lg:text-2xl font-semibold" id="exclude"><span>exclude</span></h4></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><span>The opposite of </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">test</code><span>, specifying the file you wish not to package, like node modules.</span></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><h3 class="mt-8 text-xl lg:text-3xl font-semibold" id="resolve"><span>resolve</span></h3></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><span>The configurations for the modules.</span></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><h4 class="mt-8 text-lg lg:text-2xl font-semibold" id="extensions"><span>extensions</span></h4></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><span>The extensions for the files of the modules. Add the extensions that cover all of the files of the modules. Without this option, webpack may be unable to read some modules.</span></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><h3 class="mt-8 text-xl lg:text-3xl font-semibold" id="plugins"><span>plugins</span></h3></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><span>Miscellaneous tools to customize the build. I&#x27;m only adding </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">DefinePlugin</code><span> to define the environment variables in this configuration.</span></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><h3 class="mt-8 text-xl lg:text-3xl font-semibold" id="devtool"><span>devtool</span></h3></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><span>Build output is suppressed and sometimes uglified. It protects the source code, but it may make debugging more difficult too.</span></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">devtool</code><span> generates a map between the output and the source, so the console logs can display which line of the source code is causing the error.</span></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><h2 class="mt-8 text-2xl lg:text-4xl font-semibold" id="webpack.server.config.ts"><span>webpack.server.config.ts</span></h2></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><span>The webpack configurations for SSR server code. The idea is the same as the client part, but there are some differences too.</span></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><pre class="my-6 border rounded-md text-base leading-4"><code class="font-courier language-ts rounded-md">import * as webpack from &quot;webpack&quot;;
import { resolve } from &quot;path&quot;;
import * as nodeExternals from &quot;webpack-node-externals&quot;;

const config: webpack.Configuration = {
  mode: &quot;development&quot;,
  entry: &quot;./src/server/index.ts&quot;,
  context: resolve(__dirname),
  output: {
    filename: &quot;server.bundle.js&quot;,
    path: resolve(__dirname, &quot;dist&quot;, &quot;server&quot;),
  },
  target: &quot;node&quot;,
  node: {
    __dirname: false,
    __filename: false,
  },
  module: {
    rules: [
      {
        test: /\\.tsx?$/,
        exclude: /node_modules/,
        use: [&quot;babel-loader&quot;, &quot;ts-loader&quot;],
      },
    ],
  },
  resolve: {
    extensions: [&quot;.ts&quot;, &quot;.tsx&quot;],
  },
  externals: [nodeExternals()],
  plugins: [
    new webpack.DefinePlugin({
      &quot;process.env&quot;: {
        CONTENTFUL_TOKEN: JSON.stringify(process.env.CONTENTFUL_TOKEN || &quot;&quot;),
        CONTENTFUL_SPACE_ID: JSON.stringify(
          process.env.CONTENTFUL_SPACE_ID || &quot;&quot;
        ),
        PORT: JSON.stringify(process.env.PORT) || 3000,
      },
    }),
  ],
};

export default config;</code></pre></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><h3 class="mt-8 text-xl lg:text-3xl font-semibold" id="target"><span>target</span></h3></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><span>The environment that the output is supposed to run on. The default value is </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">web</code><span>, which is the browser-like environment. For the nodejs applications, use </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">node</code><span>.</span></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><h3 class="mt-8 text-xl lg:text-3xl font-semibold" id="externals"><span>externals</span></h3></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><span>Excludes modules that are expected to be provided in the running environment. I use this to exclude node modules.</span></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><h3 class="mt-8 text-xl lg:text-3xl font-semibold" id="node"><span>node</span></h3></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><span>Configurations for the node-related parts in the source. I set </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">__dirname</code><span> and </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">__filename</code><span> so these two&#x27;s behaviors are not changed during building.</span></div></div><div class="flex-col justify-between hidden lg:flex"><div class="flex flex-col gap-fb5"><div><div class="text-fb3 py-fb1 mb-fb3 border-t border-b border-color text-center font-noto-sans font-extralight">TABLE OF CONTENT</div><ul class="ml-fb3 list-outside list-disc interactive-list-color"><li class="mt-fb2"><a class="font-serif text-fb3 leading-none interactive-color" href="/blog/[pathname]/#Dependencies">Dependencies</a></li><li class="mt-fb2"><a class="font-serif text-fb3 leading-none interactive-color" href="/blog/[pathname]/#.babelrc">.babelrc</a></li><li class="mt-fb2"><a class="font-serif text-fb3 leading-none interactive-color" href="/blog/[pathname]/#tsconfig.json">tsconfig.json</a></li><li class="mt-fb2"><div class="w-fb2"></div><a class="font-serif text-fb3 leading-none interactive-color" href="/blog/[pathname]/#includes">includes</a></li><li class="mt-fb2"><div class="w-fb2"></div><a class="font-serif text-fb3 leading-none interactive-color" href="/blog/[pathname]/#excludes">excludes</a></li><li class="mt-fb2"><div class="w-fb2"></div><a class="font-serif text-fb3 leading-none interactive-color" href="/blog/[pathname]/#compilerOptions">compilerOptions</a></li><li class="mt-fb2"><div class="w-fb2"></div><div class="w-fb2"></div><a class="font-serif text-fb3 leading-none interactive-color" href="/blog/[pathname]/#target">target</a></li><li class="mt-fb2"><div class="w-fb2"></div><div class="w-fb2"></div><a class="font-serif text-fb3 leading-none interactive-color" href="/blog/[pathname]/#module">module</a></li><li class="mt-fb2"><div class="w-fb2"></div><div class="w-fb2"></div><a class="font-serif text-fb3 leading-none interactive-color" href="/blog/[pathname]/#lib">lib</a></li><li class="mt-fb2"><div class="w-fb2"></div><div class="w-fb2"></div><a class="font-serif text-fb3 leading-none interactive-color" href="/blog/[pathname]/#moduleResolution">moduleResolution</a></li><li class="mt-fb2"><div class="w-fb2"></div><div class="w-fb2"></div><a class="font-serif text-fb3 leading-none interactive-color" href="/blog/[pathname]/#jsx">jsx</a></li><li class="mt-fb2"><a class="font-serif text-fb3 leading-none interactive-color" href="/blog/[pathname]/#webpack.client.config.ts">webpack.client.config.ts</a></li><li class="mt-fb2"><div class="w-fb2"></div><a class="font-serif text-fb3 leading-none interactive-color" href="/blog/[pathname]/#mode">mode</a></li><li class="mt-fb2"><div class="w-fb2"></div><a class="font-serif text-fb3 leading-none interactive-color" href="/blog/[pathname]/#entry">entry</a></li><li class="mt-fb2"><div class="w-fb2"></div><a class="font-serif text-fb3 leading-none interactive-color" href="/blog/[pathname]/#context">context</a></li><li class="mt-fb2"><div class="w-fb2"></div><a class="font-serif text-fb3 leading-none interactive-color" href="/blog/[pathname]/#output">output</a></li><li class="mt-fb2"><div class="w-fb2"></div><a class="font-serif text-fb3 leading-none interactive-color" href="/blog/[pathname]/#module">module</a></li><li class="mt-fb2"><div class="w-fb2"></div><div class="w-fb2"></div><a class="font-serif text-fb3 leading-none interactive-color" href="/blog/[pathname]/#test">test</a></li><li class="mt-fb2"><div class="w-fb2"></div><div class="w-fb2"></div><a class="font-serif text-fb3 leading-none interactive-color" href="/blog/[pathname]/#use">use</a></li><li class="mt-fb2"><div class="w-fb2"></div><div class="w-fb2"></div><a class="font-serif text-fb3 leading-none interactive-color" href="/blog/[pathname]/#exclude">exclude</a></li><li class="mt-fb2"><div class="w-fb2"></div><a class="font-serif text-fb3 leading-none interactive-color" href="/blog/[pathname]/#resolve">resolve</a></li><li class="mt-fb2"><div class="w-fb2"></div><div class="w-fb2"></div><a class="font-serif text-fb3 leading-none interactive-color" href="/blog/[pathname]/#extensions">extensions</a></li><li class="mt-fb2"><div class="w-fb2"></div><a class="font-serif text-fb3 leading-none interactive-color" href="/blog/[pathname]/#plugins">plugins</a></li><li class="mt-fb2"><div class="w-fb2"></div><a class="font-serif text-fb3 leading-none interactive-color" href="/blog/[pathname]/#devtool">devtool</a></li><li class="mt-fb2"><a class="font-serif text-fb3 leading-none interactive-color" href="/blog/[pathname]/#webpack.server.config.ts">webpack.server.config.ts</a></li><li class="mt-fb2"><div class="w-fb2"></div><a class="font-serif text-fb3 leading-none interactive-color" href="/blog/[pathname]/#target">target</a></li><li class="mt-fb2"><div class="w-fb2"></div><a class="font-serif text-fb3 leading-none interactive-color" href="/blog/[pathname]/#externals">externals</a></li><li class="mt-fb2"><div class="w-fb2"></div><a class="font-serif text-fb3 leading-none interactive-color" href="/blog/[pathname]/#node">node</a></li></ul></div><div><div class="text-fb3 py-fb1 mb-fb3 border-t border-b border-color text-center font-noto-sans font-extralight">ARCHIVE</div><div class="flex flex-col gap-fb3"><a class=" flex flex-col gap-fb1 interactive-color pb-fb2 border-b border-color last-of-type:border-none last-of-type:pb-0 lg:pb-0 lg:border-none " href="/blog/godot-essentials/"><div class="text-fb5 lg:text-fb3 font-abril leading-none text-wrap-balance">Godot Essentials</div><div class="text-fb3 lg:text-fb3 font-gentium-basic leading-none">The biggest lessons I learned in my first Godot project.</div><div class="text-fb2 leading-none font-noto-sans">April 21, 2024</div></a><a class=" flex flex-col gap-fb1 interactive-color pb-fb2 border-b border-color last-of-type:border-none last-of-type:pb-0 lg:pb-0 lg:border-none " href="/blog/4-years-reflection/"><div class="text-fb5 lg:text-fb3 font-abril leading-none text-wrap-balance">4 Years Reflection</div><div class="text-fb3 lg:text-fb3 font-gentium-basic leading-none">Another two years of life as a full-time developer has passed. Many things changed and many lessons learned. It&#x27;s a perfect timing to look back and reflect.</div><div class="text-fb2 leading-none font-noto-sans">April 8, 2024</div></a><a class=" flex flex-col gap-fb1 interactive-color pb-fb2 border-b border-color last-of-type:border-none last-of-type:pb-0 lg:pb-0 lg:border-none " href="/blog/improving-greatness/"><div class="text-fb5 lg:text-fb3 font-abril leading-none text-wrap-balance">Improving Greatness</div><div class="text-fb3 lg:text-fb3 font-gentium-basic leading-none">Breath of the Wild is one of the most impactful game in last decade. Yet for its successor, Nintendo built an even more polished version on an already magnificent fundamental.</div><div class="text-fb2 leading-none font-noto-sans">March 17, 2024</div></a><a class=" flex flex-col gap-fb1 interactive-color pb-fb2 border-b border-color last-of-type:border-none last-of-type:pb-0 lg:pb-0 lg:border-none " href="/blog/s13-recap/"><div class="text-fb5 lg:text-fb3 font-abril leading-none text-wrap-balance">S13 Recap</div><div class="text-fb3 lg:text-fb3 font-gentium-basic leading-none">After a three years gap, I&#x27;m back to league.</div><div class="text-fb2 leading-none font-noto-sans">January 23, 2024</div></a><a class=" flex flex-col gap-fb1 interactive-color pb-fb2 border-b border-color last-of-type:border-none last-of-type:pb-0 lg:pb-0 lg:border-none " href="/blog/refactor-blog-2023-markdown-based-content/"><div class="text-fb5 lg:text-fb3 font-abril leading-none text-wrap-balance">Refactor Blog 2023: Markdown Based Content</div><div class="text-fb3 lg:text-fb3 font-gentium-basic leading-none">Embracing a different approach toward my own data, I made a change to the content hosting method of my blog.</div><div class="text-fb2 leading-none font-noto-sans">June 19, 2023</div></a><div><a class="flex items-end lg:justify-end" href="/blog/archive/"><span class="font-noto-sans text-fb3 leading-none interactive-color">FULL LIST</span></a></div></div></div><div><div class="text-fb3 py-fb1 mb-fb3 border-t border-b border-color text-center font-noto-sans font-extralight">CATEGORY</div><div class="flex flex-col gap-fb2 lg:border-l-2 border-color lg:pl-fb2"><div><a class="flex leading-fb3 items-end interactive-color" href="/blog/archive/?category=Gaming"><span class="text-fb3 font-alegreya">Gaming</span><span class="mx-fb1 flex-grow border-b border-dashed border-color"></span><span class="text-fb3 font-noto-sans">12</span><span class="ml-fb1 text-fb2 font-noto-sans leading-none">POST<!-- -->S</span></a></div><div><a class="flex leading-fb3 items-end interactive-color" href="/blog/archive/?category=League%20of%20Legends"><span class="text-fb3 font-alegreya">League of Legends</span><span class="mx-fb1 flex-grow border-b border-dashed border-color"></span><span class="text-fb3 font-noto-sans">8</span><span class="ml-fb1 text-fb2 font-noto-sans leading-none">POST<!-- -->S</span></a></div><div><a class="flex leading-fb3 items-end interactive-color" href="/blog/archive/?category=Game%20Development"><span class="text-fb3 font-alegreya">Game Development</span><span class="mx-fb1 flex-grow border-b border-dashed border-color"></span><span class="text-fb3 font-noto-sans">5</span><span class="ml-fb1 text-fb2 font-noto-sans leading-none">POST<!-- -->S</span></a></div><div><a class="flex leading-fb3 items-end interactive-color" href="/blog/archive/?category=Life"><span class="text-fb3 font-alegreya">Life</span><span class="mx-fb1 flex-grow border-b border-dashed border-color"></span><span class="text-fb3 font-noto-sans">5</span><span class="ml-fb1 text-fb2 font-noto-sans leading-none">POST<!-- -->S</span></a></div><div><a class="flex leading-fb3 items-end interactive-color" href="/blog/archive/?category=Meta"><span class="text-fb3 font-alegreya">Meta</span><span class="mx-fb1 flex-grow border-b border-dashed border-color"></span><span class="text-fb3 font-noto-sans">4</span><span class="ml-fb1 text-fb2 font-noto-sans leading-none">POST<!-- -->S</span></a></div><div><a class="flex leading-fb3 items-end interactive-color" href="/blog/archive/?category=Web%20Development"><span class="text-fb3 font-alegreya">Web Development</span><span class="mx-fb1 flex-grow border-b border-dashed border-color"></span><span class="text-fb3 font-noto-sans">4</span><span class="ml-fb1 text-fb2 font-noto-sans leading-none">POST<!-- -->S</span></a></div><div><a class="flex leading-fb3 items-end interactive-color" href="/blog/archive/?category=HKT48"><span class="text-fb3 font-alegreya">HKT48</span><span class="mx-fb1 flex-grow border-b border-dashed border-color"></span><span class="text-fb3 font-noto-sans">4</span><span class="ml-fb1 text-fb2 font-noto-sans leading-none">POST<!-- -->S</span></a></div><div><a class="flex leading-fb3 items-end interactive-color" href="/blog/archive/?category=Programming"><span class="text-fb3 font-alegreya">Programming</span><span class="mx-fb1 flex-grow border-b border-dashed border-color"></span><span class="text-fb3 font-noto-sans">3</span><span class="ml-fb1 text-fb2 font-noto-sans leading-none">POST<!-- -->S</span></a></div><div><a class="flex leading-fb3 items-end interactive-color" href="/blog/archive/?category=Movie"><span class="text-fb3 font-alegreya">Movie</span><span class="mx-fb1 flex-grow border-b border-dashed border-color"></span><span class="text-fb3 font-noto-sans">2</span><span class="ml-fb1 text-fb2 font-noto-sans leading-none">POST<!-- -->S</span></a></div></div></div></div><div class="self-end mt-fb5"><button class="font-noto-sans text-fb3 interactive-color">TOP</button></div></div><div class="lg:hidden col-span-4 flex flex-col gap-fb3"><div class="mt-fb5 mb-fb2 border border-color"></div><div class="px-fb2"><div class="flex gap-fb2 mb-fb1"><div class="flex-grow my-auto border-t border-b border-color h-[3px]"></div><div class="font-noto-sans text-fb2 font-thin">ARCHIVE</div><div class="flex-grow my-auto border-t border-b border-color h-[3px]"></div></div><div class="flex flex-col gap-fb3"><a class=" flex flex-col gap-fb1 interactive-color pb-fb2 border-b border-color last-of-type:border-none last-of-type:pb-0 lg:pb-0 lg:border-none " href="/blog/godot-essentials/"><div class="text-fb5 lg:text-fb3 font-abril leading-none text-wrap-balance">Godot Essentials</div><div class="text-fb3 lg:text-fb3 font-gentium-basic leading-none">The biggest lessons I learned in my first Godot project.</div><div class="text-fb2 leading-none font-noto-sans">April 21, 2024</div></a><a class=" flex flex-col gap-fb1 interactive-color pb-fb2 border-b border-color last-of-type:border-none last-of-type:pb-0 lg:pb-0 lg:border-none " href="/blog/4-years-reflection/"><div class="text-fb5 lg:text-fb3 font-abril leading-none text-wrap-balance">4 Years Reflection</div><div class="text-fb3 lg:text-fb3 font-gentium-basic leading-none">Another two years of life as a full-time developer has passed. Many things changed and many lessons learned. It&#x27;s a perfect timing to look back and reflect.</div><div class="text-fb2 leading-none font-noto-sans">April 8, 2024</div></a><a class=" flex flex-col gap-fb1 interactive-color pb-fb2 border-b border-color last-of-type:border-none last-of-type:pb-0 lg:pb-0 lg:border-none " href="/blog/improving-greatness/"><div class="text-fb5 lg:text-fb3 font-abril leading-none text-wrap-balance">Improving Greatness</div><div class="text-fb3 lg:text-fb3 font-gentium-basic leading-none">Breath of the Wild is one of the most impactful game in last decade. Yet for its successor, Nintendo built an even more polished version on an already magnificent fundamental.</div><div class="text-fb2 leading-none font-noto-sans">March 17, 2024</div></a><a class=" flex flex-col gap-fb1 interactive-color pb-fb2 border-b border-color last-of-type:border-none last-of-type:pb-0 lg:pb-0 lg:border-none " href="/blog/s13-recap/"><div class="text-fb5 lg:text-fb3 font-abril leading-none text-wrap-balance">S13 Recap</div><div class="text-fb3 lg:text-fb3 font-gentium-basic leading-none">After a three years gap, I&#x27;m back to league.</div><div class="text-fb2 leading-none font-noto-sans">January 23, 2024</div></a><a class=" flex flex-col gap-fb1 interactive-color pb-fb2 border-b border-color last-of-type:border-none last-of-type:pb-0 lg:pb-0 lg:border-none " href="/blog/refactor-blog-2023-markdown-based-content/"><div class="text-fb5 lg:text-fb3 font-abril leading-none text-wrap-balance">Refactor Blog 2023: Markdown Based Content</div><div class="text-fb3 lg:text-fb3 font-gentium-basic leading-none">Embracing a different approach toward my own data, I made a change to the content hosting method of my blog.</div><div class="text-fb2 leading-none font-noto-sans">June 19, 2023</div></a><div><a class="flex items-end lg:justify-end" href="/blog/archive/"><span class="font-noto-sans text-fb3 leading-none interactive-color">FULL LIST</span></a></div></div></div><div class="px-fb2"><div class="flex gap-fb2 mb-fb1"><div class="flex-grow my-auto border-t border-b border-color h-[3px]"></div><div class="font-noto-sans text-fb2 font-thin">CATEGORY</div><div class="flex-grow my-auto border-t border-b border-color h-[3px]"></div></div><div class="flex flex-col gap-fb2 lg:border-l-2 border-color lg:pl-fb2"><div><a class="flex leading-fb3 items-end interactive-color" href="/blog/archive/?category=Gaming"><span class="text-fb3 font-alegreya">Gaming</span><span class="mx-fb1 flex-grow border-b border-dashed border-color"></span><span class="text-fb3 font-noto-sans">12</span><span class="ml-fb1 text-fb2 font-noto-sans leading-none">POST<!-- -->S</span></a></div><div><a class="flex leading-fb3 items-end interactive-color" href="/blog/archive/?category=League%20of%20Legends"><span class="text-fb3 font-alegreya">League of Legends</span><span class="mx-fb1 flex-grow border-b border-dashed border-color"></span><span class="text-fb3 font-noto-sans">8</span><span class="ml-fb1 text-fb2 font-noto-sans leading-none">POST<!-- -->S</span></a></div><div><a class="flex leading-fb3 items-end interactive-color" href="/blog/archive/?category=Game%20Development"><span class="text-fb3 font-alegreya">Game Development</span><span class="mx-fb1 flex-grow border-b border-dashed border-color"></span><span class="text-fb3 font-noto-sans">5</span><span class="ml-fb1 text-fb2 font-noto-sans leading-none">POST<!-- -->S</span></a></div><div><a class="flex leading-fb3 items-end interactive-color" href="/blog/archive/?category=Life"><span class="text-fb3 font-alegreya">Life</span><span class="mx-fb1 flex-grow border-b border-dashed border-color"></span><span class="text-fb3 font-noto-sans">5</span><span class="ml-fb1 text-fb2 font-noto-sans leading-none">POST<!-- -->S</span></a></div><div><a class="flex leading-fb3 items-end interactive-color" href="/blog/archive/?category=Meta"><span class="text-fb3 font-alegreya">Meta</span><span class="mx-fb1 flex-grow border-b border-dashed border-color"></span><span class="text-fb3 font-noto-sans">4</span><span class="ml-fb1 text-fb2 font-noto-sans leading-none">POST<!-- -->S</span></a></div><div><a class="flex leading-fb3 items-end interactive-color" href="/blog/archive/?category=Web%20Development"><span class="text-fb3 font-alegreya">Web Development</span><span class="mx-fb1 flex-grow border-b border-dashed border-color"></span><span class="text-fb3 font-noto-sans">4</span><span class="ml-fb1 text-fb2 font-noto-sans leading-none">POST<!-- -->S</span></a></div><div><a class="flex leading-fb3 items-end interactive-color" href="/blog/archive/?category=HKT48"><span class="text-fb3 font-alegreya">HKT48</span><span class="mx-fb1 flex-grow border-b border-dashed border-color"></span><span class="text-fb3 font-noto-sans">4</span><span class="ml-fb1 text-fb2 font-noto-sans leading-none">POST<!-- -->S</span></a></div><div><a class="flex leading-fb3 items-end interactive-color" href="/blog/archive/?category=Programming"><span class="text-fb3 font-alegreya">Programming</span><span class="mx-fb1 flex-grow border-b border-dashed border-color"></span><span class="text-fb3 font-noto-sans">3</span><span class="ml-fb1 text-fb2 font-noto-sans leading-none">POST<!-- -->S</span></a></div><div><a class="flex leading-fb3 items-end interactive-color" href="/blog/archive/?category=Movie"><span class="text-fb3 font-alegreya">Movie</span><span class="mx-fb1 flex-grow border-b border-dashed border-color"></span><span class="text-fb3 font-noto-sans">2</span><span class="ml-fb1 text-fb2 font-noto-sans leading-none">POST<!-- -->S</span></a></div></div></div></div></div></div><div class="mt-fb8 pt-fb2 mb-fb8 text-center lg:text-left font-noto-sans interactive-color border-t border-color"><a href="https://asukachikaru.com" rel="noopener noreferrer" target="_blank" class="text-fb2">asukachikaru.com</a> <!-- -->2018-</div></div></div></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postContent":[{"type":"paragraph","children":[{"type":"plain","text":"Recently, I rewrote my "},{"type":"link","text":"blog","url":"https://asukachikaru.com/blog"},{"type":"plain","text":" for the second time. Every time, I rewrite to solve particular problems."}]},{"type":"paragraph","children":[{"type":"plain","text":"The previous version's problems are the architecture: I used "},{"type":"link","text":"Gatsby","url":"https://www.gatsbyjs.com/"},{"type":"plain","text":" for v2, and I didn't enjoy it. There are many plugins that I don't fully understand, and they handle a lot of things. I don't know what's under the hood of my blog while building it."}]},{"type":"paragraph","children":[{"type":"plain","text":"I wanted more control over my project."}]},{"type":"paragraph","children":[{"type":"plain","text":"That's why after I felt I had grasped enough knowledge to start a project from scratch, I started the rewrite straightaway. This time -- for the first time -- I'm not using "},{"type":"inlineCode","text":"npx create-react-app"},{"type":"plain","text":" or "},{"type":"inlineCode","text":"gatsby new"},{"type":"plain","text":". I'm writing every line of the configs by myself."}]},{"type":"paragraph","children":[{"type":"plain","text":"If you've struggled with all those config setups, ex. "},{"type":"inlineCode","text":"webpack.config.js"},{"type":"plain","text":", "},{"type":"inlineCode","text":"babelrc"},{"type":"plain","text":", "},{"type":"inlineCode","text":"tsconfig.json"},{"type":"plain","text":" -- I know the feeling. I used to be afraid of dealing with them, but not anymore. I hope this article helps others to achieve that too."}]},{"type":"heading","children":[{"type":"plain","text":"Dependencies"}],"depth":1},{"type":"paragraph","children":[{"type":"plain","text":"I used React and Typescript for this project. The minimum dependencies for this architecture are:"}]},{"type":"list","ordered":false,"children":[{"type":"listItem","children":[{"type":"plain","text":"webpack, webpack-cli, @babel/core"}]},{"type":"listItem","children":[{"type":"plain","text":"babel-loader, @babel/preset-react"}]},{"type":"listItem","children":[{"type":"plain","text":"ts-loader, @babel/preset-typescript"}]},{"type":"listItem","children":[{"type":"plain","text":"babel-plugin-styled-components"}]},{"type":"listItem","children":[{"type":"plain","text":"@babel/preset-env, @babel/plugin-proposal-class-propoties, @babel/plugin-proposal-object-rest-spread, webpack-node-externals"}]},{"type":"listItem","children":[{"type":"plain","text":"all the @types"}]}]},{"type":"heading","children":[{"type":"plain","text":".babelrc"}],"depth":1},{"type":"paragraph","children":[{"type":"plain","text":"Some of the syntaxes or features that React development needs are not supported by all browsers yet. To ensure the project works in all environments, the source code needs to be compiled into a backward-compatible version. That's what babel does."}]},{"type":"code","lang":"json","text":"{\n\t\"presets\": [\n\t\t\"@babel/preset-react\",\n\t\t// tell babel it has to compile React\n\t\t\"@babel/preset-typescript\"\n\t\t// tell babel it has to compile Typescript\n\t],\n\t\"plugins\": [\n\t\t\"@babel/proposal-class-properties\",\n\t\t\"@babel/proposal-object-rest-spread\",\n\t\t// enables above features of JavaScript in development\n\t\t\"babel-plugin-styled-components\"\n\t\t// I used styled-components in this project, this is the plugin to help babel process it\n\t]\n}"},{"type":"heading","children":[{"type":"plain","text":"tsconfig.json"}],"depth":1},{"type":"paragraph","children":[{"type":"plain","text":"The configurations for typescript."}]},{"type":"code","lang":"json","text":"{\n  \"compilerOptions\": {\n    \"target\": \"ES5\",\n    \"module\": \"CommonJS\",\n    \"lib\": [\"DOM\", \"ES2020\"],\n    \"strict\": true,\n    \"noImplicitAny\": true,\n    \"moduleResolution\": \"Node\",\n    \"jsx\": \"react\"\n  },\n  \"include\": [\"src\"],\n  \"exclude\": [\"node_modules\"]\n}"},{"type":"heading","children":[{"type":"plain","text":"includes"}],"depth":2},{"type":"paragraph","children":[{"type":"plain","text":"Define the paths with "},{"type":"inlineCode","text":".ts"},{"type":"plain","text":" files that need to be compiled."}]},{"type":"heading","children":[{"type":"plain","text":"excludes"}],"depth":2},{"type":"paragraph","children":[{"type":"plain","text":"The opposite of "},{"type":"inlineCode","text":"includes"},{"type":"plain","text":", define the paths that do NOT need compiling."}]},{"type":"heading","children":[{"type":"plain","text":"compilerOptions"}],"depth":2},{"type":"paragraph","children":[{"type":"plain","text":"Most of the typescript compiling options"}]},{"type":"heading","children":[{"type":"plain","text":"target"}],"depth":3},{"type":"paragraph","children":[{"type":"plain","text":"The js (ECMA) version of the output. Use "},{"type":"inlineCode","text":"ES5"},{"type":"plain","text":" or a newer version without worrying about compatibility issues because babel will compile again."}]},{"type":"heading","children":[{"type":"plain","text":"module"}],"depth":3},{"type":"paragraph","children":[{"type":"plain","text":"Which pattern to use regarding modules (export). Use "},{"type":"inlineCode","text":"commonJS"},{"type":"plain","text":" for applications running on node."}]},{"type":"heading","children":[{"type":"plain","text":"lib"}],"depth":3},{"type":"paragraph","children":[{"type":"plain","text":"Other libraries to be used in compilation. Add "},{"type":"inlineCode","text":"DOM"},{"type":"plain","text":" if features like "},{"type":"inlineCode","text":"document"},{"type":"plain","text":" or "},{"type":"inlineCode","text":"window"},{"type":"plain","text":" are used."}]},{"type":"heading","children":[{"type":"plain","text":"moduleResolution"}],"depth":3},{"type":"paragraph","children":[{"type":"plain","text":"How ts compilation deals with modules (import). Use "},{"type":"inlineCode","text":"node"},{"type":"plain","text":" to mock node's way to resolve module importing."}]},{"type":"heading","children":[{"type":"plain","text":"jsx"}],"depth":3},{"type":"paragraph","children":[{"type":"plain","text":"How to deal with "},{"type":"inlineCode","text":".jsx"},{"type":"plain","text":" files. Since we're developing React app, use "},{"type":"inlineCode","text":"react"},{"type":"plain","text":"."}]},{"type":"heading","children":[{"type":"plain","text":"webpack.client.config.ts"}],"depth":1},{"type":"paragraph","children":[{"type":"plain","text":"I split the webpack configs for the front-end and the SSR server for clarity. Also, I write both my webpack config files in typescript instead of javascript, but it's totally optional. I only did so because I wanted to try. Choose the one you're more comfortable with."}]},{"type":"code","lang":"ts","text":"import * as webpack from \"webpack\";\nimport { resolve } from \"path\";\n\nconst config: webpack.Configuration = {\n  mode: \"development\",\n  entry: \"./src/client/index.tsx\",\n  context: resolve(__dirname),\n  output: {\n    filename: \"[name].bundle.js\",\n    path: resolve(__dirname, \"dist\", \"static\"),\n  },\n  module: {\n    rules: [\n      {\n        test: /\\\\.tsx?$/,\n        exclude: /node_modules/,\n        use: [\n          {\n            loader: \"babel-loader\",\n          },\n          {\n            loader: \"ts-loader\",\n            options: {\n              configFile: \"tsconfig.json\",\n            },\n          },\n        ],\n      },\n    ],\n  },\n  optimization: {\n    minimize: true,\n    splitChunks: {\n      cacheGroups: {\n        commons: {\n          test: /node_modules/,\n          name: \"vendor\",\n          chunks: \"initial\",\n        },\n      },\n    },\n  },\n  resolve: {\n    extensions: [\".ts\", \".tsx\", \".js\", \".json\"],\n  },\n  plugins: [\n    new webpack.DefinePlugin({\n      \"process.env\": {\n        CONTENTFUL_TOKEN: JSON.stringify(process.env.CONTENTFUL_TOKEN || \"\"),\n        CONTENTFUL_SPACE_ID: JSON.stringify(\n          process.env.CONTENTFUL_SPACE_ID || \"\"\n        ),\n      },\n    }),\n  ],\n  devtool: \"inline-source-map\",\n};\n\nexport default config;"},{"type":"heading","children":[{"type":"plain","text":"mode"}],"depth":2},{"type":"paragraph","children":[{"type":"plain","text":"Mostly changes the value of "},{"type":"inlineCode","text":"process.env.NODE_ENV"},{"type":"plain","text":" on "},{"type":"inlineCode","text":"DefinePlugin"},{"type":"plain","text":". This can be set in command line parameter "},{"type":"inlineCode","text":"--mode"},{"type":"plain","text":" too. I set this to "},{"type":"inlineCode","text":"develop"},{"type":"plain","text":" and add "},{"type":"inlineCode","text":"--mode production"},{"type":"plain","text":" in scripts for production building."}]},{"type":"heading","children":[{"type":"plain","text":"entry"}],"depth":2},{"type":"paragraph","children":[{"type":"plain","text":"The starting point of the project; the root file for every other file imported or used. Likely the "},{"type":"inlineCode","text":"index.js"},{"type":"plain","text":" in "},{"type":"inlineCode","text":"src"},{"type":"plain","text":" folder for MVVM frameworks."}]},{"type":"paragraph","children":[{"type":"plain","text":"There might be multiple entry files in an optimized setup. I plan to do it in the future."}]},{"type":"heading","children":[{"type":"plain","text":"context"}],"depth":2},{"type":"paragraph","children":[{"type":"plain","text":"The reference directory for the path of entry and loaders. The default value is the webpack config file's location, so it shouldn't be a big problem without it. However, it's still recommended to set context, so the configuration is independent of its location when dealing with paths."}]},{"type":"heading","children":[{"type":"plain","text":"output"}],"depth":2},{"type":"paragraph","children":[{"type":"plain","text":"The building result. This can be very optimized and complex, but I'm only using the minimum configuration here: "},{"type":"inlineCode","text":"filename"},{"type":"plain","text":" for, well, the output filename, and "},{"type":"inlineCode","text":"path"},{"type":"plain","text":" for the output folder path."}]},{"type":"heading","children":[{"type":"plain","text":"module"}],"depth":2},{"type":"paragraph","children":[{"type":"plain","text":"Options for specifying where (target files)and how (which tool)to build the source codes. One of the most important parts of webpack configuration."}]},{"type":"heading","children":[{"type":"plain","text":"test"}],"depth":3},{"type":"paragraph","children":[{"type":"plain","text":"The paths of target files, using regular expressions."}]},{"type":"heading","children":[{"type":"plain","text":"use"}],"depth":3},{"type":"paragraph","children":[{"type":"plain","text":"The loaders for building. At default, webpack can only parse "},{"type":"inlineCode","text":".js"},{"type":"plain","text":" and "},{"type":"inlineCode","text":".json"},{"type":"plain","text":" files, so we need to add custom loaders for packaging other types of files."}]},{"type":"paragraph","children":[{"type":"plain","text":"Pass an array to use multiple loaders for the same target. The loaders' applying order depends on their order in the array: from last to first (from right to left/ from bottom to top)."}]},{"type":"paragraph","children":[{"type":"plain","text":"For packaging "},{"type":"inlineCode","text":".ts"},{"type":"plain","text":" files, you can add "},{"type":"inlineCode","text":"configFile"},{"type":"plain","text":" in "},{"type":"inlineCode","text":"use"},{"type":"plain","text":" to specifying the typescript config you want to use."}]},{"type":"heading","children":[{"type":"plain","text":"exclude"}],"depth":3},{"type":"paragraph","children":[{"type":"plain","text":"The opposite of "},{"type":"inlineCode","text":"test"},{"type":"plain","text":", specifying the file you wish not to package, like node modules."}]},{"type":"heading","children":[{"type":"plain","text":"resolve"}],"depth":2},{"type":"paragraph","children":[{"type":"plain","text":"The configurations for the modules."}]},{"type":"heading","children":[{"type":"plain","text":"extensions"}],"depth":3},{"type":"paragraph","children":[{"type":"plain","text":"The extensions for the files of the modules. Add the extensions that cover all of the files of the modules. Without this option, webpack may be unable to read some modules."}]},{"type":"heading","children":[{"type":"plain","text":"plugins"}],"depth":2},{"type":"paragraph","children":[{"type":"plain","text":"Miscellaneous tools to customize the build. I'm only adding "},{"type":"inlineCode","text":"DefinePlugin"},{"type":"plain","text":" to define the environment variables in this configuration."}]},{"type":"heading","children":[{"type":"plain","text":"devtool"}],"depth":2},{"type":"paragraph","children":[{"type":"plain","text":"Build output is suppressed and sometimes uglified. It protects the source code, but it may make debugging more difficult too."}]},{"type":"paragraph","children":[{"type":"inlineCode","text":"devtool"},{"type":"plain","text":" generates a map between the output and the source, so the console logs can display which line of the source code is causing the error."}]},{"type":"heading","children":[{"type":"plain","text":"webpack.server.config.ts"}],"depth":1},{"type":"paragraph","children":[{"type":"plain","text":"The webpack configurations for SSR server code. The idea is the same as the client part, but there are some differences too."}]},{"type":"code","lang":"ts","text":"import * as webpack from \"webpack\";\nimport { resolve } from \"path\";\nimport * as nodeExternals from \"webpack-node-externals\";\n\nconst config: webpack.Configuration = {\n  mode: \"development\",\n  entry: \"./src/server/index.ts\",\n  context: resolve(__dirname),\n  output: {\n    filename: \"server.bundle.js\",\n    path: resolve(__dirname, \"dist\", \"server\"),\n  },\n  target: \"node\",\n  node: {\n    __dirname: false,\n    __filename: false,\n  },\n  module: {\n    rules: [\n      {\n        test: /\\\\.tsx?$/,\n        exclude: /node_modules/,\n        use: [\"babel-loader\", \"ts-loader\"],\n      },\n    ],\n  },\n  resolve: {\n    extensions: [\".ts\", \".tsx\"],\n  },\n  externals: [nodeExternals()],\n  plugins: [\n    new webpack.DefinePlugin({\n      \"process.env\": {\n        CONTENTFUL_TOKEN: JSON.stringify(process.env.CONTENTFUL_TOKEN || \"\"),\n        CONTENTFUL_SPACE_ID: JSON.stringify(\n          process.env.CONTENTFUL_SPACE_ID || \"\"\n        ),\n        PORT: JSON.stringify(process.env.PORT) || 3000,\n      },\n    }),\n  ],\n};\n\nexport default config;"},{"type":"heading","children":[{"type":"plain","text":"target"}],"depth":2},{"type":"paragraph","children":[{"type":"plain","text":"The environment that the output is supposed to run on. The default value is "},{"type":"inlineCode","text":"web"},{"type":"plain","text":", which is the browser-like environment. For the nodejs applications, use "},{"type":"inlineCode","text":"node"},{"type":"plain","text":"."}]},{"type":"heading","children":[{"type":"plain","text":"externals"}],"depth":2},{"type":"paragraph","children":[{"type":"plain","text":"Excludes modules that are expected to be provided in the running environment. I use this to exclude node modules."}]},{"type":"heading","children":[{"type":"plain","text":"node"}],"depth":2},{"type":"paragraph","children":[{"type":"plain","text":"Configurations for the node-related parts in the source. I set "},{"type":"inlineCode","text":"__dirname"},{"type":"plain","text":" and "},{"type":"inlineCode","text":"__filename"},{"type":"plain","text":" so these two's behaviors are not changed during building."}]}],"postMetadata":{"id":"refactor-blog-1-webpack","title":"Refactor Blog: (1) Webpack","description":"","category":"Meta","language":["en-US"],"tags":[],"publishDate":"2021-03-09","pathname":"refactor-blog-1-webpack","zhTwLink":null,"filename":"Refactor Blog - (1) Webpack (blog)"},"categoryList":{"Game Development":5,"Life":5,"Gaming":12,"League of Legends":8,"Meta":4,"Web Development":4,"HKT48":4,"Programming":3,"Movie":2},"last5posts":[{"id":"godot-essentials","title":"Godot Essentials","description":"The biggest lessons I learned in my first Godot project.","category":"Game Development","language":["en-US"],"tags":[],"publishDate":"2024-04-21","pathname":"godot-essentials","zhTwLink":null,"filename":"Godot Essentials (blog)"},{"id":"4-years-reflection","title":"4 Years Reflection","description":"Another two years of life as a full-time developer has passed. Many things changed and many lessons learned. It's a perfect timing to look back and reflect.","category":"Life","language":["en-US"],"tags":[],"publishDate":"2024-04-08","pathname":"4-years-reflection","zhTwLink":null,"filename":"4 Years Reflection (blog)"},{"id":"improving-greatness","title":"Improving Greatness","description":"Breath of the Wild is one of the most impactful game in last decade. Yet for its successor, Nintendo built an even more polished version on an already magnificent fundamental.","category":"Gaming","language":["en-US"],"tags":[],"publishDate":"2024-03-17","pathname":"improving-greatness","zhTwLink":null,"filename":"Improving Greatness (blog)"},{"id":"s13-recap","title":"S13 Recap","description":"After a three years gap, I'm back to league.","category":"League of Legends","language":["en-US"],"tags":[],"publishDate":"2024-01-23","pathname":"s13-recap","zhTwLink":null,"filename":"S13 Recap (blog)"},{"id":"refactor-blog-2023-markdown-based-content","title":"Refactor Blog 2023: Markdown Based Content","description":"Embracing a different approach toward my own data, I made a change to the content hosting method of my blog.","category":"Meta","language":["en-US"],"tags":[],"publishDate":"2023-06-19","pathname":"refactor-blog-2023-markdown-based-content","zhTwLink":null,"filename":"Refactor Blog 2023 - Markdown Based Content (blog)"}]},"__N_SSG":true},"page":"/blog/[pathname]","query":{"pathname":"refactor-blog-1-webpack"},"buildId":"Ct-zOyv_Ohd6ncbBqnMnN","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>