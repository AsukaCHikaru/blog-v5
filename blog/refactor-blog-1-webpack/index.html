<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width"><title>Refactor Blog: (1) Webpack | Asuka Wang</title><meta name="description" content="In this year's annual blog refactoring, I withdrew from using boilerplate build tools and configured Webpack myself."><meta property="og:title" content="Refactor Blog: (1) Webpack | Asuka Wang"><meta property="twitter:title" content="Refactor Blog: (1) Webpack | Asuka Wang"><meta name="next-head-count" content="6"><link rel="preload" href="/_next/static/css/189e1174f0258bb3.css" as="style"><link rel="preload" as="font" type="font/woff2" crossorigin="anonymous" href="/subfont/Gentium_Plus-400-62b8f514fb.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin="anonymous" href="/subfont/Noto_Serif_JP_CJK-400-0edade8171.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin="anonymous" href="/subfont/Noto_Serif_JP-400-10e25bcd0f.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin="anonymous" href="/subfont/Gentium_Plus_Book-700-47a76121c3.woff2"><link rel="stylesheet" href="/subfont/fonts-7cdcf355c4.css"><link rel="stylesheet" href="/_next/static/css/189e1174f0258bb3.css" data-n-g=""><link rel="preload" href="/_next/static/css/76f66be5f297cc9e.css" as="style"><link rel="stylesheet" href="/_next/static/css/76f66be5f297cc9e.css" data-n-p=""><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-b8f8d6679aaa5f42.js" defer=""></script><script src="/_next/static/chunks/framework-114634acb84f8baa.js" defer=""></script><script src="/_next/static/chunks/main-f2ca60db2beb93ed.js" defer=""></script><script src="/_next/static/chunks/pages/_app-be51c38591acb686.js" defer=""></script><script src="/_next/static/chunks/542-7be5b5539309fe0b.js" defer=""></script><script src="/_next/static/chunks/210-aecf7644b6c77832.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5Bpathname%5D-5fe171a485dfba8b.js" defer=""></script><script src="/_next/static/NwEjpMHb8jAY4XF0V-9Qp/_buildManifest.js" defer=""></script><script src="/_next/static/NwEjpMHb8jAY4XF0V-9Qp/_ssgManifest.js" defer=""></script></head><body><div id="__next"><main><div class="text-color Layout_container__S4aNf" data-is-menu-open="false"><div class="SiteHeader_container__8tKwA" data-is-menu-open="false"><div class="SiteHeader_nav-container__oEq2d"><div class="SiteHeader_section-container__tAKnZ"><a class="SiteHeader_section-link__9DmFE interactive-color text-color" href="/blog/">blog</a><a class="SiteHeader_section-link__9DmFE interactive-color " href="/about/">about</a><a target="_blank" class="SiteHeader_section-link__9DmFE interactive-color" href="/blog/feed.xml">rss</a></div><button class="SiteHeader_menu-button__eK9ND">menu</button><a class="SiteHeader_publication-folio___ZFZS text-color" href="/">ASUKA WANG</a></div><div class="SiteHeader_divider__cq_R_ border-color-100"></div><div class="SiteHeader_menu-wrapper__2evr7"></div></div><div class="Layout_full-content__MQIxS"><div class="PostDetailPageHeader_container__fcMw9"><div class="Layout_main-content__mr9_2"><h1 class="PostDetailPageHeader_title__YwZEK">Refactor Blog: (1) Webpack</h1><h2 class="PostDetailPageHeader_description__HSXhn">In this year's annual blog refactoring, I withdrew from using boilerplate build tools and configured Webpack myself.</h2><div class="PostDetailPageHeader_publish-date__pMF22">March 9, 2021</div></div></div></div><div class="Layout_main-content__mr9_2"><article class="PostDetailPage_article__K8T4B"><p>Recently, I rewrote my&nbsp;<a href="https://asukawang.com/blog" class="PostBodyBlock_link__faaEN" rel="noreferrer noopener" target="_blank">blog</a>&nbsp;for the second time. Every time, I rewrite to solve particular problems.</p><p>The previous version's problems are the architecture: I used&nbsp;<a href="https://www.gatsbyjs.com/" class="PostBodyBlock_link__faaEN" rel="noreferrer noopener" target="_blank">Gatsby</a>&nbsp;for v2, and I didn't enjoy it. There are many plugins that I don't fully understand, and they handle a lot of things. I don't know what's under the hood of my blog while building it.</p><p>I wanted more control over my project.</p><p>That's why after I felt I had grasped enough knowledge to start a project from scratch, I started the rewrite straightaway. This time -- for the first time -- I'm not using <code class="PostBodyBlock_inline-code__TAzYM">npx create-react-app</code> or <code class="PostBodyBlock_inline-code__TAzYM">gatsby new</code>. I'm writing every line of the configs by myself.</p><p>If you've struggled with all those config setups, ex. <code class="PostBodyBlock_inline-code__TAzYM">webpack.config.js</code>, <code class="PostBodyBlock_inline-code__TAzYM">babelrc</code>, <code class="PostBodyBlock_inline-code__TAzYM">tsconfig.json</code> -- I know the feeling. I used to be afraid of dealing with them, but not anymore. I hope this article helps others to achieve that too.</p><h2 class="PostBodyBlock_h2__z8Iri" id="dependencies">Dependencies</h2><p>I used React and Typescript for this project. The minimum dependencies for this architecture are:</p><ul class="PostBodyBlock_ul__QtcuL"><li>webpack, webpack-cli, @babel/core</li><li>babel-loader, @babel/preset-react</li><li>ts-loader, @babel/preset-typescript</li><li>babel-plugin-styled-components</li><li>@babel/preset-env, @babel/plugin-proposal-class-propoties, @babel/plugin-proposal-object-rest-spread, webpack-node-externals</li><li>all the @types</li></ul><h2 class="PostBodyBlock_h2__z8Iri" id="-babelrc">.babelrc</h2><p>Some of the syntaxes or features that React development needs are not supported by all browsers yet. To ensure the project works in all environments, the source code needs to be compiled into a backward-compatible version. That's what babel does.</p><pre class="CodeBlock_block__wRht1"><code class="CodeBlock_code__1aD9x language-json">{
  "presets": [
    "@babel/preset-react",
    // tell babel it has to compile React
    "@babel/preset-typescript"
    // tell babel it has to compile Typescript
  ],
  "plugins": [
    "@babel/proposal-class-properties",
    "@babel/proposal-object-rest-spread",
    // enables above features of JavaScript in development
    "babel-plugin-styled-components"
    // I used styled-components in this project, this is the plugin to help babel process it
  ]
}</code></pre><h2 class="PostBodyBlock_h2__z8Iri" id="tsconfig-json">tsconfig.json</h2><p>The configurations for typescript.</p><pre class="CodeBlock_block__wRht1"><code class="CodeBlock_code__1aD9x language-json">{
  "compilerOptions": {
    "target": "ES5",
    "module": "CommonJS",
    "lib": ["DOM", "ES2020"],
    "strict": true,
    "noImplicitAny": true,
    "moduleResolution": "Node",
    "jsx": "react"
  },
  "include": ["src"],
  "exclude": ["node_modules"]
}</code></pre><h3 class="PostBodyBlock_h3__BUDla" id="includes">includes</h3><p>Define the paths with <code class="PostBodyBlock_inline-code__TAzYM">.ts</code> files that need to be compiled.</p><h3 class="PostBodyBlock_h3__BUDla" id="excludes">excludes</h3><p>The opposite of <code class="PostBodyBlock_inline-code__TAzYM">includes</code>, define the paths that do NOT need compiling.</p><h3 class="PostBodyBlock_h3__BUDla" id="compileroptions">compilerOptions</h3><p>Most of the typescript compiling options</p><h4 class="PostBodyBlock_h4__78VBA" id="target">target</h4><p>The js (ECMA) version of the output. Use <code class="PostBodyBlock_inline-code__TAzYM">ES5</code> or a newer version without worrying about compatibility issues because babel will compile again.</p><h4 class="PostBodyBlock_h4__78VBA" id="module">module</h4><p>Which pattern to use regarding modules (export). Use <code class="PostBodyBlock_inline-code__TAzYM">commonJS</code> for applications running on node.</p><h4 class="PostBodyBlock_h4__78VBA" id="lib">lib</h4><p>Other libraries to be used in compilation. Add <code class="PostBodyBlock_inline-code__TAzYM">DOM</code> if features like <code class="PostBodyBlock_inline-code__TAzYM">document</code> or <code class="PostBodyBlock_inline-code__TAzYM">window</code> are used.</p><h4 class="PostBodyBlock_h4__78VBA" id="moduleresolution">moduleResolution</h4><p>How ts compilation deals with modules (import). Use <code class="PostBodyBlock_inline-code__TAzYM">node</code> to mock node's way to resolve module importing.</p><h4 class="PostBodyBlock_h4__78VBA" id="jsx">jsx</h4><p>How to deal with <code class="PostBodyBlock_inline-code__TAzYM">.jsx</code> files. Since we're developing React app, use <code class="PostBodyBlock_inline-code__TAzYM">react</code>.</p><h2 class="PostBodyBlock_h2__z8Iri" id="webpack-client-config-ts">webpack.client.config.ts</h2><p>I split the webpack configs for the front-end and the SSR server for clarity. Also, I write both my webpack config files in typescript instead of javascript, but it's totally optional. I only did so because I wanted to try. Choose the one you're more comfortable with.</p><pre class="CodeBlock_block__wRht1"><code class="CodeBlock_code__1aD9x language-ts">import * as webpack from "webpack";
import { resolve } from "path";

const config: webpack.Configuration = {
  mode: "development",
  entry: "./src/client/index.tsx",
  context: resolve(__dirname),
  output: {
    filename: "[name].bundle.js",
    path: resolve(__dirname, "dist", "static"),
  },
  module: {
    rules: [
      {
        test: /\\.tsx?$/,
        exclude: /node_modules/,
        use: [
          {
            loader: "babel-loader",
          },
          {
            loader: "ts-loader",
            options: {
              configFile: "tsconfig.json",
            },
          },
        ],
      },
    ],
  },
  optimization: {
    minimize: true,
    splitChunks: {
      cacheGroups: {
        commons: {
          test: /node_modules/,
          name: "vendor",
          chunks: "initial",
        },
      },
    },
  },
  resolve: {
    extensions: [".ts", ".tsx", ".js", ".json"],
  },
  plugins: [
    new webpack.DefinePlugin({
      "process.env": {
        CONTENTFUL_TOKEN: JSON.stringify(process.env.CONTENTFUL_TOKEN || ""),
        CONTENTFUL_SPACE_ID: JSON.stringify(
          process.env.CONTENTFUL_SPACE_ID || ""
        ),
      },
    }),
  ],
  devtool: "inline-source-map",
};

export default config;</code></pre><h3 class="PostBodyBlock_h3__BUDla" id="mode">mode</h3><p>Mostly changes the value of <code class="PostBodyBlock_inline-code__TAzYM">process.env.NODE_ENV</code> on <code class="PostBodyBlock_inline-code__TAzYM">DefinePlugin</code>. This can be set in command line parameter <code class="PostBodyBlock_inline-code__TAzYM">--mode</code> too. I set this to <code class="PostBodyBlock_inline-code__TAzYM">develop</code> and add <code class="PostBodyBlock_inline-code__TAzYM">--mode production</code> in scripts for production building.</p><h3 class="PostBodyBlock_h3__BUDla" id="entry">entry</h3><p>The starting point of the project; the root file for every other file imported or used. Likely the <code class="PostBodyBlock_inline-code__TAzYM">index.js</code> in <code class="PostBodyBlock_inline-code__TAzYM">src</code> folder for MVVM frameworks.</p><p>There might be multiple entry files in an optimized setup. I plan to do it in the future.</p><h3 class="PostBodyBlock_h3__BUDla" id="context">context</h3><p>The reference directory for the path of entry and loaders. The default value is the webpack config file's location, so it shouldn't be a big problem without it. However, it's still recommended to set context, so the configuration is independent of its location when dealing with paths.</p><h3 class="PostBodyBlock_h3__BUDla" id="output">output</h3><p>The building result. This can be very optimized and complex, but I'm only using the minimum configuration here: <code class="PostBodyBlock_inline-code__TAzYM">filename</code> for, well, the output filename, and <code class="PostBodyBlock_inline-code__TAzYM">path</code> for the output folder path.</p><h3 class="PostBodyBlock_h3__BUDla" id="module">module</h3><p>Options for specifying where (target files)and how (which tool)to build the source codes. One of the most important parts of webpack configuration.</p><h4 class="PostBodyBlock_h4__78VBA" id="test">test</h4><p>The paths of target files, using regular expressions.</p><h4 class="PostBodyBlock_h4__78VBA" id="use">use</h4><p>The loaders for building. At default, webpack can only parse <code class="PostBodyBlock_inline-code__TAzYM">.js</code> and <code class="PostBodyBlock_inline-code__TAzYM">.json</code> files, so we need to add custom loaders for packaging other types of files.</p><p>Pass an array to use multiple loaders for the same target. The loaders' applying order depends on their order in the array: from last to first (from right to left/ from bottom to top).</p><p>For packaging <code class="PostBodyBlock_inline-code__TAzYM">.ts</code> files, you can add <code class="PostBodyBlock_inline-code__TAzYM">configFile</code> in <code class="PostBodyBlock_inline-code__TAzYM">use</code> to specifying the typescript config you want to use.</p><h4 class="PostBodyBlock_h4__78VBA" id="exclude">exclude</h4><p>The opposite of <code class="PostBodyBlock_inline-code__TAzYM">test</code>, specifying the file you wish not to package, like node modules.</p><h3 class="PostBodyBlock_h3__BUDla" id="resolve">resolve</h3><p>The configurations for the modules.</p><h4 class="PostBodyBlock_h4__78VBA" id="extensions">extensions</h4><p>The extensions for the files of the modules. Add the extensions that cover all of the files of the modules. Without this option, webpack may be unable to read some modules.</p><h3 class="PostBodyBlock_h3__BUDla" id="plugins">plugins</h3><p>Miscellaneous tools to customize the build. I'm only adding <code class="PostBodyBlock_inline-code__TAzYM">DefinePlugin</code> to define the environment variables in this configuration.</p><h3 class="PostBodyBlock_h3__BUDla" id="devtool">devtool</h3><p>Build output is suppressed and sometimes uglified. It protects the source code, but it may make debugging more difficult too.</p><p><code class="PostBodyBlock_inline-code__TAzYM">devtool</code> generates a map between the output and the source, so the console logs can display which line of the source code is causing the error.</p><h2 class="PostBodyBlock_h2__z8Iri" id="webpack-server-config-ts">webpack.server.config.ts</h2><p>The webpack configurations for SSR server code. The idea is the same as the client part, but there are some differences too.</p><pre class="CodeBlock_block__wRht1"><code class="CodeBlock_code__1aD9x language-ts">import * as webpack from "webpack";
import { resolve } from "path";
import * as nodeExternals from "webpack-node-externals";

const config: webpack.Configuration = {
  mode: "development",
  entry: "./src/server/index.ts",
  context: resolve(__dirname),
  output: {
    filename: "server.bundle.js",
    path: resolve(__dirname, "dist", "server"),
  },
  target: "node",
  node: {
    __dirname: false,
    __filename: false,
  },
  module: {
    rules: [
      {
        test: /\\.tsx?$/,
        exclude: /node_modules/,
        use: ["babel-loader", "ts-loader"],
      },
    ],
  },
  resolve: {
    extensions: [".ts", ".tsx"],
  },
  externals: [nodeExternals()],
  plugins: [
    new webpack.DefinePlugin({
      "process.env": {
        CONTENTFUL_TOKEN: JSON.stringify(process.env.CONTENTFUL_TOKEN || ""),
        CONTENTFUL_SPACE_ID: JSON.stringify(
          process.env.CONTENTFUL_SPACE_ID || ""
        ),
        PORT: JSON.stringify(process.env.PORT) || 3000,
      },
    }),
  ],
};

export default config;</code></pre><h3 class="PostBodyBlock_h3__BUDla" id="target">target</h3><p>The environment that the output is supposed to run on. The default value is <code class="PostBodyBlock_inline-code__TAzYM">web</code>, which is the browser-like environment. For the nodejs applications, use <code class="PostBodyBlock_inline-code__TAzYM">node</code>.</p><h3 class="PostBodyBlock_h3__BUDla" id="externals">externals</h3><p>Excludes modules that are expected to be provided in the running environment. I use this to exclude node modules.</p><h3 class="PostBodyBlock_h3__BUDla" id="node">node</h3><p>Configurations for the node-related parts in the source. I set <code class="PostBodyBlock_inline-code__TAzYM">__dirname</code> and <code class="PostBodyBlock_inline-code__TAzYM">__filename</code> so these two's behaviors are not changed during building.</p></article><div class="PostDetailPage_additional-list-container__b_oHL"><div class="AdditionalPostList_container__ucjfo"><div class="AdditionalPostList_category-link__EDTWa">More from<a href="/blog/archive/?category=retrospective">retrospective</a></div><div class="AdditionalPostList_card-list__jz3F_"><a class="AdditionalPostList_card__doJcw" href="/blog/s14-recap/"><div><div class="AdditionalPostList_card-title__FDhSX">S14 Recap</div><div class="AdditionalPostList_card-description__Enc8v">I did not play a lot of league during 2024, but I had a few unforgettable moments nonetheless.</div></div><div class="AdditionalPostList_card-publish-date__Jvdgm">January 7, 2025</div></a><a class="AdditionalPostList_card__doJcw" href="/blog/site-patch-notes-2024-redesign/"><div><div class="AdditionalPostList_card-title__FDhSX">Site Patch Notes: 2024 Redesign</div><div class="AdditionalPostList_card-description__Enc8v">The 2024 redesign is finally here! I went on a journey of learning editorial design, and did an overhaul to this site's design, both functionality-wise and visual-wise.</div></div><div class="AdditionalPostList_card-publish-date__Jvdgm">August 18, 2024</div></a><a class="AdditionalPostList_card__doJcw" href="/blog/4-years-reflection/"><div><div class="AdditionalPostList_card-title__FDhSX">4 Years Reflection</div><div class="AdditionalPostList_card-description__Enc8v">Another two years of life as a full-time developer has passed. Many things changed and many lessons learned. It's a perfect timing to look back and reflect.</div></div><div class="AdditionalPostList_card-publish-date__Jvdgm">April 8, 2024</div></a><a class="AdditionalPostList_card__doJcw" href="/blog/s13-recap/"><div><div class="AdditionalPostList_card-title__FDhSX">S13 Recap</div><div class="AdditionalPostList_card-description__Enc8v">After a three years gap, I'm back to league.</div></div><div class="AdditionalPostList_card-publish-date__Jvdgm">January 23, 2024</div></a><a class="AdditionalPostList_card__doJcw" href="/blog/refactor-blog-2023-markdown-based-content/"><div><div class="AdditionalPostList_card-title__FDhSX">Refactor Blog 2023: Markdown Based Content</div><div class="AdditionalPostList_card-description__Enc8v">Embracing a different approach toward my own data, I made a change to the content hosting method of my blog.</div></div><div class="AdditionalPostList_card-publish-date__Jvdgm">June 19, 2023</div></a></div></div><div class="AdditionalPostList_container__ucjfo"><a class="AdditionalPostList_archive-link__7Q6ys" href="/blog/archive/">Archive</a><div class="AdditionalPostList_card-list__jz3F_"><a class="AdditionalPostList_card__doJcw" href="/blog/blogging-and-digital-gardening/"><div><div class="AdditionalPostList_card-title__FDhSX">Blogging and Digital Gardening in the Social Platform and Generative AI Era</div><div class="AdditionalPostList_card-description__Enc8v">I talk to myself about why bother writing at somewhere nobody comes.</div></div><div class="AdditionalPostList_card-publish-date__Jvdgm">February 11, 2025</div></a><a class="AdditionalPostList_card__doJcw" href="/blog/a-redemption-three-years-later/"><div><div class="AdditionalPostList_card-title__FDhSX">A Redemption Three Years Later</div><div class="AdditionalPostList_card-description__Enc8v">CD PROJEKT RED made a promise about Night City, which they broke. Three years later they had another attempt, and to me, it was their redemption.</div></div><div class="AdditionalPostList_card-publish-date__Jvdgm">January 13, 2025</div></a><a class="AdditionalPostList_card__doJcw" href="/blog/s14-recap/"><div><div class="AdditionalPostList_card-title__FDhSX">S14 Recap</div><div class="AdditionalPostList_card-description__Enc8v">I did not play a lot of league during 2024, but I had a few unforgettable moments nonetheless.</div></div><div class="AdditionalPostList_card-publish-date__Jvdgm">January 7, 2025</div></a><a class="AdditionalPostList_card__doJcw" href="/blog/thoughts-on-building-a-game-with-xstate/"><div><div class="AdditionalPostList_card-title__FDhSX">Thoughts on Building a Game with XState</div><div class="AdditionalPostList_card-description__Enc8v">After hearing about XState's good reputation for years, I used it to build the prototype for my game. These are my thoughts.</div></div><div class="AdditionalPostList_card-publish-date__Jvdgm">January 4, 2025</div></a><a class="AdditionalPostList_card__doJcw" href="/blog/under-the-hood-diablo-ii-item-generation/"><div><div class="AdditionalPostList_card-title__FDhSX">Under the Hood: Diablo II Item Generation</div><div class="AdditionalPostList_card-description__Enc8v">A system design research turned into a reconciliation with a game I didn't know I was so in love with, so I wrote a research note to express my appreciation.</div></div><div class="AdditionalPostList_card-publish-date__Jvdgm">November 8, 2024</div></a></div></div></div></div><div class="Layout_right-panel__zSn4t"><div class="TableOfContentColumn_container__0tmUV"><ul class="TableOfContentColumn_ul__7wuVs interactive-list-color"><li class="TableOfContentColumn_li__FUe4z"><button role="link" class="TableOfContentColumn_link__5qS3c">Dependencies</button></li><li class="TableOfContentColumn_li__FUe4z"><button role="link" class="TableOfContentColumn_link__5qS3c">.babelrc</button></li><li class="TableOfContentColumn_li__FUe4z"><button role="link" class="TableOfContentColumn_link__5qS3c">tsconfig.json</button></li><li class="TableOfContentColumn_li__FUe4z"><div class="TableOfContentColumn_indent__CXWB4"></div><button role="link" class="TableOfContentColumn_link__5qS3c">includes</button></li><li class="TableOfContentColumn_li__FUe4z"><div class="TableOfContentColumn_indent__CXWB4"></div><button role="link" class="TableOfContentColumn_link__5qS3c">excludes</button></li><li class="TableOfContentColumn_li__FUe4z"><div class="TableOfContentColumn_indent__CXWB4"></div><button role="link" class="TableOfContentColumn_link__5qS3c">compilerOptions</button></li><li class="TableOfContentColumn_li__FUe4z"><div class="TableOfContentColumn_indent__CXWB4"></div><div class="TableOfContentColumn_indent__CXWB4"></div><button role="link" class="TableOfContentColumn_link__5qS3c">target</button></li><li class="TableOfContentColumn_li__FUe4z"><div class="TableOfContentColumn_indent__CXWB4"></div><div class="TableOfContentColumn_indent__CXWB4"></div><button role="link" class="TableOfContentColumn_link__5qS3c">module</button></li><li class="TableOfContentColumn_li__FUe4z"><div class="TableOfContentColumn_indent__CXWB4"></div><div class="TableOfContentColumn_indent__CXWB4"></div><button role="link" class="TableOfContentColumn_link__5qS3c">lib</button></li><li class="TableOfContentColumn_li__FUe4z"><div class="TableOfContentColumn_indent__CXWB4"></div><div class="TableOfContentColumn_indent__CXWB4"></div><button role="link" class="TableOfContentColumn_link__5qS3c">moduleResolution</button></li><li class="TableOfContentColumn_li__FUe4z"><div class="TableOfContentColumn_indent__CXWB4"></div><div class="TableOfContentColumn_indent__CXWB4"></div><button role="link" class="TableOfContentColumn_link__5qS3c">jsx</button></li><li class="TableOfContentColumn_li__FUe4z"><button role="link" class="TableOfContentColumn_link__5qS3c">webpack.client.config.ts</button></li><li class="TableOfContentColumn_li__FUe4z"><div class="TableOfContentColumn_indent__CXWB4"></div><button role="link" class="TableOfContentColumn_link__5qS3c">mode</button></li><li class="TableOfContentColumn_li__FUe4z"><div class="TableOfContentColumn_indent__CXWB4"></div><button role="link" class="TableOfContentColumn_link__5qS3c">entry</button></li><li class="TableOfContentColumn_li__FUe4z"><div class="TableOfContentColumn_indent__CXWB4"></div><button role="link" class="TableOfContentColumn_link__5qS3c">context</button></li><li class="TableOfContentColumn_li__FUe4z"><div class="TableOfContentColumn_indent__CXWB4"></div><button role="link" class="TableOfContentColumn_link__5qS3c">output</button></li><li class="TableOfContentColumn_li__FUe4z"><div class="TableOfContentColumn_indent__CXWB4"></div><button role="link" class="TableOfContentColumn_link__5qS3c">module</button></li><li class="TableOfContentColumn_li__FUe4z"><div class="TableOfContentColumn_indent__CXWB4"></div><div class="TableOfContentColumn_indent__CXWB4"></div><button role="link" class="TableOfContentColumn_link__5qS3c">test</button></li><li class="TableOfContentColumn_li__FUe4z"><div class="TableOfContentColumn_indent__CXWB4"></div><div class="TableOfContentColumn_indent__CXWB4"></div><button role="link" class="TableOfContentColumn_link__5qS3c">use</button></li><li class="TableOfContentColumn_li__FUe4z"><div class="TableOfContentColumn_indent__CXWB4"></div><div class="TableOfContentColumn_indent__CXWB4"></div><button role="link" class="TableOfContentColumn_link__5qS3c">exclude</button></li><li class="TableOfContentColumn_li__FUe4z"><div class="TableOfContentColumn_indent__CXWB4"></div><button role="link" class="TableOfContentColumn_link__5qS3c">resolve</button></li><li class="TableOfContentColumn_li__FUe4z"><div class="TableOfContentColumn_indent__CXWB4"></div><div class="TableOfContentColumn_indent__CXWB4"></div><button role="link" class="TableOfContentColumn_link__5qS3c">extensions</button></li><li class="TableOfContentColumn_li__FUe4z"><div class="TableOfContentColumn_indent__CXWB4"></div><button role="link" class="TableOfContentColumn_link__5qS3c">plugins</button></li><li class="TableOfContentColumn_li__FUe4z"><div class="TableOfContentColumn_indent__CXWB4"></div><button role="link" class="TableOfContentColumn_link__5qS3c">devtool</button></li><li class="TableOfContentColumn_li__FUe4z"><button role="link" class="TableOfContentColumn_link__5qS3c">webpack.server.config.ts</button></li><li class="TableOfContentColumn_li__FUe4z"><div class="TableOfContentColumn_indent__CXWB4"></div><button role="link" class="TableOfContentColumn_link__5qS3c">target</button></li><li class="TableOfContentColumn_li__FUe4z"><div class="TableOfContentColumn_indent__CXWB4"></div><button role="link" class="TableOfContentColumn_link__5qS3c">externals</button></li><li class="TableOfContentColumn_li__FUe4z"><div class="TableOfContentColumn_indent__CXWB4"></div><button role="link" class="TableOfContentColumn_link__5qS3c">node</button></li></ul></div></div><div class="SiteFooter_container__0v6cR border-color"><a href="https://asukawang.com" rel="noopener noreferrer" target="_blank" class="SiteFooter_link__RuMSe interactive-color">asukawang.com 2018-</a></div></div></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postContent":[{"type":"paragraph","children":[{"type":"plain","text":"Recently, I rewrote my "},{"type":"link","text":"blog","url":"https://asukawang.com/blog"},{"type":"plain","text":" for the second time. Every time, I rewrite to solve particular problems."}]},{"type":"paragraph","children":[{"type":"plain","text":"The previous version's problems are the architecture: I used "},{"type":"link","text":"Gatsby","url":"https://www.gatsbyjs.com/"},{"type":"plain","text":" for v2, and I didn't enjoy it. There are many plugins that I don't fully understand, and they handle a lot of things. I don't know what's under the hood of my blog while building it."}]},{"type":"paragraph","children":[{"type":"plain","text":"I wanted more control over my project."}]},{"type":"paragraph","children":[{"type":"plain","text":"That's why after I felt I had grasped enough knowledge to start a project from scratch, I started the rewrite straightaway. This time -- for the first time -- I'm not using "},{"type":"inlineCode","text":"npx create-react-app"},{"type":"plain","text":" or "},{"type":"inlineCode","text":"gatsby new"},{"type":"plain","text":". I'm writing every line of the configs by myself."}]},{"type":"paragraph","children":[{"type":"plain","text":"If you've struggled with all those config setups, ex. "},{"type":"inlineCode","text":"webpack.config.js"},{"type":"plain","text":", "},{"type":"inlineCode","text":"babelrc"},{"type":"plain","text":", "},{"type":"inlineCode","text":"tsconfig.json"},{"type":"plain","text":" -- I know the feeling. I used to be afraid of dealing with them, but not anymore. I hope this article helps others to achieve that too."}]},{"type":"heading","children":[{"type":"plain","text":"Dependencies"}],"depth":1},{"type":"paragraph","children":[{"type":"plain","text":"I used React and Typescript for this project. The minimum dependencies for this architecture are:"}]},{"type":"list","ordered":false,"children":[{"type":"listItem","children":[{"type":"plain","text":"webpack, webpack-cli, @babel/core"}]},{"type":"listItem","children":[{"type":"plain","text":"babel-loader, @babel/preset-react"}]},{"type":"listItem","children":[{"type":"plain","text":"ts-loader, @babel/preset-typescript"}]},{"type":"listItem","children":[{"type":"plain","text":"babel-plugin-styled-components"}]},{"type":"listItem","children":[{"type":"plain","text":"@babel/preset-env, @babel/plugin-proposal-class-propoties, @babel/plugin-proposal-object-rest-spread, webpack-node-externals"}]},{"type":"listItem","children":[{"type":"plain","text":"all the @types"}]}]},{"type":"heading","children":[{"type":"plain","text":".babelrc"}],"depth":1},{"type":"paragraph","children":[{"type":"plain","text":"Some of the syntaxes or features that React development needs are not supported by all browsers yet. To ensure the project works in all environments, the source code needs to be compiled into a backward-compatible version. That's what babel does."}]},{"type":"code","lang":"json","text":"{\n  \"presets\": [\n    \"@babel/preset-react\",\n    // tell babel it has to compile React\n    \"@babel/preset-typescript\"\n    // tell babel it has to compile Typescript\n  ],\n  \"plugins\": [\n    \"@babel/proposal-class-properties\",\n    \"@babel/proposal-object-rest-spread\",\n    // enables above features of JavaScript in development\n    \"babel-plugin-styled-components\"\n    // I used styled-components in this project, this is the plugin to help babel process it\n  ]\n}"},{"type":"heading","children":[{"type":"plain","text":"tsconfig.json"}],"depth":1},{"type":"paragraph","children":[{"type":"plain","text":"The configurations for typescript."}]},{"type":"code","lang":"json","text":"{\n  \"compilerOptions\": {\n    \"target\": \"ES5\",\n    \"module\": \"CommonJS\",\n    \"lib\": [\"DOM\", \"ES2020\"],\n    \"strict\": true,\n    \"noImplicitAny\": true,\n    \"moduleResolution\": \"Node\",\n    \"jsx\": \"react\"\n  },\n  \"include\": [\"src\"],\n  \"exclude\": [\"node_modules\"]\n}"},{"type":"heading","children":[{"type":"plain","text":"includes"}],"depth":2},{"type":"paragraph","children":[{"type":"plain","text":"Define the paths with "},{"type":"inlineCode","text":".ts"},{"type":"plain","text":" files that need to be compiled."}]},{"type":"heading","children":[{"type":"plain","text":"excludes"}],"depth":2},{"type":"paragraph","children":[{"type":"plain","text":"The opposite of "},{"type":"inlineCode","text":"includes"},{"type":"plain","text":", define the paths that do NOT need compiling."}]},{"type":"heading","children":[{"type":"plain","text":"compilerOptions"}],"depth":2},{"type":"paragraph","children":[{"type":"plain","text":"Most of the typescript compiling options"}]},{"type":"heading","children":[{"type":"plain","text":"target"}],"depth":3},{"type":"paragraph","children":[{"type":"plain","text":"The js (ECMA) version of the output. Use "},{"type":"inlineCode","text":"ES5"},{"type":"plain","text":" or a newer version without worrying about compatibility issues because babel will compile again."}]},{"type":"heading","children":[{"type":"plain","text":"module"}],"depth":3},{"type":"paragraph","children":[{"type":"plain","text":"Which pattern to use regarding modules (export). Use "},{"type":"inlineCode","text":"commonJS"},{"type":"plain","text":" for applications running on node."}]},{"type":"heading","children":[{"type":"plain","text":"lib"}],"depth":3},{"type":"paragraph","children":[{"type":"plain","text":"Other libraries to be used in compilation. Add "},{"type":"inlineCode","text":"DOM"},{"type":"plain","text":" if features like "},{"type":"inlineCode","text":"document"},{"type":"plain","text":" or "},{"type":"inlineCode","text":"window"},{"type":"plain","text":" are used."}]},{"type":"heading","children":[{"type":"plain","text":"moduleResolution"}],"depth":3},{"type":"paragraph","children":[{"type":"plain","text":"How ts compilation deals with modules (import). Use "},{"type":"inlineCode","text":"node"},{"type":"plain","text":" to mock node's way to resolve module importing."}]},{"type":"heading","children":[{"type":"plain","text":"jsx"}],"depth":3},{"type":"paragraph","children":[{"type":"plain","text":"How to deal with "},{"type":"inlineCode","text":".jsx"},{"type":"plain","text":" files. Since we're developing React app, use "},{"type":"inlineCode","text":"react"},{"type":"plain","text":"."}]},{"type":"heading","children":[{"type":"plain","text":"webpack.client.config.ts"}],"depth":1},{"type":"paragraph","children":[{"type":"plain","text":"I split the webpack configs for the front-end and the SSR server for clarity. Also, I write both my webpack config files in typescript instead of javascript, but it's totally optional. I only did so because I wanted to try. Choose the one you're more comfortable with."}]},{"type":"code","lang":"ts","text":"import * as webpack from \"webpack\";\nimport { resolve } from \"path\";\n\nconst config: webpack.Configuration = {\n  mode: \"development\",\n  entry: \"./src/client/index.tsx\",\n  context: resolve(__dirname),\n  output: {\n    filename: \"[name].bundle.js\",\n    path: resolve(__dirname, \"dist\", \"static\"),\n  },\n  module: {\n    rules: [\n      {\n        test: /\\\\.tsx?$/,\n        exclude: /node_modules/,\n        use: [\n          {\n            loader: \"babel-loader\",\n          },\n          {\n            loader: \"ts-loader\",\n            options: {\n              configFile: \"tsconfig.json\",\n            },\n          },\n        ],\n      },\n    ],\n  },\n  optimization: {\n    minimize: true,\n    splitChunks: {\n      cacheGroups: {\n        commons: {\n          test: /node_modules/,\n          name: \"vendor\",\n          chunks: \"initial\",\n        },\n      },\n    },\n  },\n  resolve: {\n    extensions: [\".ts\", \".tsx\", \".js\", \".json\"],\n  },\n  plugins: [\n    new webpack.DefinePlugin({\n      \"process.env\": {\n        CONTENTFUL_TOKEN: JSON.stringify(process.env.CONTENTFUL_TOKEN || \"\"),\n        CONTENTFUL_SPACE_ID: JSON.stringify(\n          process.env.CONTENTFUL_SPACE_ID || \"\"\n        ),\n      },\n    }),\n  ],\n  devtool: \"inline-source-map\",\n};\n\nexport default config;"},{"type":"heading","children":[{"type":"plain","text":"mode"}],"depth":2},{"type":"paragraph","children":[{"type":"plain","text":"Mostly changes the value of "},{"type":"inlineCode","text":"process.env.NODE_ENV"},{"type":"plain","text":" on "},{"type":"inlineCode","text":"DefinePlugin"},{"type":"plain","text":". This can be set in command line parameter "},{"type":"inlineCode","text":"--mode"},{"type":"plain","text":" too. I set this to "},{"type":"inlineCode","text":"develop"},{"type":"plain","text":" and add "},{"type":"inlineCode","text":"--mode production"},{"type":"plain","text":" in scripts for production building."}]},{"type":"heading","children":[{"type":"plain","text":"entry"}],"depth":2},{"type":"paragraph","children":[{"type":"plain","text":"The starting point of the project; the root file for every other file imported or used. Likely the "},{"type":"inlineCode","text":"index.js"},{"type":"plain","text":" in "},{"type":"inlineCode","text":"src"},{"type":"plain","text":" folder for MVVM frameworks."}]},{"type":"paragraph","children":[{"type":"plain","text":"There might be multiple entry files in an optimized setup. I plan to do it in the future."}]},{"type":"heading","children":[{"type":"plain","text":"context"}],"depth":2},{"type":"paragraph","children":[{"type":"plain","text":"The reference directory for the path of entry and loaders. The default value is the webpack config file's location, so it shouldn't be a big problem without it. However, it's still recommended to set context, so the configuration is independent of its location when dealing with paths."}]},{"type":"heading","children":[{"type":"plain","text":"output"}],"depth":2},{"type":"paragraph","children":[{"type":"plain","text":"The building result. This can be very optimized and complex, but I'm only using the minimum configuration here: "},{"type":"inlineCode","text":"filename"},{"type":"plain","text":" for, well, the output filename, and "},{"type":"inlineCode","text":"path"},{"type":"plain","text":" for the output folder path."}]},{"type":"heading","children":[{"type":"plain","text":"module"}],"depth":2},{"type":"paragraph","children":[{"type":"plain","text":"Options for specifying where (target files)and how (which tool)to build the source codes. One of the most important parts of webpack configuration."}]},{"type":"heading","children":[{"type":"plain","text":"test"}],"depth":3},{"type":"paragraph","children":[{"type":"plain","text":"The paths of target files, using regular expressions."}]},{"type":"heading","children":[{"type":"plain","text":"use"}],"depth":3},{"type":"paragraph","children":[{"type":"plain","text":"The loaders for building. At default, webpack can only parse "},{"type":"inlineCode","text":".js"},{"type":"plain","text":" and "},{"type":"inlineCode","text":".json"},{"type":"plain","text":" files, so we need to add custom loaders for packaging other types of files."}]},{"type":"paragraph","children":[{"type":"plain","text":"Pass an array to use multiple loaders for the same target. The loaders' applying order depends on their order in the array: from last to first (from right to left/ from bottom to top)."}]},{"type":"paragraph","children":[{"type":"plain","text":"For packaging "},{"type":"inlineCode","text":".ts"},{"type":"plain","text":" files, you can add "},{"type":"inlineCode","text":"configFile"},{"type":"plain","text":" in "},{"type":"inlineCode","text":"use"},{"type":"plain","text":" to specifying the typescript config you want to use."}]},{"type":"heading","children":[{"type":"plain","text":"exclude"}],"depth":3},{"type":"paragraph","children":[{"type":"plain","text":"The opposite of "},{"type":"inlineCode","text":"test"},{"type":"plain","text":", specifying the file you wish not to package, like node modules."}]},{"type":"heading","children":[{"type":"plain","text":"resolve"}],"depth":2},{"type":"paragraph","children":[{"type":"plain","text":"The configurations for the modules."}]},{"type":"heading","children":[{"type":"plain","text":"extensions"}],"depth":3},{"type":"paragraph","children":[{"type":"plain","text":"The extensions for the files of the modules. Add the extensions that cover all of the files of the modules. Without this option, webpack may be unable to read some modules."}]},{"type":"heading","children":[{"type":"plain","text":"plugins"}],"depth":2},{"type":"paragraph","children":[{"type":"plain","text":"Miscellaneous tools to customize the build. I'm only adding "},{"type":"inlineCode","text":"DefinePlugin"},{"type":"plain","text":" to define the environment variables in this configuration."}]},{"type":"heading","children":[{"type":"plain","text":"devtool"}],"depth":2},{"type":"paragraph","children":[{"type":"plain","text":"Build output is suppressed and sometimes uglified. It protects the source code, but it may make debugging more difficult too."}]},{"type":"paragraph","children":[{"type":"inlineCode","text":"devtool"},{"type":"plain","text":" generates a map between the output and the source, so the console logs can display which line of the source code is causing the error."}]},{"type":"heading","children":[{"type":"plain","text":"webpack.server.config.ts"}],"depth":1},{"type":"paragraph","children":[{"type":"plain","text":"The webpack configurations for SSR server code. The idea is the same as the client part, but there are some differences too."}]},{"type":"code","lang":"ts","text":"import * as webpack from \"webpack\";\nimport { resolve } from \"path\";\nimport * as nodeExternals from \"webpack-node-externals\";\n\nconst config: webpack.Configuration = {\n  mode: \"development\",\n  entry: \"./src/server/index.ts\",\n  context: resolve(__dirname),\n  output: {\n    filename: \"server.bundle.js\",\n    path: resolve(__dirname, \"dist\", \"server\"),\n  },\n  target: \"node\",\n  node: {\n    __dirname: false,\n    __filename: false,\n  },\n  module: {\n    rules: [\n      {\n        test: /\\\\.tsx?$/,\n        exclude: /node_modules/,\n        use: [\"babel-loader\", \"ts-loader\"],\n      },\n    ],\n  },\n  resolve: {\n    extensions: [\".ts\", \".tsx\"],\n  },\n  externals: [nodeExternals()],\n  plugins: [\n    new webpack.DefinePlugin({\n      \"process.env\": {\n        CONTENTFUL_TOKEN: JSON.stringify(process.env.CONTENTFUL_TOKEN || \"\"),\n        CONTENTFUL_SPACE_ID: JSON.stringify(\n          process.env.CONTENTFUL_SPACE_ID || \"\"\n        ),\n        PORT: JSON.stringify(process.env.PORT) || 3000,\n      },\n    }),\n  ],\n};\n\nexport default config;"},{"type":"heading","children":[{"type":"plain","text":"target"}],"depth":2},{"type":"paragraph","children":[{"type":"plain","text":"The environment that the output is supposed to run on. The default value is "},{"type":"inlineCode","text":"web"},{"type":"plain","text":", which is the browser-like environment. For the nodejs applications, use "},{"type":"inlineCode","text":"node"},{"type":"plain","text":"."}]},{"type":"heading","children":[{"type":"plain","text":"externals"}],"depth":2},{"type":"paragraph","children":[{"type":"plain","text":"Excludes modules that are expected to be provided in the running environment. I use this to exclude node modules."}]},{"type":"heading","children":[{"type":"plain","text":"node"}],"depth":2},{"type":"paragraph","children":[{"type":"plain","text":"Configurations for the node-related parts in the source. I set "},{"type":"inlineCode","text":"__dirname"},{"type":"plain","text":" and "},{"type":"inlineCode","text":"__filename"},{"type":"plain","text":" so these two's behaviors are not changed during building."}]}],"postMetadata":{"id":"refactor-blog-1-webpack","title":"Refactor Blog: (1) Webpack","description":"In this year's annual blog refactoring, I withdrew from using boilerplate build tools and configured Webpack myself.","category":"retrospective","topic":"web development","tags":[],"publishDate":"2021-03-09","pathname":"refactor-blog-1-webpack"},"last5posts":[{"id":"blogging-and-digital-gardening","title":"Blogging and Digital Gardening in the Social Platform and Generative AI Era","description":"I talk to myself about why bother writing at somewhere nobody comes.","category":"essay","topic":"life","tags":[],"publishDate":"2025-02-11","pathname":"blogging-and-digital-gardening"},{"id":"a-redemption-three-years-later","title":"A Redemption Three Years Later","description":"CD PROJEKT RED made a promise about Night City, which they broke. Three years later they had another attempt, and to me, it was their redemption.","category":"review","topic":"gaming","tags":[],"publishDate":"2025-01-13","pathname":"a-redemption-three-years-later"},{"id":"s14-recap","title":"S14 Recap","description":"I did not play a lot of league during 2024, but I had a few unforgettable moments nonetheless.","category":"retrospective","topic":"gaming","tags":[],"publishDate":"2025-01-07","pathname":"s14-recap"},{"id":"thoughts-on-building-a-game-with-xstate","title":"Thoughts on Building a Game with XState","description":"After hearing about XState's good reputation for years, I used it to build the prototype for my game. These are my thoughts.","category":"note","topic":"game development","tags":[],"publishDate":"2025-01-04","pathname":"thoughts-on-building-a-game-with-xstate"},{"id":"under-the-hood-diablo-ii-item-generation","title":"Under the Hood: Diablo II Item Generation","description":"A system design research turned into a reconciliation with a game I didn't know I was so in love with, so I wrote a research note to express my appreciation.","category":"research","topic":"game development","tags":[],"publishDate":"2024-11-08","pathname":"under-the-hood-diablo-ii-item-generation"}],"categoryPosts":[{"id":"s14-recap","title":"S14 Recap","description":"I did not play a lot of league during 2024, but I had a few unforgettable moments nonetheless.","category":"retrospective","topic":"gaming","tags":[],"publishDate":"2025-01-07","pathname":"s14-recap"},{"id":"site-patch-notes-2024-redesign","title":"Site Patch Notes: 2024 Redesign","description":"The 2024 redesign is finally here! I went on a journey of learning editorial design, and did an overhaul to this site's design, both functionality-wise and visual-wise.","category":"retrospective","topic":"meta","tags":[],"publishDate":"2024-08-18","pathname":"site-patch-notes-2024-redesign"},{"id":"4-years-reflection","title":"4 Years Reflection","description":"Another two years of life as a full-time developer has passed. Many things changed and many lessons learned. It's a perfect timing to look back and reflect.","category":"retrospective","topic":"career","tags":[],"publishDate":"2024-04-08","pathname":"4-years-reflection"},{"id":"s13-recap","title":"S13 Recap","description":"After a three years gap, I'm back to league.","category":"retrospective","topic":"gaming","tags":[],"publishDate":"2024-01-23","pathname":"s13-recap"},{"id":"refactor-blog-2023-markdown-based-content","title":"Refactor Blog 2023: Markdown Based Content","description":"Embracing a different approach toward my own data, I made a change to the content hosting method of my blog.","category":"retrospective","topic":"meta","tags":[],"publishDate":"2023-06-19","pathname":"refactor-blog-2023-markdown-based-content"}],"categories":[{"name":"essay","count":12},{"name":"review","count":15},{"name":"retrospective","count":15},{"name":"note","count":9},{"name":"research","count":3}]},"__N_SSG":true},"page":"/blog/[pathname]","query":{"pathname":"refactor-blog-1-webpack"},"buildId":"NwEjpMHb8jAY4XF0V-9Qp","isFallback":false,"gsp":true,"scriptLoader":[]}</script><script>(function(){var el=document.createElement('link');el.href='/subfont/fallback-7029f17ef4.css';el.rel='stylesheet';document.body.appendChild(el)}())</script><noscript><link rel="stylesheet" href="/subfont/fallback-7029f17ef4.css"></noscript></body></html>