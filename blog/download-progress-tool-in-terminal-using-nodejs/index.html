<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>Download Progress Tool in Terminal Using Node.JS | Asuka Wang</title><meta name="description" content="Asuka Wang&#x27;s blog"/><meta property="og:title" content="Download Progress Tool in Terminal Using Node.JS | Asuka Wang"/><meta property="twitter:title" content="Download Progress Tool in Terminal Using Node.JS | Asuka Wang"/><meta name="next-head-count" content="6"/><link rel="preconnect" href="/" crossorigin="anonymous"/><script id="theme-document" data-nscript="beforeInteractive">
        if (typeof window !== "undefined") {
          const savedTheme = localStorage.getItem("ASUKACHIKARU_THEME");
          const html = document.documentElement;
          const systemTheme = window.matchMedia('(prefers-color-scheme: dark)').matches
            ? 'DARK'
            : 'LIGHT';
          if (savedTheme === "DARK" || systemTheme === "DARK") {
            html.classList.add('dark');
            html.style.backgroundColor = "#27211F";
          } else {
            html.classList.remove('dark');
            html.style.backgroundColor = "#F5F2E8";
          }
        }
      </script><link rel="preload" href="/_next/static/css/37c41217e71a4ebc.css" as="style"/><link rel="stylesheet" href="/_next/static/css/37c41217e71a4ebc.css" data-n-g=""/><link rel="preload" href="/_next/static/css/d8403707d10b0477.css" as="style"/><link rel="stylesheet" href="/_next/static/css/d8403707d10b0477.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-b8f8d6679aaa5f42.js" defer=""></script><script src="/_next/static/chunks/framework-114634acb84f8baa.js" defer=""></script><script src="/_next/static/chunks/main-f2ca60db2beb93ed.js" defer=""></script><script src="/_next/static/chunks/pages/_app-e93b23f29c9aa536.js" defer=""></script><script src="/_next/static/chunks/542-7be5b5539309fe0b.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5Bpathname%5D-d22eb341f0d05e6a.js" defer=""></script><script src="/_next/static/Ac-vQDU3EoLxvNmS8Qqlb/_buildManifest.js" defer=""></script><script src="/_next/static/Ac-vQDU3EoLxvNmS8Qqlb/_ssgManifest.js" defer=""></script></head><body><div id="__next"><main class="__variable_e0546c font-serif"><div class="text-dark bg-light dark:text-light dark:bg-dark"><div class="max-w-7xl mx-auto grid grid-cols-12 gap-0 lg:gap-4"><div class="mt-12 mb-6 col-span-10 col-start-2 lg:col-span-8 lg:col-start-3 grid grid-cols-10 text-center"><div class="col-start-1 col-span-10 text-xl lg:text-3xl font-extrabold">Asuka Wang</div><div class=" col-span-6 col-start-3 lg:col-span-6 lg:col-start-3 mt-4 flex justify-between leading-[32px] lg:leading-[40px] text-xs lg:text-base "><a href="/blog/">BLOG</a><a href="/snapshot/">SNAPSHOT</a><a href="/about/">ABOUT</a></div><div class="col-span-1 col-start-10 mt-4 flex justify-end"><button class="whitespace-pre text-right text-xs lg:text-sm leading-4">dark<!-- -->
<!-- -->mode</button></div><div class="col-span-10 my-2 border-t border-b h-2 border-dark dark:border-light"></div></div><div class="mb-6 col-span-10 col-start-2 lg:col-span-8 lg:col-start-3 text-center"><h1 class="mb-2 text-4xl lg:text-6xl lg:leading-tight font-extrabold">Download Progress Tool in Terminal Using Node.JS</h1><div class="text-md lg:text-xl"><span class="inline-block mr-2 pr-2 true">June 7, 2019</span></div></div><div class="col-span-10 col-start-2 lg:col-span-8 lg:col-start-3"><div class="mb-6 text-lg lg:text-xl lg:leading-8"><h2 class="mt-8 text-2xl lg:text-4xl font-semibold"><span>TL;DR:</span></h2></div><div class="mb-6 text-lg lg:text-xl lg:leading-8"><ul class="list-disc list-inside mx-8"><li><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">fs.stat</code><span>
for getting file size</span></li><li><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">readline.clearLine</code></li><li><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">readline.cursorTo(0)</code></li><li><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">process.stdout.write</code></li></ul></div><div class="mb-6 text-lg lg:text-xl lg:leading-8"><span>Combine these 3 to update command line instead of printing new line</span></div><div class="mb-6 text-lg lg:text-xl lg:leading-8"><h2 class="mt-8 text-2xl lg:text-4xl font-semibold"><span>Get file size</span></h2></div><div class="mb-6 text-lg lg:text-xl lg:leading-8"><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">fs.stat</code><span> returns an object contains several stats of the file from url you&#x27;re downloading.</span></div><div class="mb-6 text-lg lg:text-xl lg:leading-8"><a href="https://nodejs.org/api/fs.html#fs_class_fs_stats" class="text-blue-400 underline" rel="noreferrer noopener" target="_blank">Detailed explanation of fs.stat</a><span>.</span></div><div class="mb-6 text-lg lg:text-xl lg:leading-8"><span>Inside of the object, there is </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">size</code><span> property, which is obviously the size of file, in bytes.</span></div><div class="mb-6 text-lg lg:text-xl lg:leading-8"><pre class="my-6 border rounded-md text-base leading-4"><code class="font-courier language-js rounded-md">let fileSize = 0;
fs.stat(&#x27;url/to/your/file&#x27;, (stats)=&gt;{
	fileSize = stats.size;
});</code></pre></div><div class="mb-6 text-lg lg:text-xl lg:leading-8"><h2 class="mt-8 text-2xl lg:text-4xl font-semibold"><span>Get current progression</span></h2></div><div class="mb-6 text-lg lg:text-xl lg:leading-8"><span>In the response from </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">https.get</code><span> when downloading, track and add up the total length of chunks piped into </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">fs.writeStream</code><span>. This total length devided by file size is the download progression we need.</span></div><div class="mb-6 text-lg lg:text-xl lg:leading-8"><h2 class="mt-8 text-2xl lg:text-4xl font-semibold"><span>Write to terminal, but in same line</span></h2></div><div class="mb-6 text-lg lg:text-xl lg:leading-8"><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">console.log</code><span> </span><a href="https://nodejs.org/docs/v0.3.1/api/process.html#process.stdout" class="text-blue-400 underline" rel="noreferrer noopener" target="_blank">implementation</a><span> in Node is actually based on </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">process.stdout.write</code><span>. But since there&#x27;s a </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">\\n</code><span> at end of every </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">console.log</code><span>, new line is printed everytime instead of being updated. Therefore we can&#x27;t use </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">console.log</code></div><div class="mb-6 text-lg lg:text-xl lg:leading-8"><span>By combine </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">readline.clearLine</code><span> and </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">readline.cursorTo(0)</code><span>, terminal will erase the last line of currently printed line, then move cursor to the starting position. Then we can use </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">process.stdout.write</code><span> to print out current progress without </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">\\n</code><span> in </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">console.log</code><span> implementation that causes changing line.</span></div><div class="mb-6 text-lg lg:text-xl lg:leading-8"><pre class="my-6 border rounded-md text-base leading-4"><code class="font-courier language-js rounded-md">let progress = 0;
let req = https.get(&#x27;url/to/your/file&#x27;, (res, err)=&gt;{
	res.on(&#x27;data&#x27;, (chunk)=&gt;{
		progress += chunk.length;
		const dlPercentage = ((progress/fileSize)*100).toFixed(2);
		readline.clearLine(); readline.cursorTo(0);
		process.stdout.write(`Downloading... ${dlPercentage}%`);
	});
});</code></pre></div></div><div class="mt-6 mb-12 text-center col-span-12 lg:col-span-8 lg:col-start-3"><a href="https://asukachikaru.com" rel="noopener noreferrer" target="_blank">asukachikaru.com</a> <!-- -->2018-</div></div></div></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postContent":[{"type":"heading","children":[{"type":"plain","text":"TL;DR:"}],"depth":1},{"type":"list","ordered":false,"children":[{"type":"listItem","children":[{"type":"inlineCode","text":"fs.stat"},{"type":"plain","text":"\nfor getting file size"}]},{"type":"listItem","children":[{"type":"inlineCode","text":"readline.clearLine"}]},{"type":"listItem","children":[{"type":"inlineCode","text":"readline.cursorTo(0)"}]},{"type":"listItem","children":[{"type":"inlineCode","text":"process.stdout.write"}]}]},{"type":"paragraph","children":[{"type":"plain","text":"Combine these 3 to update command line instead of printing new line"}]},{"type":"heading","children":[{"type":"plain","text":"Get file size"}],"depth":1},{"type":"paragraph","children":[{"type":"inlineCode","text":"fs.stat"},{"type":"plain","text":" returns an object contains several stats of the file from url you're downloading."}]},{"type":"paragraph","children":[{"type":"link","text":"Detailed explanation of fs.stat","url":"https://nodejs.org/api/fs.html#fs_class_fs_stats"},{"type":"plain","text":"."}]},{"type":"paragraph","children":[{"type":"plain","text":"Inside of the object, there is "},{"type":"inlineCode","text":"size"},{"type":"plain","text":" property, which is obviously the size of file, in bytes."}]},{"type":"code","lang":"js","text":"let fileSize = 0;\nfs.stat('url/to/your/file', (stats)=\u003e{\n\tfileSize = stats.size;\n});"},{"type":"heading","children":[{"type":"plain","text":"Get current progression"}],"depth":1},{"type":"paragraph","children":[{"type":"plain","text":"In the response from "},{"type":"inlineCode","text":"https.get"},{"type":"plain","text":" when downloading, track and add up the total length of chunks piped into "},{"type":"inlineCode","text":"fs.writeStream"},{"type":"plain","text":". This total length devided by file size is the download progression we need."}]},{"type":"heading","children":[{"type":"plain","text":"Write to terminal, but in same line"}],"depth":1},{"type":"paragraph","children":[{"type":"inlineCode","text":"console.log"},{"type":"plain","text":" "},{"type":"link","text":"implementation","url":"https://nodejs.org/docs/v0.3.1/api/process.html#process.stdout"},{"type":"plain","text":" in Node is actually based on "},{"type":"inlineCode","text":"process.stdout.write"},{"type":"plain","text":". But since there's a "},{"type":"inlineCode","text":"\\\\n"},{"type":"plain","text":" at end of every "},{"type":"inlineCode","text":"console.log"},{"type":"plain","text":", new line is printed everytime instead of being updated. Therefore we can't use "},{"type":"inlineCode","text":"console.log"}]},{"type":"paragraph","children":[{"type":"plain","text":"By combine "},{"type":"inlineCode","text":"readline.clearLine"},{"type":"plain","text":" and "},{"type":"inlineCode","text":"readline.cursorTo(0)"},{"type":"plain","text":", terminal will erase the last line of currently printed line, then move cursor to the starting position. Then we can use "},{"type":"inlineCode","text":"process.stdout.write"},{"type":"plain","text":" to print out current progress without "},{"type":"inlineCode","text":"\\\\n"},{"type":"plain","text":" in "},{"type":"inlineCode","text":"console.log"},{"type":"plain","text":" implementation that causes changing line."}]},{"type":"code","lang":"js","text":"let progress = 0;\nlet req = https.get('url/to/your/file', (res, err)=\u003e{\n\tres.on('data', (chunk)=\u003e{\n\t\tprogress += chunk.length;\n\t\tconst dlPercentage = ((progress/fileSize)*100).toFixed(2);\n\t\treadline.clearLine(); readline.cursorTo(0);\n\t\tprocess.stdout.write(`Downloading... ${dlPercentage}%`);\n\t});\n});"}],"postSummary":{"id":"download-progress-tool-in-terminal-using-nodejs","title":"Download Progress Tool in Terminal Using Node.JS","category":"JavaScript","language":["en-US"],"tags":["Node.js","Terminal"],"publishDate":"2019-06-07","pathname":"download-progress-tool-in-terminal-using-nodejs","zhTwLink":null,"filename":"Download progress tool in terminal using Node.JS (blog)"}},"__N_SSG":true},"page":"/blog/[pathname]","query":{"pathname":"download-progress-tool-in-terminal-using-nodejs"},"buildId":"Ac-vQDU3EoLxvNmS8Qqlb","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>