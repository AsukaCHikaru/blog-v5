<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>Download Progress Tool in Terminal Using Node.JS | The work is undone.</title><meta name="description" content="asukachikaru&#x27;s blog"/><meta property="og:title" content="Download Progress Tool in Terminal Using Node.JS | The work is undone."/><meta property="twitter:title" content="Download Progress Tool in Terminal Using Node.JS | The work is undone."/><meta name="next-head-count" content="6"/><link rel="preconnect" href="/" crossorigin="anonymous"/><link rel="preload" href="/_next/static/css/3f14b923204890a1.css" as="style"/><link rel="stylesheet" href="/_next/static/css/3f14b923204890a1.css" data-n-g=""/><link rel="preload" href="/_next/static/css/d8403707d10b0477.css" as="style"/><link rel="stylesheet" href="/_next/static/css/d8403707d10b0477.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-b8f8d6679aaa5f42.js" defer=""></script><script src="/_next/static/chunks/framework-114634acb84f8baa.js" defer=""></script><script src="/_next/static/chunks/main-f2ca60db2beb93ed.js" defer=""></script><script src="/_next/static/chunks/pages/_app-17babe11a04a8b75.js" defer=""></script><script src="/_next/static/chunks/118-9f8d344ce3900aa3.js" defer=""></script><script src="/_next/static/chunks/pages/post/%5Bpathname%5D-ae7676ded4422893.js" defer=""></script><script src="/_next/static/y6fsH4Oeuc4QFYGMk-xHa/_buildManifest.js" defer=""></script><script src="/_next/static/y6fsH4Oeuc4QFYGMk-xHa/_ssgManifest.js" defer=""></script></head><body><div id="__next"><main class="__variable_cfcccd font-serif"><div class="max-w-7xl mx-auto grid grid-cols-12 gap-0 lg:gap-4"><div class="my-12 col-span-10 col-start-2 lg:col-span-7 lg:col-start-3"><h1 class="mb-2 text-3xl lg:text-6xl font-extrabold">Download Progress Tool in Terminal Using Node.JS</h1><div class="text-md lg:text-xl"><span class="inline-block mr-2 pr-2 true">Jun. 07, 2019</span></div></div><div class="col-span-10 col-start-2 lg:col-span-7 lg:col-start-3"><div class="mb-6 text-lg lg:text-xl lg:leading-8"><h2 class="mt-8 text-2xl lg:text-4xl font-semibold"><span>TL;DR:</span></h2></div><div class="mb-6 text-lg lg:text-xl lg:leading-8"><ul class="list-disc list-inside mx-8"><li><span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">fs.stat</code><span>
for getting file size</span></span></li><li><span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">readline.clearLine</code></span></li><li><span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">readline.cursorTo(0)</code></span></li><li><span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">process.stdout.write</code></span></li></ul></div><div class="mb-6 text-lg lg:text-xl lg:leading-8"><span><span>Combine these 3 to update command line instead of printing new line</span></span></div><div class="mb-6 text-lg lg:text-xl lg:leading-8"><h2 class="mt-8 text-2xl lg:text-4xl font-semibold"><span>Get file size</span></h2></div><div class="mb-6 text-lg lg:text-xl lg:leading-8"><span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">fs.stat</code><span> returns an object contains several stats of the file from url you&#x27;re downloading.</span></span></div><div class="mb-6 text-lg lg:text-xl lg:leading-8"><span><a href="https://nodejs.org/api/fs.html#fs_class_fs_stats" class="text-blue-400 underline" rel="noreferrer noopener" target="_blank"><span>Detailed explanation of fs.stat</span></a><span>.</span></span></div><div class="mb-6 text-lg lg:text-xl lg:leading-8"><span><span>Inside of the object, there is </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">size</code><span> property, which is obviously the size of file, in bytes.</span></span></div><div class="mb-6 text-lg lg:text-xl lg:leading-8"><pre class="my-6 border rounded-md text-base leading-4"><code class="font-courier language-js rounded-md">let fileSize = 0;
fs.stat(&#x27;url/to/your/file&#x27;, (stats)=&gt;{
	fileSize = stats.size;
});</code></pre></div><div class="mb-6 text-lg lg:text-xl lg:leading-8"><h2 class="mt-8 text-2xl lg:text-4xl font-semibold"><span>Get current progression</span></h2></div><div class="mb-6 text-lg lg:text-xl lg:leading-8"><span><span>In the response from </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">https.get</code><span> when downloading, track and add up the total length of chunks piped into </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">fs.writeStream</code><span>. This total length devided by file size is the download progression we need.</span></span></div><div class="mb-6 text-lg lg:text-xl lg:leading-8"><h2 class="mt-8 text-2xl lg:text-4xl font-semibold"><span>Write to terminal, but in same line</span></h2></div><div class="mb-6 text-lg lg:text-xl lg:leading-8"><span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">console.log</code><span> </span><a href="https://nodejs.org/docs/v0.3.1/api/process.html#process.stdout" class="text-blue-400 underline" rel="noreferrer noopener" target="_blank"><span>implementation</span></a><span> in Node is actually based on </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">process.stdout.write</code><span>. But since there&#x27;s a </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">\\n</code><span> at end of every </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">console.log</code><span>, new line is printed everytime instead of being updated. Therefore we can&#x27;t use </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">console.log</code></span></div><div class="mb-6 text-lg lg:text-xl lg:leading-8"><span><span>By combine </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">readline.clearLine</code><span> and </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">readline.cursorTo(0)</code><span>, terminal will erase the last line of currently printed line, then move cursor to the starting position. Then we can use </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">process.stdout.write</code><span> to print out current progress without </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">\\n</code><span> in </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">console.log</code><span> implementation that causes changing line.</span></span></div><div class="mb-6 text-lg lg:text-xl lg:leading-8"><pre class="my-6 border rounded-md text-base leading-4"><code class="font-courier language-js rounded-md">let progress = 0;
let req = https.get(&#x27;url/to/your/file&#x27;, (res, err)=&gt;{
	res.on(&#x27;data&#x27;, (chunk)=&gt;{
		progress += chunk.length;
		const dlPercentage = ((progress/fileSize)*100).toFixed(2);
		readline.clearLine(); readline.cursorTo(0);
		process.stdout.write(`Downloading... ${dlPercentage}%`);
	});
});</code></pre></div></div><div class="mt-16 mb-5 text-center col-span-12 lg:col-span-8 lg:col-start-3"><a href="https://asukachikaru.com" rel="noopener noreferrer" target="_blank">asukachikaru.com</a> <!-- -->2018-</div></div></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postContent":[{"type":"heading","depth":1,"children":[{"type":"text","value":"TL;DR:","position":{"start":{"line":11,"column":3,"offset":299},"end":{"line":11,"column":9,"offset":305}}}]},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"fs.stat","position":{"start":{"line":13,"column":3,"offset":309},"end":{"line":13,"column":12,"offset":318}}},{"type":"text","value":"\nfor getting file size","position":{"start":{"line":13,"column":12,"offset":318},"end":{"line":14,"column":23,"offset":341}}}],"position":{"start":{"line":13,"column":3,"offset":309},"end":{"line":14,"column":23,"offset":341}}}],"position":{"start":{"line":13,"column":1,"offset":307},"end":{"line":14,"column":23,"offset":341}}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"readline.clearLine","position":{"start":{"line":15,"column":3,"offset":344},"end":{"line":15,"column":23,"offset":364}}}],"position":{"start":{"line":15,"column":3,"offset":344},"end":{"line":15,"column":23,"offset":364}}}],"position":{"start":{"line":15,"column":1,"offset":342},"end":{"line":15,"column":23,"offset":364}}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"readline.cursorTo(0)","position":{"start":{"line":16,"column":3,"offset":367},"end":{"line":16,"column":25,"offset":389}}}],"position":{"start":{"line":16,"column":3,"offset":367},"end":{"line":16,"column":25,"offset":389}}}],"position":{"start":{"line":16,"column":1,"offset":365},"end":{"line":16,"column":25,"offset":389}}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"process.stdout.write","position":{"start":{"line":17,"column":3,"offset":392},"end":{"line":17,"column":25,"offset":414}}}],"position":{"start":{"line":17,"column":3,"offset":392},"end":{"line":17,"column":25,"offset":414}}}],"position":{"start":{"line":17,"column":1,"offset":390},"end":{"line":17,"column":25,"offset":414}}}]},{"type":"paragraph","children":[{"type":"text","value":"Combine these 3 to update command line instead of printing new line","position":{"start":{"line":19,"column":1,"offset":416},"end":{"line":19,"column":68,"offset":483}}}]},{"type":"heading","depth":1,"children":[{"type":"text","value":"Get file size","position":{"start":{"line":21,"column":3,"offset":487},"end":{"line":21,"column":16,"offset":500}}}]},{"type":"paragraph","children":[{"type":"inlineCode","value":"fs.stat","position":{"start":{"line":23,"column":1,"offset":502},"end":{"line":23,"column":10,"offset":511}}},{"type":"text","value":" returns an object contains several stats of the file from url you're downloading.","position":{"start":{"line":23,"column":10,"offset":511},"end":{"line":23,"column":92,"offset":593}}}]},{"type":"paragraph","children":[{"type":"link","title":null,"url":"https://nodejs.org/api/fs.html#fs_class_fs_stats","children":[{"type":"text","value":"Detailed explanation of fs.stat","position":{"start":{"line":25,"column":2,"offset":596},"end":{"line":25,"column":33,"offset":627}}}],"position":{"start":{"line":25,"column":1,"offset":595},"end":{"line":25,"column":84,"offset":678}}},{"type":"text","value":".","position":{"start":{"line":25,"column":84,"offset":678},"end":{"line":25,"column":85,"offset":679}}}]},{"type":"paragraph","children":[{"type":"text","value":"Inside of the object, there is ","position":{"start":{"line":27,"column":1,"offset":681},"end":{"line":27,"column":32,"offset":712}}},{"type":"inlineCode","value":"size","position":{"start":{"line":27,"column":32,"offset":712},"end":{"line":27,"column":38,"offset":718}}},{"type":"text","value":" property, which is obviously the size of file, in bytes.","position":{"start":{"line":27,"column":38,"offset":718},"end":{"line":27,"column":95,"offset":775}}}]},{"type":"code","lang":"js","meta":null,"value":"let fileSize = 0;\nfs.stat('url/to/your/file', (stats)=\u003e{\n\tfileSize = stats.size;\n});"},{"type":"heading","depth":1,"children":[{"type":"text","value":"Get current progression","position":{"start":{"line":36,"column":3,"offset":875},"end":{"line":36,"column":26,"offset":898}}}]},{"type":"paragraph","children":[{"type":"text","value":"In the response from ","position":{"start":{"line":38,"column":1,"offset":900},"end":{"line":38,"column":22,"offset":921}}},{"type":"inlineCode","value":"https.get","position":{"start":{"line":38,"column":22,"offset":921},"end":{"line":38,"column":33,"offset":932}}},{"type":"text","value":" when downloading, track and add up the total length of chunks piped into ","position":{"start":{"line":38,"column":33,"offset":932},"end":{"line":38,"column":107,"offset":1006}}},{"type":"inlineCode","value":"fs.writeStream","position":{"start":{"line":38,"column":107,"offset":1006},"end":{"line":38,"column":123,"offset":1022}}},{"type":"text","value":". This total length devided by file size is the download progression we need.","position":{"start":{"line":38,"column":123,"offset":1022},"end":{"line":38,"column":200,"offset":1099}}}]},{"type":"heading","depth":1,"children":[{"type":"text","value":"Write to terminal, but in same line","position":{"start":{"line":40,"column":3,"offset":1103},"end":{"line":40,"column":38,"offset":1138}}}]},{"type":"paragraph","children":[{"type":"inlineCode","value":"console.log","position":{"start":{"line":42,"column":1,"offset":1140},"end":{"line":42,"column":14,"offset":1153}}},{"type":"text","value":" ","position":{"start":{"line":42,"column":14,"offset":1153},"end":{"line":42,"column":15,"offset":1154}}},{"type":"link","title":null,"url":"https://nodejs.org/docs/v0.3.1/api/process.html#process.stdout","children":[{"type":"text","value":"implementation","position":{"start":{"line":42,"column":16,"offset":1155},"end":{"line":42,"column":30,"offset":1169}}}],"position":{"start":{"line":42,"column":15,"offset":1154},"end":{"line":42,"column":95,"offset":1234}}},{"type":"text","value":" in Node is actually based on ","position":{"start":{"line":42,"column":95,"offset":1234},"end":{"line":42,"column":125,"offset":1264}}},{"type":"inlineCode","value":"process.stdout.write","position":{"start":{"line":42,"column":125,"offset":1264},"end":{"line":42,"column":147,"offset":1286}}},{"type":"text","value":". But since there's a ","position":{"start":{"line":42,"column":147,"offset":1286},"end":{"line":42,"column":169,"offset":1308}}},{"type":"inlineCode","value":"\\\\n","position":{"start":{"line":42,"column":169,"offset":1308},"end":{"line":42,"column":174,"offset":1313}}},{"type":"text","value":" at end of every ","position":{"start":{"line":42,"column":174,"offset":1313},"end":{"line":42,"column":191,"offset":1330}}},{"type":"inlineCode","value":"console.log","position":{"start":{"line":42,"column":191,"offset":1330},"end":{"line":42,"column":204,"offset":1343}}},{"type":"text","value":", new line is printed everytime instead of being updated. Therefore we can't use ","position":{"start":{"line":42,"column":204,"offset":1343},"end":{"line":42,"column":285,"offset":1424}}},{"type":"inlineCode","value":"console.log","position":{"start":{"line":42,"column":285,"offset":1424},"end":{"line":42,"column":298,"offset":1437}}}]},{"type":"paragraph","children":[{"type":"text","value":"By combine ","position":{"start":{"line":44,"column":1,"offset":1439},"end":{"line":44,"column":12,"offset":1450}}},{"type":"inlineCode","value":"readline.clearLine","position":{"start":{"line":44,"column":12,"offset":1450},"end":{"line":44,"column":32,"offset":1470}}},{"type":"text","value":" and ","position":{"start":{"line":44,"column":32,"offset":1470},"end":{"line":44,"column":37,"offset":1475}}},{"type":"inlineCode","value":"readline.cursorTo(0)","position":{"start":{"line":44,"column":37,"offset":1475},"end":{"line":44,"column":59,"offset":1497}}},{"type":"text","value":", terminal will erase the last line of currently printed line, then move cursor to the starting position. Then we can use ","position":{"start":{"line":44,"column":59,"offset":1497},"end":{"line":44,"column":181,"offset":1619}}},{"type":"inlineCode","value":"process.stdout.write","position":{"start":{"line":44,"column":181,"offset":1619},"end":{"line":44,"column":203,"offset":1641}}},{"type":"text","value":" to print out current progress without ","position":{"start":{"line":44,"column":203,"offset":1641},"end":{"line":44,"column":242,"offset":1680}}},{"type":"inlineCode","value":"\\\\n","position":{"start":{"line":44,"column":242,"offset":1680},"end":{"line":44,"column":247,"offset":1685}}},{"type":"text","value":" in ","position":{"start":{"line":44,"column":247,"offset":1685},"end":{"line":44,"column":251,"offset":1689}}},{"type":"inlineCode","value":"console.log","position":{"start":{"line":44,"column":251,"offset":1689},"end":{"line":44,"column":264,"offset":1702}}},{"type":"text","value":" implementation that causes changing line.","position":{"start":{"line":44,"column":264,"offset":1702},"end":{"line":44,"column":306,"offset":1744}}}]},{"type":"code","lang":"js","meta":null,"value":"let progress = 0;\nlet req = https.get('url/to/your/file', (res, err)=\u003e{\n\tres.on('data', (chunk)=\u003e{\n\t\tprogress += chunk.length;\n\t\tconst dlPercentage = ((progress/fileSize)*100).toFixed(2);\n\t\treadline.clearLine(); readline.cursorTo(0);\n\t\tprocess.stdout.write(`Downloading... ${dlPercentage}%`);\n\t});\n});"}],"postSummary":{"id":"download-progress-tool-in-terminal-using-nodejs","title":"Download Progress Tool in Terminal Using Node.JS","category":"JavaScript","language":["en-US"],"tags":["Node.js","Terminal"],"publishDate":"2019-06-07","pathname":"download-progress-tool-in-terminal-using-nodejs","zhTwLink":null,"filename":"Download progress tool in terminal using Node.JS (blog)"}},"__N_SSG":true},"page":"/post/[pathname]","query":{"pathname":"download-progress-tool-in-terminal-using-nodejs"},"buildId":"y6fsH4Oeuc4QFYGMk-xHa","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>