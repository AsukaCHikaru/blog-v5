<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>Full-Screen Scroll | Asuka Wang</title><meta name="description" content="Asuka Wang&#x27;s blog"/><meta property="og:title" content="Full-Screen Scroll | Asuka Wang"/><meta property="twitter:title" content="Full-Screen Scroll | Asuka Wang"/><meta name="next-head-count" content="6"/><link rel="preconnect" href="/" crossorigin="anonymous"/><script id="theme-document" data-nscript="beforeInteractive">
        if (typeof window !== "undefined") {
          const savedTheme = localStorage.getItem("ASUKACHIKARU_THEME");
          const html = document.documentElement;
          const systemTheme = window.matchMedia('(prefers-color-scheme: dark)').matches
            ? 'DARK'
            : 'LIGHT';
          if (savedTheme === "DARK" || systemTheme === "DARK") {
            html.classList.add('dark');
            html.style.backgroundColor = "#27211F";
          } else {
            html.classList.remove('dark');
            html.style.backgroundColor = "#F5F2E8";
          }
        }
      </script><link rel="preload" href="/_next/static/css/411e8f07e13c70fa.css" as="style"/><link rel="stylesheet" href="/_next/static/css/411e8f07e13c70fa.css" data-n-g=""/><link rel="preload" href="/_next/static/css/d8403707d10b0477.css" as="style"/><link rel="stylesheet" href="/_next/static/css/d8403707d10b0477.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-b8f8d6679aaa5f42.js" defer=""></script><script src="/_next/static/chunks/framework-114634acb84f8baa.js" defer=""></script><script src="/_next/static/chunks/main-f2ca60db2beb93ed.js" defer=""></script><script src="/_next/static/chunks/pages/_app-ba071d4eaf9a2c50.js" defer=""></script><script src="/_next/static/chunks/542-7be5b5539309fe0b.js" defer=""></script><script src="/_next/static/chunks/986-347b45c0cb7e6276.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5Bpathname%5D-25a78fdd03cb7e80.js" defer=""></script><script src="/_next/static/Ct-zOyv_Ohd6ncbBqnMnN/_buildManifest.js" defer=""></script><script src="/_next/static/Ct-zOyv_Ohd6ncbBqnMnN/_ssgManifest.js" defer=""></script></head><body><div id="__next"><main class="
        __variable_e0546c
        __variable_9d551b
        __variable_ef4fb7
        __variable_23fcf6
        __variable_6fb08b
        __variable_4de8ae
        font-serif"><div class="text-color"><div class="mx-fb2 lg:mx-auto max-w-[1280px]"><div class="mt-fb1 lg:mt-fb2"><div class="flex justify-end"><button class="font-noto-sans text-fb2 interactive-color">dark mode</button></div><div class="flex justify-between w-full mt-fb8 mb-fb2"><div class="w-fit flex flex-col lg:flex-row gap-fb1 lg:gap-fb3"><a class="text-fb2 lg:text-fb3 leading-fb3 lg:leading-fb5 interactive-color text-color" href="/blog/">BLOG</a><a class="text-fb2 lg:text-fb3 leading-fb3 lg:leading-fb5 interactive-color " href="/about/">ABOUT</a></div><a class="text-fb3 lg:text-fb5 leading-none font-abhaya-libre font-bold" href="/">ASUKA WANG</a></div><div class="mb-fb2 lg:mb-fb3 border-t-2 border-b h-2 border-color-100"></div></div><div><div class="flex flex-col gap-fb1 mb-fb5 lg:mb-fb8"><h1 class="text-fb8 lg:text-fb13 font-abril leading-none">FULL-SCREEN SCROLL</h1><div class="text-fb2 lg:text-fb3 font-noto-sans">February 11, 2021</div></div><div class="w-full grid grid-cols-4 gap-fb3"><div class="col-span-4 lg:col-span-3"><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><h3 class="mt-8 text-xl lg:text-3xl font-semibold" id="TL;DR:"><span>TL;DR:</span></h3></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><ul class="list-disc list-inside mx-8"><li><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">overflow-y: hidden</code><span> for html and body, and </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">overflow-y: scroll</code><span> for the scroller element</span></li><li><span>Use recursive </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">window.requestAnimationFrame</code><span> to set </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">scrollTop</code></li></ul></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><span>In my latest project </span><a href="https://2020.musicawards.asukachikaru.com/" class="text-blue-400 underline" rel="noreferrer noopener" target="_blank">CHIKA Music Awards 2020</a><span> I focused more on user experience and visual effects. One of the features I used to achieve that was full-screen scrolling.</span></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><span>First, let&#x27;s talk about the definition of full-screen scrolling. In short, it looks like this:</span></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><img alt="" src="[full-screen-scroll_1.gif]" width="500" height="500" decoding="async" data-nimg="1" class="mx-auto px-4 py-2" loading="lazy" style="color:transparent"/></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><span>And the literal definition of full-screen scrolling includes the below specs:</span></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><ul class="list-disc list-inside mx-8"><li><span>Triggered by scroll or touchmove events</span></li><li><span>The scroll distance equal to visible area height</span></li><li><span>Smooth scrolling</span></li><li><span>Scroll exactly one page every time, no scroll momentum</span></li></ul></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><span>Some libraries have taken care of the problem for me, but as a side project, I try to challenge myself as much as possible instead of only focusing on getting things done. So I implemented full-page scrolling from scratch. I used Vue3 for this project, but the idea should be universal.</span></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><h3 class="mt-8 text-xl lg:text-3xl font-semibold" id="Triggering-the-event"><span>Triggering the event</span></h3></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><span>Obviously, we need </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">scroll</code><span> event. But in mobile devices, we should use </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">touchmove</code><span> event.</span></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><span>The concept of detecting the scrolling direction is simple: when the event fires for the first time, save the scroller element </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">scrollTop</code><span> value (or the touch </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">screenY</code><span> value in the </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">touchmove</code><span> event). During the second time, compare the values to the previous ones.</span></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><pre class="my-6 border rounded-md text-base leading-4"><code class="font-courier language-js rounded-md">// Add event listener. Or you can bind them to the component directly in Vue or React
document.querySelector(&#x27;.scroll&#x27;).addEventListener(&#x27;scroll&#x27;, handleScroll);

// Necessary variables for the event callback.
// I placed them here for clarity.
// Place them anywhere that fits the architecture of your project.
let scroller; // the scroller element
let currentY; // the current scrollTop of the scroller
let currentPageY; // the y value of the current page
let scrollDirection; // 1 or -1
let isScrolling;

// The event callback
const handleScroll = (e) =&gt; {
  // for scroll we don&#x27;t need the event argument,
  // but for touchmove event callback we have to use it for the touch y value
  if (!scroller) {
    return;
  }
  
  currentY = scroller.scrollTop;
  // currentY = e.touches[0].screenY; for touchmove

  if (!isScrolling &amp;&amp; currentY !== currentPageY) {
    if (currentY &gt; currentPageY) {
      scrollDirection = -1;
    }
    if (currentY &lt; currentPageY) {
      scrollDirection = 1;
    }
    isScrolling = true;
    window.requestAnimationFrame(scrollTo);
  }
}</code></pre></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><h3 class="mt-8 text-xl lg:text-3xl font-semibold" id="Get-scroll-height"><span>Get scroll height</span></h3></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><span>First, prepare a scroller element. The scroller should contain all of the contents, and the height should be 100% of the visible area height.</span></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><span>For PC, this is easy: set the scroller&#x27;s height (and all of its ancestors&#x27;) to </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">100vh</code><span>, then get </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">window.innerHeight</code><span>, and we should be good. But for mobile devices, we have to deal with the problem that the browser address bar might hide during scrolling, which causes the visible area height to be inconsistent.</span></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><a href="https://github.com/bokand/root-scroller/blob/master/explainer.md" class="text-blue-400 underline" rel="noreferrer noopener" target="_blank">The URL bar hides when the root element scrolls down</a><span>, in which the root element means the </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">&lt;html&gt;</code><span> element. Therefore, to avoid URL bar hides during scrolling, it is necessary to prevent root element from scrolling while scrolling the contents.</span></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><span>According to the </span><a href="https://www.w3.org/TR/CSS2/visufx.html#overflow" class="text-blue-400 underline" rel="noreferrer noopener" target="_blank">standard CSS overflow definition</a><span>, by default both </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">&lt;html&gt;</code><span> and </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">&lt;body&gt;</code><span> has </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">overflow: auto</code><span>. Set both to </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">overflow: hidden</code><span> , and we locked up </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">&lt;html&gt;</code><span> and </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">&lt;body&gt;</code><span> for good.</span></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><span>The next step is to give the scroller </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">overflow: scroll</code><span>. Now when you scroll the viewport, </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">&lt;html&gt;</code><span> and </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">&lt;body&gt;</code><span> don&#x27;t move at all, only the scroller is scrolling, and the URL bar will not hide. Notice that if there are any container elements between the scroller and the body, their overflow values also need to be </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">hidden</code><span>.</span></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><pre class="my-6 border rounded-md text-base leading-4"><code class="font-courier language-css rounded-md">html {
  height: 100vh;
  overflow-y: hidden;
}

body {
  height: 100%;
  overflow-y: hidden;
}

.scroller {
  height: 100%;
  overflow-y: scroll;
}</code></pre></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><span>The visible area height should be consistent now, and we should get window height without too much trouble.</span></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><h3 class="mt-8 text-xl lg:text-3xl font-semibold" id="Smooth-scrolling"><span>Smooth scrolling</span></h3></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">.scrollTo</code><span> is initiative and efficient, but it&#x27;s not very reliable. I&#x27;ve encountered scenarios that it wouldn&#x27;t work (no effect at all). I haven&#x27;t discovered the root cause, but it feels like </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">.scrollTo</code><span> gets canceled when called too frequently.</span></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><span>I gave up the one-liner and went for another approach: </span><a href="https://developer.mozilla.org/en-US/docs/Web/API/window/requestAnimationFrame" class="text-blue-400 underline" rel="noreferrer noopener" target="_blank">window.requestAnimationFrame</a><span>. This function prepares a frame to execute all the things inside the callback. This approach is inspired by </span><a href="https://github.com/rigor789/vue-scrollto" class="text-blue-400 underline" rel="noreferrer noopener" target="_blank">vue-scrollto</a><span>.</span></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><span>The callback has a single argument timestamp: </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">DOMHighResTimeStamp</code><span>, which is essentially a number. When scroll animation starts, save the initial timestamp and then compare the timestamp in each call with the initial timestamp to determine if the elapsed time has exceeded the designated scroll animation duration. If the scroll is not finished yet, call </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">window.requestAnimationFrame</code><span> inside the callback recursively.</span></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><span>For the scroll effect, set the scroller&#x27;s scrollTop directly.</span></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">scroller.scrollTop = {the y position after each scroll step}</code></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">scroll-behavior: &quot;smooth&quot;</code><span> doesn&#x27;t apply when changing a div&#x27;s </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">scrollTop</code><span> value in this way; this is why we need to use </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">requestAnimationFrame</code><span> to create an animation.</span></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><pre class="my-6 border rounded-md text-base leading-4"><code class="font-courier language-js rounded-md">let scrollDuration;
let scrollDirection; // 1 or -1
let scrollStartTime;
let scroller;
let currentY;
let scrollDistance; // window height, likely 100vh
let isScrolling;

const scrollTo = (timestamp: DOMHighResTimeStamp) =&gt; {
  if (!scrollStartTime) {
    scrollStartTime = timestamp;
  }

  const elapsedTime = timestamp - scrollStartTime;
  const progress = Math.min(elapsedTime / scrollDuration, 1);
  scroller.scrollTop = currentY + scrollDistance * progress * scrollDirection;

	if (elapsedTime &lt; duration) {
    window.requestAnimationFrame(scrollTo);
  } else {
    currentY = scroller.scrollTop;
    scrollStartTime = undefined;
    scrollDirection = undefined;
    isScrolling = false;
  }
};</code></pre></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><h3 class="mt-8 text-xl lg:text-3xl font-semibold" id="Remove-the-momentum"><span>Remove the momentum</span></h3></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><span>When the user scrolls the screen hence triggers the </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">scroll</code><span> or </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">touchmove</code><span> event, it&#x27;s unlikely that the event only fires once. We can have the conditioning to prevent our full-screen scroll from repeatedly called, but the other scrolls caused by the user&#x27;s finger remains, even after the full-screen scroll finishes. Removing the scroll momentum is the necessary polishing for the full-screen scroll effect.</span></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><span>There are two ways to disable scroll temporarily: </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">pointerEvent: none</code><span>, and —you might have guessed it— </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">overflow: hidden</code><span>. I found overflow more reliable, for </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">pointerEvent</code><span> didn&#x27;t work in some </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">touchmove</code><span> scenario.</span></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><span>When the scroll starts (calling </span><code class="px-1 font-courier text-gray-300 bg-gray-700 rounded-sm">window.requestAnimationFrame</code><span> for the first time), add the above CSS property to the scroller element, and all the scrolls that after the first callback should take no effect. Thus we removed the momentum successfully.</span></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><hr class="my-16 w-80 mx-auto border-color"/></div><div class="mb-6 text-lg lg:text-xl lg:leading-8 last:mb-0"><span>I finished the full-screen scroll effect with the above approach. It works fine in macOS, win, and mobile platforms. I believe there are other ways to do this, but I&#x27;m quite happy with the result I came up with.</span></div></div><div class="flex-col justify-between hidden lg:flex"><div class="flex flex-col gap-fb5"><div><div class="text-fb3 py-fb1 mb-fb3 border-t border-b border-color text-center font-noto-sans font-extralight">TABLE OF CONTENT</div><ul class="ml-fb3 list-outside list-disc interactive-list-color"><li class="mt-fb2"><div class="w-fb2"></div><a class="font-serif text-fb3 leading-none interactive-color" href="/blog/[pathname]/#TL;DR:">TL;DR:</a></li><li class="mt-fb2"><div class="w-fb2"></div><a class="font-serif text-fb3 leading-none interactive-color" href="/blog/[pathname]/#Triggering-the-event">Triggering the event</a></li><li class="mt-fb2"><div class="w-fb2"></div><a class="font-serif text-fb3 leading-none interactive-color" href="/blog/[pathname]/#Get-scroll-height">Get scroll height</a></li><li class="mt-fb2"><div class="w-fb2"></div><a class="font-serif text-fb3 leading-none interactive-color" href="/blog/[pathname]/#Smooth-scrolling">Smooth scrolling</a></li><li class="mt-fb2"><div class="w-fb2"></div><a class="font-serif text-fb3 leading-none interactive-color" href="/blog/[pathname]/#Remove-the-momentum">Remove the momentum</a></li></ul></div><div><div class="text-fb3 py-fb1 mb-fb3 border-t border-b border-color text-center font-noto-sans font-extralight">ARCHIVE</div><div class="flex flex-col gap-fb3"><a class=" flex flex-col gap-fb1 interactive-color pb-fb2 border-b border-color last-of-type:border-none last-of-type:pb-0 lg:pb-0 lg:border-none " href="/blog/godot-essentials/"><div class="text-fb5 lg:text-fb3 font-abril leading-none text-wrap-balance">Godot Essentials</div><div class="text-fb3 lg:text-fb3 font-gentium-basic leading-none">The biggest lessons I learned in my first Godot project.</div><div class="text-fb2 leading-none font-noto-sans">April 21, 2024</div></a><a class=" flex flex-col gap-fb1 interactive-color pb-fb2 border-b border-color last-of-type:border-none last-of-type:pb-0 lg:pb-0 lg:border-none " href="/blog/4-years-reflection/"><div class="text-fb5 lg:text-fb3 font-abril leading-none text-wrap-balance">4 Years Reflection</div><div class="text-fb3 lg:text-fb3 font-gentium-basic leading-none">Another two years of life as a full-time developer has passed. Many things changed and many lessons learned. It&#x27;s a perfect timing to look back and reflect.</div><div class="text-fb2 leading-none font-noto-sans">April 8, 2024</div></a><a class=" flex flex-col gap-fb1 interactive-color pb-fb2 border-b border-color last-of-type:border-none last-of-type:pb-0 lg:pb-0 lg:border-none " href="/blog/improving-greatness/"><div class="text-fb5 lg:text-fb3 font-abril leading-none text-wrap-balance">Improving Greatness</div><div class="text-fb3 lg:text-fb3 font-gentium-basic leading-none">Breath of the Wild is one of the most impactful game in last decade. Yet for its successor, Nintendo built an even more polished version on an already magnificent fundamental.</div><div class="text-fb2 leading-none font-noto-sans">March 17, 2024</div></a><a class=" flex flex-col gap-fb1 interactive-color pb-fb2 border-b border-color last-of-type:border-none last-of-type:pb-0 lg:pb-0 lg:border-none " href="/blog/s13-recap/"><div class="text-fb5 lg:text-fb3 font-abril leading-none text-wrap-balance">S13 Recap</div><div class="text-fb3 lg:text-fb3 font-gentium-basic leading-none">After a three years gap, I&#x27;m back to league.</div><div class="text-fb2 leading-none font-noto-sans">January 23, 2024</div></a><a class=" flex flex-col gap-fb1 interactive-color pb-fb2 border-b border-color last-of-type:border-none last-of-type:pb-0 lg:pb-0 lg:border-none " href="/blog/refactor-blog-2023-markdown-based-content/"><div class="text-fb5 lg:text-fb3 font-abril leading-none text-wrap-balance">Refactor Blog 2023: Markdown Based Content</div><div class="text-fb3 lg:text-fb3 font-gentium-basic leading-none">Embracing a different approach toward my own data, I made a change to the content hosting method of my blog.</div><div class="text-fb2 leading-none font-noto-sans">June 19, 2023</div></a><div><a class="flex items-end lg:justify-end" href="/blog/archive/"><span class="font-noto-sans text-fb3 leading-none interactive-color">FULL LIST</span></a></div></div></div><div><div class="text-fb3 py-fb1 mb-fb3 border-t border-b border-color text-center font-noto-sans font-extralight">CATEGORY</div><div class="flex flex-col gap-fb2 lg:border-l-2 border-color lg:pl-fb2"><div><a class="flex leading-fb3 items-end interactive-color" href="/blog/archive/?category=Gaming"><span class="text-fb3 font-alegreya">Gaming</span><span class="mx-fb1 flex-grow border-b border-dashed border-color"></span><span class="text-fb3 font-noto-sans">12</span><span class="ml-fb1 text-fb2 font-noto-sans leading-none">POST<!-- -->S</span></a></div><div><a class="flex leading-fb3 items-end interactive-color" href="/blog/archive/?category=League%20of%20Legends"><span class="text-fb3 font-alegreya">League of Legends</span><span class="mx-fb1 flex-grow border-b border-dashed border-color"></span><span class="text-fb3 font-noto-sans">8</span><span class="ml-fb1 text-fb2 font-noto-sans leading-none">POST<!-- -->S</span></a></div><div><a class="flex leading-fb3 items-end interactive-color" href="/blog/archive/?category=Game%20Development"><span class="text-fb3 font-alegreya">Game Development</span><span class="mx-fb1 flex-grow border-b border-dashed border-color"></span><span class="text-fb3 font-noto-sans">5</span><span class="ml-fb1 text-fb2 font-noto-sans leading-none">POST<!-- -->S</span></a></div><div><a class="flex leading-fb3 items-end interactive-color" href="/blog/archive/?category=Life"><span class="text-fb3 font-alegreya">Life</span><span class="mx-fb1 flex-grow border-b border-dashed border-color"></span><span class="text-fb3 font-noto-sans">5</span><span class="ml-fb1 text-fb2 font-noto-sans leading-none">POST<!-- -->S</span></a></div><div><a class="flex leading-fb3 items-end interactive-color" href="/blog/archive/?category=Meta"><span class="text-fb3 font-alegreya">Meta</span><span class="mx-fb1 flex-grow border-b border-dashed border-color"></span><span class="text-fb3 font-noto-sans">4</span><span class="ml-fb1 text-fb2 font-noto-sans leading-none">POST<!-- -->S</span></a></div><div><a class="flex leading-fb3 items-end interactive-color" href="/blog/archive/?category=Web%20Development"><span class="text-fb3 font-alegreya">Web Development</span><span class="mx-fb1 flex-grow border-b border-dashed border-color"></span><span class="text-fb3 font-noto-sans">4</span><span class="ml-fb1 text-fb2 font-noto-sans leading-none">POST<!-- -->S</span></a></div><div><a class="flex leading-fb3 items-end interactive-color" href="/blog/archive/?category=HKT48"><span class="text-fb3 font-alegreya">HKT48</span><span class="mx-fb1 flex-grow border-b border-dashed border-color"></span><span class="text-fb3 font-noto-sans">4</span><span class="ml-fb1 text-fb2 font-noto-sans leading-none">POST<!-- -->S</span></a></div><div><a class="flex leading-fb3 items-end interactive-color" href="/blog/archive/?category=Programming"><span class="text-fb3 font-alegreya">Programming</span><span class="mx-fb1 flex-grow border-b border-dashed border-color"></span><span class="text-fb3 font-noto-sans">3</span><span class="ml-fb1 text-fb2 font-noto-sans leading-none">POST<!-- -->S</span></a></div><div><a class="flex leading-fb3 items-end interactive-color" href="/blog/archive/?category=Movie"><span class="text-fb3 font-alegreya">Movie</span><span class="mx-fb1 flex-grow border-b border-dashed border-color"></span><span class="text-fb3 font-noto-sans">2</span><span class="ml-fb1 text-fb2 font-noto-sans leading-none">POST<!-- -->S</span></a></div></div></div></div><div class="self-end mt-fb5"><button class="font-noto-sans text-fb3 interactive-color">TOP</button></div></div><div class="lg:hidden col-span-4 flex flex-col gap-fb3"><div class="mt-fb5 mb-fb2 border border-color"></div><div class="px-fb2"><div class="flex gap-fb2 mb-fb1"><div class="flex-grow my-auto border-t border-b border-color h-[3px]"></div><div class="font-noto-sans text-fb2 font-thin">ARCHIVE</div><div class="flex-grow my-auto border-t border-b border-color h-[3px]"></div></div><div class="flex flex-col gap-fb3"><a class=" flex flex-col gap-fb1 interactive-color pb-fb2 border-b border-color last-of-type:border-none last-of-type:pb-0 lg:pb-0 lg:border-none " href="/blog/godot-essentials/"><div class="text-fb5 lg:text-fb3 font-abril leading-none text-wrap-balance">Godot Essentials</div><div class="text-fb3 lg:text-fb3 font-gentium-basic leading-none">The biggest lessons I learned in my first Godot project.</div><div class="text-fb2 leading-none font-noto-sans">April 21, 2024</div></a><a class=" flex flex-col gap-fb1 interactive-color pb-fb2 border-b border-color last-of-type:border-none last-of-type:pb-0 lg:pb-0 lg:border-none " href="/blog/4-years-reflection/"><div class="text-fb5 lg:text-fb3 font-abril leading-none text-wrap-balance">4 Years Reflection</div><div class="text-fb3 lg:text-fb3 font-gentium-basic leading-none">Another two years of life as a full-time developer has passed. Many things changed and many lessons learned. It&#x27;s a perfect timing to look back and reflect.</div><div class="text-fb2 leading-none font-noto-sans">April 8, 2024</div></a><a class=" flex flex-col gap-fb1 interactive-color pb-fb2 border-b border-color last-of-type:border-none last-of-type:pb-0 lg:pb-0 lg:border-none " href="/blog/improving-greatness/"><div class="text-fb5 lg:text-fb3 font-abril leading-none text-wrap-balance">Improving Greatness</div><div class="text-fb3 lg:text-fb3 font-gentium-basic leading-none">Breath of the Wild is one of the most impactful game in last decade. Yet for its successor, Nintendo built an even more polished version on an already magnificent fundamental.</div><div class="text-fb2 leading-none font-noto-sans">March 17, 2024</div></a><a class=" flex flex-col gap-fb1 interactive-color pb-fb2 border-b border-color last-of-type:border-none last-of-type:pb-0 lg:pb-0 lg:border-none " href="/blog/s13-recap/"><div class="text-fb5 lg:text-fb3 font-abril leading-none text-wrap-balance">S13 Recap</div><div class="text-fb3 lg:text-fb3 font-gentium-basic leading-none">After a three years gap, I&#x27;m back to league.</div><div class="text-fb2 leading-none font-noto-sans">January 23, 2024</div></a><a class=" flex flex-col gap-fb1 interactive-color pb-fb2 border-b border-color last-of-type:border-none last-of-type:pb-0 lg:pb-0 lg:border-none " href="/blog/refactor-blog-2023-markdown-based-content/"><div class="text-fb5 lg:text-fb3 font-abril leading-none text-wrap-balance">Refactor Blog 2023: Markdown Based Content</div><div class="text-fb3 lg:text-fb3 font-gentium-basic leading-none">Embracing a different approach toward my own data, I made a change to the content hosting method of my blog.</div><div class="text-fb2 leading-none font-noto-sans">June 19, 2023</div></a><div><a class="flex items-end lg:justify-end" href="/blog/archive/"><span class="font-noto-sans text-fb3 leading-none interactive-color">FULL LIST</span></a></div></div></div><div class="px-fb2"><div class="flex gap-fb2 mb-fb1"><div class="flex-grow my-auto border-t border-b border-color h-[3px]"></div><div class="font-noto-sans text-fb2 font-thin">CATEGORY</div><div class="flex-grow my-auto border-t border-b border-color h-[3px]"></div></div><div class="flex flex-col gap-fb2 lg:border-l-2 border-color lg:pl-fb2"><div><a class="flex leading-fb3 items-end interactive-color" href="/blog/archive/?category=Gaming"><span class="text-fb3 font-alegreya">Gaming</span><span class="mx-fb1 flex-grow border-b border-dashed border-color"></span><span class="text-fb3 font-noto-sans">12</span><span class="ml-fb1 text-fb2 font-noto-sans leading-none">POST<!-- -->S</span></a></div><div><a class="flex leading-fb3 items-end interactive-color" href="/blog/archive/?category=League%20of%20Legends"><span class="text-fb3 font-alegreya">League of Legends</span><span class="mx-fb1 flex-grow border-b border-dashed border-color"></span><span class="text-fb3 font-noto-sans">8</span><span class="ml-fb1 text-fb2 font-noto-sans leading-none">POST<!-- -->S</span></a></div><div><a class="flex leading-fb3 items-end interactive-color" href="/blog/archive/?category=Game%20Development"><span class="text-fb3 font-alegreya">Game Development</span><span class="mx-fb1 flex-grow border-b border-dashed border-color"></span><span class="text-fb3 font-noto-sans">5</span><span class="ml-fb1 text-fb2 font-noto-sans leading-none">POST<!-- -->S</span></a></div><div><a class="flex leading-fb3 items-end interactive-color" href="/blog/archive/?category=Life"><span class="text-fb3 font-alegreya">Life</span><span class="mx-fb1 flex-grow border-b border-dashed border-color"></span><span class="text-fb3 font-noto-sans">5</span><span class="ml-fb1 text-fb2 font-noto-sans leading-none">POST<!-- -->S</span></a></div><div><a class="flex leading-fb3 items-end interactive-color" href="/blog/archive/?category=Meta"><span class="text-fb3 font-alegreya">Meta</span><span class="mx-fb1 flex-grow border-b border-dashed border-color"></span><span class="text-fb3 font-noto-sans">4</span><span class="ml-fb1 text-fb2 font-noto-sans leading-none">POST<!-- -->S</span></a></div><div><a class="flex leading-fb3 items-end interactive-color" href="/blog/archive/?category=Web%20Development"><span class="text-fb3 font-alegreya">Web Development</span><span class="mx-fb1 flex-grow border-b border-dashed border-color"></span><span class="text-fb3 font-noto-sans">4</span><span class="ml-fb1 text-fb2 font-noto-sans leading-none">POST<!-- -->S</span></a></div><div><a class="flex leading-fb3 items-end interactive-color" href="/blog/archive/?category=HKT48"><span class="text-fb3 font-alegreya">HKT48</span><span class="mx-fb1 flex-grow border-b border-dashed border-color"></span><span class="text-fb3 font-noto-sans">4</span><span class="ml-fb1 text-fb2 font-noto-sans leading-none">POST<!-- -->S</span></a></div><div><a class="flex leading-fb3 items-end interactive-color" href="/blog/archive/?category=Programming"><span class="text-fb3 font-alegreya">Programming</span><span class="mx-fb1 flex-grow border-b border-dashed border-color"></span><span class="text-fb3 font-noto-sans">3</span><span class="ml-fb1 text-fb2 font-noto-sans leading-none">POST<!-- -->S</span></a></div><div><a class="flex leading-fb3 items-end interactive-color" href="/blog/archive/?category=Movie"><span class="text-fb3 font-alegreya">Movie</span><span class="mx-fb1 flex-grow border-b border-dashed border-color"></span><span class="text-fb3 font-noto-sans">2</span><span class="ml-fb1 text-fb2 font-noto-sans leading-none">POST<!-- -->S</span></a></div></div></div></div></div></div><div class="mt-fb8 pt-fb2 mb-fb8 text-center lg:text-left font-noto-sans interactive-color border-t border-color"><a href="https://asukachikaru.com" rel="noopener noreferrer" target="_blank" class="text-fb2">asukachikaru.com</a> <!-- -->2018-</div></div></div></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postContent":[{"type":"heading","children":[{"type":"plain","text":"TL;DR:"}],"depth":2},{"type":"list","ordered":false,"children":[{"type":"listItem","children":[{"type":"inlineCode","text":"overflow-y: hidden"},{"type":"plain","text":" for html and body, and "},{"type":"inlineCode","text":"overflow-y: scroll"},{"type":"plain","text":" for the scroller element"}]},{"type":"listItem","children":[{"type":"plain","text":"Use recursive "},{"type":"inlineCode","text":"window.requestAnimationFrame"},{"type":"plain","text":" to set "},{"type":"inlineCode","text":"scrollTop"}]}]},{"type":"paragraph","children":[{"type":"plain","text":"In my latest project "},{"type":"link","text":"CHIKA Music Awards 2020","url":"https://2020.musicawards.asukachikaru.com/"},{"type":"plain","text":" I focused more on user experience and visual effects. One of the features I used to achieve that was full-screen scrolling."}]},{"type":"paragraph","children":[{"type":"plain","text":"First, let's talk about the definition of full-screen scrolling. In short, it looks like this:"}]},{"type":"paragraph","children":[{"type":"plain","text":"![[full-screen-scroll_1.gif]]"}]},{"type":"paragraph","children":[{"type":"plain","text":"And the literal definition of full-screen scrolling includes the below specs:"}]},{"type":"list","ordered":false,"children":[{"type":"listItem","children":[{"type":"plain","text":"Triggered by scroll or touchmove events"}]},{"type":"listItem","children":[{"type":"plain","text":"The scroll distance equal to visible area height"}]},{"type":"listItem","children":[{"type":"plain","text":"Smooth scrolling"}]},{"type":"listItem","children":[{"type":"plain","text":"Scroll exactly one page every time, no scroll momentum"}]}]},{"type":"paragraph","children":[{"type":"plain","text":"Some libraries have taken care of the problem for me, but as a side project, I try to challenge myself as much as possible instead of only focusing on getting things done. So I implemented full-page scrolling from scratch. I used Vue3 for this project, but the idea should be universal."}]},{"type":"heading","children":[{"type":"plain","text":"Triggering the event"}],"depth":2},{"type":"paragraph","children":[{"type":"plain","text":"Obviously, we need "},{"type":"inlineCode","text":"scroll"},{"type":"plain","text":" event. But in mobile devices, we should use "},{"type":"inlineCode","text":"touchmove"},{"type":"plain","text":" event."}]},{"type":"paragraph","children":[{"type":"plain","text":"The concept of detecting the scrolling direction is simple: when the event fires for the first time, save the scroller element "},{"type":"inlineCode","text":"scrollTop"},{"type":"plain","text":" value (or the touch "},{"type":"inlineCode","text":"screenY"},{"type":"plain","text":" value in the "},{"type":"inlineCode","text":"touchmove"},{"type":"plain","text":" event). During the second time, compare the values to the previous ones."}]},{"type":"code","lang":"js","text":"// Add event listener. Or you can bind them to the component directly in Vue or React\ndocument.querySelector('.scroll').addEventListener('scroll', handleScroll);\n\n// Necessary variables for the event callback.\n// I placed them here for clarity.\n// Place them anywhere that fits the architecture of your project.\nlet scroller; // the scroller element\nlet currentY; // the current scrollTop of the scroller\nlet currentPageY; // the y value of the current page\nlet scrollDirection; // 1 or -1\nlet isScrolling;\n\n// The event callback\nconst handleScroll = (e) =\u003e {\n  // for scroll we don't need the event argument,\n  // but for touchmove event callback we have to use it for the touch y value\n  if (!scroller) {\n    return;\n  }\n  \n  currentY = scroller.scrollTop;\n  // currentY = e.touches[0].screenY; for touchmove\n\n  if (!isScrolling \u0026\u0026 currentY !== currentPageY) {\n    if (currentY \u003e currentPageY) {\n      scrollDirection = -1;\n    }\n    if (currentY \u003c currentPageY) {\n      scrollDirection = 1;\n    }\n    isScrolling = true;\n    window.requestAnimationFrame(scrollTo);\n  }\n}"},{"type":"heading","children":[{"type":"plain","text":"Get scroll height"}],"depth":2},{"type":"paragraph","children":[{"type":"plain","text":"First, prepare a scroller element. The scroller should contain all of the contents, and the height should be 100% of the visible area height."}]},{"type":"paragraph","children":[{"type":"plain","text":"For PC, this is easy: set the scroller's height (and all of its ancestors') to "},{"type":"inlineCode","text":"100vh"},{"type":"plain","text":", then get "},{"type":"inlineCode","text":"window.innerHeight"},{"type":"plain","text":", and we should be good. But for mobile devices, we have to deal with the problem that the browser address bar might hide during scrolling, which causes the visible area height to be inconsistent."}]},{"type":"paragraph","children":[{"type":"link","text":"The URL bar hides when the root element scrolls down","url":"https://github.com/bokand/root-scroller/blob/master/explainer.md"},{"type":"plain","text":", in which the root element means the "},{"type":"inlineCode","text":"\u003chtml\u003e"},{"type":"plain","text":" element. Therefore, to avoid URL bar hides during scrolling, it is necessary to prevent root element from scrolling while scrolling the contents."}]},{"type":"paragraph","children":[{"type":"plain","text":"According to the "},{"type":"link","text":"standard CSS overflow definition","url":"https://www.w3.org/TR/CSS2/visufx.html#overflow"},{"type":"plain","text":", by default both "},{"type":"inlineCode","text":"\u003chtml\u003e"},{"type":"plain","text":" and "},{"type":"inlineCode","text":"\u003cbody\u003e"},{"type":"plain","text":" has "},{"type":"inlineCode","text":"overflow: auto"},{"type":"plain","text":". Set both to "},{"type":"inlineCode","text":"overflow: hidden"},{"type":"plain","text":" , and we locked up "},{"type":"inlineCode","text":"\u003chtml\u003e"},{"type":"plain","text":" and "},{"type":"inlineCode","text":"\u003cbody\u003e"},{"type":"plain","text":" for good."}]},{"type":"paragraph","children":[{"type":"plain","text":"The next step is to give the scroller "},{"type":"inlineCode","text":"overflow: scroll"},{"type":"plain","text":". Now when you scroll the viewport, "},{"type":"inlineCode","text":"\u003chtml\u003e"},{"type":"plain","text":" and "},{"type":"inlineCode","text":"\u003cbody\u003e"},{"type":"plain","text":" don't move at all, only the scroller is scrolling, and the URL bar will not hide. Notice that if there are any container elements between the scroller and the body, their overflow values also need to be "},{"type":"inlineCode","text":"hidden"},{"type":"plain","text":"."}]},{"type":"code","lang":"css","text":"html {\n  height: 100vh;\n  overflow-y: hidden;\n}\n\nbody {\n  height: 100%;\n  overflow-y: hidden;\n}\n\n.scroller {\n  height: 100%;\n  overflow-y: scroll;\n}"},{"type":"paragraph","children":[{"type":"plain","text":"The visible area height should be consistent now, and we should get window height without too much trouble."}]},{"type":"heading","children":[{"type":"plain","text":"Smooth scrolling"}],"depth":2},{"type":"paragraph","children":[{"type":"inlineCode","text":".scrollTo"},{"type":"plain","text":" is initiative and efficient, but it's not very reliable. I've encountered scenarios that it wouldn't work (no effect at all). I haven't discovered the root cause, but it feels like "},{"type":"inlineCode","text":".scrollTo"},{"type":"plain","text":" gets canceled when called too frequently."}]},{"type":"paragraph","children":[{"type":"plain","text":"I gave up the one-liner and went for another approach: "},{"type":"link","text":"window.requestAnimationFrame","url":"https://developer.mozilla.org/en-US/docs/Web/API/window/requestAnimationFrame"},{"type":"plain","text":". This function prepares a frame to execute all the things inside the callback. This approach is inspired by "},{"type":"link","text":"vue-scrollto","url":"https://github.com/rigor789/vue-scrollto"},{"type":"plain","text":"."}]},{"type":"paragraph","children":[{"type":"plain","text":"The callback has a single argument timestamp: "},{"type":"inlineCode","text":"DOMHighResTimeStamp"},{"type":"plain","text":", which is essentially a number. When scroll animation starts, save the initial timestamp and then compare the timestamp in each call with the initial timestamp to determine if the elapsed time has exceeded the designated scroll animation duration. If the scroll is not finished yet, call "},{"type":"inlineCode","text":"window.requestAnimationFrame"},{"type":"plain","text":" inside the callback recursively."}]},{"type":"paragraph","children":[{"type":"plain","text":"For the scroll effect, set the scroller's scrollTop directly."}]},{"type":"paragraph","children":[{"type":"inlineCode","text":"scroller.scrollTop = {the y position after each scroll step}"}]},{"type":"paragraph","children":[{"type":"inlineCode","text":"scroll-behavior: \"smooth\""},{"type":"plain","text":" doesn't apply when changing a div's "},{"type":"inlineCode","text":"scrollTop"},{"type":"plain","text":" value in this way; this is why we need to use "},{"type":"inlineCode","text":"requestAnimationFrame"},{"type":"plain","text":" to create an animation."}]},{"type":"code","lang":"js","text":"let scrollDuration;\nlet scrollDirection; // 1 or -1\nlet scrollStartTime;\nlet scroller;\nlet currentY;\nlet scrollDistance; // window height, likely 100vh\nlet isScrolling;\n\nconst scrollTo = (timestamp: DOMHighResTimeStamp) =\u003e {\n  if (!scrollStartTime) {\n    scrollStartTime = timestamp;\n  }\n\n  const elapsedTime = timestamp - scrollStartTime;\n  const progress = Math.min(elapsedTime / scrollDuration, 1);\n  scroller.scrollTop = currentY + scrollDistance * progress * scrollDirection;\n\n\tif (elapsedTime \u003c duration) {\n    window.requestAnimationFrame(scrollTo);\n  } else {\n    currentY = scroller.scrollTop;\n    scrollStartTime = undefined;\n    scrollDirection = undefined;\n    isScrolling = false;\n  }\n};"},{"type":"heading","children":[{"type":"plain","text":"Remove the momentum"}],"depth":2},{"type":"paragraph","children":[{"type":"plain","text":"When the user scrolls the screen hence triggers the "},{"type":"inlineCode","text":"scroll"},{"type":"plain","text":" or "},{"type":"inlineCode","text":"touchmove"},{"type":"plain","text":" event, it's unlikely that the event only fires once. We can have the conditioning to prevent our full-screen scroll from repeatedly called, but the other scrolls caused by the user's finger remains, even after the full-screen scroll finishes. Removing the scroll momentum is the necessary polishing for the full-screen scroll effect."}]},{"type":"paragraph","children":[{"type":"plain","text":"There are two ways to disable scroll temporarily: "},{"type":"inlineCode","text":"pointerEvent: none"},{"type":"plain","text":", and —you might have guessed it— "},{"type":"inlineCode","text":"overflow: hidden"},{"type":"plain","text":". I found overflow more reliable, for "},{"type":"inlineCode","text":"pointerEvent"},{"type":"plain","text":" didn't work in some "},{"type":"inlineCode","text":"touchmove"},{"type":"plain","text":" scenario."}]},{"type":"paragraph","children":[{"type":"plain","text":"When the scroll starts (calling "},{"type":"inlineCode","text":"window.requestAnimationFrame"},{"type":"plain","text":" for the first time), add the above CSS property to the scroller element, and all the scrolls that after the first callback should take no effect. Thus we removed the momentum successfully."}]},{"type":"thematicBreak"},{"type":"paragraph","children":[{"type":"plain","text":"I finished the full-screen scroll effect with the above approach. It works fine in macOS, win, and mobile platforms. I believe there are other ways to do this, but I'm quite happy with the result I came up with."}]}],"postMetadata":{"id":"full-screen-scroll","title":"Full-Screen Scroll","description":"","category":"Web Development","language":["en-US"],"tags":[],"publishDate":"2021-02-11","pathname":"full-screen-scroll","zhTwLink":null,"filename":"Full-Screen Scroll (blog)"},"categoryList":{"Game Development":5,"Life":5,"Gaming":12,"League of Legends":8,"Meta":4,"Web Development":4,"HKT48":4,"Programming":3,"Movie":2},"last5posts":[{"id":"godot-essentials","title":"Godot Essentials","description":"The biggest lessons I learned in my first Godot project.","category":"Game Development","language":["en-US"],"tags":[],"publishDate":"2024-04-21","pathname":"godot-essentials","zhTwLink":null,"filename":"Godot Essentials (blog)"},{"id":"4-years-reflection","title":"4 Years Reflection","description":"Another two years of life as a full-time developer has passed. Many things changed and many lessons learned. It's a perfect timing to look back and reflect.","category":"Life","language":["en-US"],"tags":[],"publishDate":"2024-04-08","pathname":"4-years-reflection","zhTwLink":null,"filename":"4 Years Reflection (blog)"},{"id":"improving-greatness","title":"Improving Greatness","description":"Breath of the Wild is one of the most impactful game in last decade. Yet for its successor, Nintendo built an even more polished version on an already magnificent fundamental.","category":"Gaming","language":["en-US"],"tags":[],"publishDate":"2024-03-17","pathname":"improving-greatness","zhTwLink":null,"filename":"Improving Greatness (blog)"},{"id":"s13-recap","title":"S13 Recap","description":"After a three years gap, I'm back to league.","category":"League of Legends","language":["en-US"],"tags":[],"publishDate":"2024-01-23","pathname":"s13-recap","zhTwLink":null,"filename":"S13 Recap (blog)"},{"id":"refactor-blog-2023-markdown-based-content","title":"Refactor Blog 2023: Markdown Based Content","description":"Embracing a different approach toward my own data, I made a change to the content hosting method of my blog.","category":"Meta","language":["en-US"],"tags":[],"publishDate":"2023-06-19","pathname":"refactor-blog-2023-markdown-based-content","zhTwLink":null,"filename":"Refactor Blog 2023 - Markdown Based Content (blog)"}]},"__N_SSG":true},"page":"/blog/[pathname]","query":{"pathname":"full-screen-scroll"},"buildId":"Ct-zOyv_Ohd6ncbBqnMnN","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>