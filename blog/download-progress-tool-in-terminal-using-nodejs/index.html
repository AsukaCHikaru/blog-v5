<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width"><title>Download Progress Tool in Terminal Using Node.JS | Asuka Wang</title><meta name="description" content="Asuka Wang's blog"><meta property="og:title" content="Download Progress Tool in Terminal Using Node.JS | Asuka Wang"><meta property="twitter:title" content="Download Progress Tool in Terminal Using Node.JS | Asuka Wang"><meta name="next-head-count" content="6"><link rel="preload" href="/_next/static/css/8db452c70a1fa85d.css" as="style"><link rel="preload" as="font" type="font/woff2" crossorigin="anonymous" href="/subfont/Gentium_Plus-400-62b8f514fb.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin="anonymous" href="/subfont/Noto_Serif_JP_CJK-400-fbd1224a8d.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin="anonymous" href="/subfont/Noto_Serif_JP-400-10e25bcd0f.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin="anonymous" href="/subfont/Gentium_Plus_Book-700-47a76121c3.woff2"><link rel="stylesheet" href="/subfont/fonts-6e0e802984.css"><link rel="stylesheet" href="/_next/static/css/8db452c70a1fa85d.css" data-n-g=""><link rel="preload" href="/_next/static/css/0c1f2193a64e20b6.css" as="style"><link rel="stylesheet" href="/_next/static/css/0c1f2193a64e20b6.css" data-n-p=""><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-b8f8d6679aaa5f42.js" defer=""></script><script src="/_next/static/chunks/framework-114634acb84f8baa.js" defer=""></script><script src="/_next/static/chunks/main-f2ca60db2beb93ed.js" defer=""></script><script src="/_next/static/chunks/pages/_app-be51c38591acb686.js" defer=""></script><script src="/_next/static/chunks/542-7be5b5539309fe0b.js" defer=""></script><script src="/_next/static/chunks/210-68d59f6259c1734d.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5Bpathname%5D-3bf5f7f615781b02.js" defer=""></script><script src="/_next/static/mNBmNpj4_6w1yX4RC8S-S/_buildManifest.js" defer=""></script><script src="/_next/static/mNBmNpj4_6w1yX4RC8S-S/_ssgManifest.js" defer=""></script></head><body><div id="__next"><main><div class="text-color Layout_container__S4aNf" data-is-menu-open="false"><div class="SiteHeader_container__8tKwA" data-is-menu-open="false"><div class="SiteHeader_nav-container__oEq2d"><div class="SiteHeader_section-container__tAKnZ"><a class="SiteHeader_section-link__9DmFE interactive-color text-color" href="/blog/">blog</a><a class="SiteHeader_section-link__9DmFE interactive-color " href="/about/">about</a><a target="_blank" class="SiteHeader_section-link__9DmFE interactive-color" href="/blog/feed.xml">rss</a></div><button class="SiteHeader_menu-button__eK9ND">menu</button><a class="SiteHeader_publication-folio___ZFZS text-color" href="/">ASUKA WANG</a></div><div class="SiteHeader_divider__cq_R_ border-color-100"></div><div class="SiteHeader_menu-wrapper__2evr7"></div></div><div class="Layout_full-content__MQIxS"><div class="PostDetailPageHeader_container__fcMw9"><div class="Layout_main-content__mr9_2"><h1 class="PostDetailPageHeader_title__YwZEK">Download Progress Tool in Terminal Using Node.JS</h1><div class="PostDetailPageHeader_publish-date__pMF22">June 7, 2019</div></div></div></div><div class="Layout_main-content__mr9_2"><div class="PostBodyBlock_wrapper__wRxJc"><h2 class="PostBodyBlock_h2__z8Iri" id="tl;dr:">TL;DR:</h2></div><div class="PostBodyBlock_wrapper__wRxJc"><ul class="PostBodyBlock_ul__QtcuL"><li><code class="PostBodyBlock_inline-code__TAzYM">fs.stat</code> for getting file size</li><li><code class="PostBodyBlock_inline-code__TAzYM">readline.clearLine</code></li><li><code class="PostBodyBlock_inline-code__TAzYM">readline.cursorTo(0)</code></li><li><code class="PostBodyBlock_inline-code__TAzYM">process.stdout.write</code></li></ul></div><div class="PostBodyBlock_wrapper__wRxJc">Combine these 3 to update command line instead of printing new line</div><div class="PostBodyBlock_wrapper__wRxJc"><h2 class="PostBodyBlock_h2__z8Iri" id="get-file-size">Get file size</h2></div><div class="PostBodyBlock_wrapper__wRxJc"><code class="PostBodyBlock_inline-code__TAzYM">fs.stat</code>&nbsp;returns an object contains several stats of the file from url you're downloading.</div><div class="PostBodyBlock_wrapper__wRxJc"><a href="https://nodejs.org/api/fs.html#fs_class_fs_stats" class="PostBodyBlock_link__faaEN" rel="noreferrer noopener" target="_blank">Detailed explanation of fs.stat</a>.</div><div class="PostBodyBlock_wrapper__wRxJc">Inside of the object, there is&nbsp;<code class="PostBodyBlock_inline-code__TAzYM">size</code>&nbsp;property, which is obviously the size of file, in bytes.</div><div class="PostBodyBlock_wrapper__wRxJc"><pre class="CodeBlock_block__wRht1"><code class="CodeBlock_code__1aD9x language-js">let fileSize = 0;
fs.stat("url/to/your/file", (stats) =&gt; {
  fileSize = stats.size;
});</code></pre></div><div class="PostBodyBlock_wrapper__wRxJc"><h2 class="PostBodyBlock_h2__z8Iri" id="get-current-progression">Get current progression</h2></div><div class="PostBodyBlock_wrapper__wRxJc">In the response from&nbsp;<code class="PostBodyBlock_inline-code__TAzYM">https.get</code>&nbsp;when downloading, track and add up the total length of chunks piped into&nbsp;<code class="PostBodyBlock_inline-code__TAzYM">fs.writeStream</code>. This total length devided by file size is the download progression we need.</div><div class="PostBodyBlock_wrapper__wRxJc"><h2 class="PostBodyBlock_h2__z8Iri" id="write-to-terminal--but-in-same-line">Write to terminal, but in same line</h2></div><div class="PostBodyBlock_wrapper__wRxJc"><code class="PostBodyBlock_inline-code__TAzYM">console.log</code>&nbsp;<a href="https://nodejs.org/docs/v0.3.1/api/process.html#process.stdout" class="PostBodyBlock_link__faaEN" rel="noreferrer noopener" target="_blank">implementation</a>&nbsp;in Node is actually based on&nbsp;<code class="PostBodyBlock_inline-code__TAzYM">process.stdout.write</code>. But since there's a&nbsp;<code class="PostBodyBlock_inline-code__TAzYM">\\n</code>&nbsp;at end of every&nbsp;<code class="PostBodyBlock_inline-code__TAzYM">console.log</code>, new line is printed everytime instead of being updated. Therefore we can't use&nbsp;<code class="PostBodyBlock_inline-code__TAzYM">console.log</code></div><div class="PostBodyBlock_wrapper__wRxJc">By combine&nbsp;<code class="PostBodyBlock_inline-code__TAzYM">readline.clearLine</code>&nbsp;and&nbsp;<code class="PostBodyBlock_inline-code__TAzYM">readline.cursorTo(0)</code>, terminal will erase the last line of currently printed line, then move cursor to the starting position. Then we can use&nbsp;<code class="PostBodyBlock_inline-code__TAzYM">process.stdout.write</code>&nbsp;to print out current progress without&nbsp;<code class="PostBodyBlock_inline-code__TAzYM">\\n</code>&nbsp;in&nbsp;<code class="PostBodyBlock_inline-code__TAzYM">console.log</code>&nbsp;implementation that causes changing line.</div><div class="PostBodyBlock_wrapper__wRxJc"><pre class="CodeBlock_block__wRht1"><code class="CodeBlock_code__1aD9x language-js">let progress = 0;
let req = https.get("url/to/your/file", (res, err) =&gt; {
  res.on("data", (chunk) =&gt; {
    progress += chunk.length;
    const dlPercentage = ((progress / fileSize) * 100).toFixed(2);
    readline.clearLine();
    readline.cursorTo(0);
    process.stdout.write(`Downloading... ${dlPercentage}%`);
  });
});</code></pre></div><div class="PostDetailPage_additional-list-container__b_oHL"><div class="AdditionalPostList_container__ucjfo"><div class="AdditionalPostList_category-link__EDTWa">More from<a href="/blog/archive/?category=Programming">Programming</a></div><div class="AdditionalPostList_card-list__jz3F_"><a class="AdditionalPostList_card__doJcw" href="/blog/a-rather-easy-way-to-implement-quicksort-in-js/"><div><div class="AdditionalPostList_card-title__FDhSX">A Rather Easy Way to Implement Quicksort in JavaScript</div><div class="AdditionalPostList_card-description__Enc8v">My attempt to implement quicksort.</div></div><div class="AdditionalPostList_card-publish-date__Jvdgm">May 23, 2019</div></a></div></div><div class="AdditionalPostList_container__ucjfo"><a class="AdditionalPostList_archive-link__7Q6ys" href="/blog/archive/">Archive</a><div class="AdditionalPostList_card-list__jz3F_"><a class="AdditionalPostList_card__doJcw" href="/blog/a-redemption-three-years-later/"><div><div class="AdditionalPostList_card-title__FDhSX">A Redemption Three Years Later</div><div class="AdditionalPostList_card-description__Enc8v">CD PROJECT RED made a promise about Night City, which they broke. Three years later they had another attempt, and to me, it was their redemption.</div></div><div class="AdditionalPostList_card-publish-date__Jvdgm">January 13, 2025</div></a><a class="AdditionalPostList_card__doJcw" href="/blog/s14-recap/"><div><div class="AdditionalPostList_card-title__FDhSX">S14 Recap</div><div class="AdditionalPostList_card-description__Enc8v">I did not play a lot of league during 2024, but I had a few unforgettable moments nonetheless.</div></div><div class="AdditionalPostList_card-publish-date__Jvdgm">January 7, 2025</div></a><a class="AdditionalPostList_card__doJcw" href="/blog/thoughts-on-building-a-game-with-xstate/"><div><div class="AdditionalPostList_card-title__FDhSX">Thoughts on Building a Game with XState</div><div class="AdditionalPostList_card-description__Enc8v">After hearing about XState's good reputation for years, I used it to build the prototype for my game. These are my thoughts.</div></div><div class="AdditionalPostList_card-publish-date__Jvdgm">January 4, 2025</div></a><a class="AdditionalPostList_card__doJcw" href="/blog/under-the-hood-diablo-ii-item-generation/"><div><div class="AdditionalPostList_card-title__FDhSX">Under the Hood: Diablo II Item Generation</div><div class="AdditionalPostList_card-description__Enc8v">A system design research turned into a reconciliation with a game I didn't know I was so in love with, so I wrote a research note to express my appreciation.</div></div><div class="AdditionalPostList_card-publish-date__Jvdgm">November 8, 2024</div></a><a class="AdditionalPostList_card__doJcw" href="/blog/site-patch-notes-2024-redesign/"><div><div class="AdditionalPostList_card-title__FDhSX">Site Patch Notes: 2024 Redesign</div><div class="AdditionalPostList_card-description__Enc8v">The 2024 redesign is finally here! I went on a journey of learning editorial design, and did an overhaul to this site's design, both functionality-wise and visual-wise.</div></div><div class="AdditionalPostList_card-publish-date__Jvdgm">August 18, 2024</div></a></div></div></div></div><div class="Layout_right-panel__zSn4t"><div class="TableOfContentColumn_container__0tmUV"><ul class="TableOfContentColumn_ul__7wuVs interactive-list-color"><li class="TableOfContentColumn_li__FUe4z"><button role="link" class="TableOfContentColumn_link__5qS3c">TL;DR:</button></li><li class="TableOfContentColumn_li__FUe4z"><button role="link" class="TableOfContentColumn_link__5qS3c">Get file size</button></li><li class="TableOfContentColumn_li__FUe4z"><button role="link" class="TableOfContentColumn_link__5qS3c">Get current progression</button></li><li class="TableOfContentColumn_li__FUe4z"><button role="link" class="TableOfContentColumn_link__5qS3c">Write to terminal, but in same line</button></li></ul></div></div><div class="SiteFooter_container__0v6cR border-color"><a href="https://asukawang.com" rel="noopener noreferrer" target="_blank" class="SiteFooter_link__RuMSe interactive-color">asukawang.com 2018-</a></div></div></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postContent":[{"type":"heading","children":[{"type":"plain","text":"TL;DR:"}],"depth":1},{"type":"list","ordered":false,"children":[{"type":"listItem","children":[{"type":"inlineCode","text":"fs.stat"},{"type":"plain","text":" for getting file size"}]},{"type":"listItem","children":[{"type":"inlineCode","text":"readline.clearLine"}]},{"type":"listItem","children":[{"type":"inlineCode","text":"readline.cursorTo(0)"}]},{"type":"listItem","children":[{"type":"inlineCode","text":"process.stdout.write"}]}]},{"type":"paragraph","children":[{"type":"plain","text":"Combine these 3 to update command line instead of printing new line"}]},{"type":"heading","children":[{"type":"plain","text":"Get file size"}],"depth":1},{"type":"paragraph","children":[{"type":"inlineCode","text":"fs.stat"},{"type":"plain","text":" returns an object contains several stats of the file from url you're downloading."}]},{"type":"paragraph","children":[{"type":"link","text":"Detailed explanation of fs.stat","url":"https://nodejs.org/api/fs.html#fs_class_fs_stats"},{"type":"plain","text":"."}]},{"type":"paragraph","children":[{"type":"plain","text":"Inside of the object, there is "},{"type":"inlineCode","text":"size"},{"type":"plain","text":" property, which is obviously the size of file, in bytes."}]},{"type":"code","lang":"js","text":"let fileSize = 0;\nfs.stat(\"url/to/your/file\", (stats) =\u003e {\n  fileSize = stats.size;\n});"},{"type":"heading","children":[{"type":"plain","text":"Get current progression"}],"depth":1},{"type":"paragraph","children":[{"type":"plain","text":"In the response from "},{"type":"inlineCode","text":"https.get"},{"type":"plain","text":" when downloading, track and add up the total length of chunks piped into "},{"type":"inlineCode","text":"fs.writeStream"},{"type":"plain","text":". This total length devided by file size is the download progression we need."}]},{"type":"heading","children":[{"type":"plain","text":"Write to terminal, but in same line"}],"depth":1},{"type":"paragraph","children":[{"type":"inlineCode","text":"console.log"},{"type":"plain","text":" "},{"type":"link","text":"implementation","url":"https://nodejs.org/docs/v0.3.1/api/process.html#process.stdout"},{"type":"plain","text":" in Node is actually based on "},{"type":"inlineCode","text":"process.stdout.write"},{"type":"plain","text":". But since there's a "},{"type":"inlineCode","text":"\\\\n"},{"type":"plain","text":" at end of every "},{"type":"inlineCode","text":"console.log"},{"type":"plain","text":", new line is printed everytime instead of being updated. Therefore we can't use "},{"type":"inlineCode","text":"console.log"}]},{"type":"paragraph","children":[{"type":"plain","text":"By combine "},{"type":"inlineCode","text":"readline.clearLine"},{"type":"plain","text":" and "},{"type":"inlineCode","text":"readline.cursorTo(0)"},{"type":"plain","text":", terminal will erase the last line of currently printed line, then move cursor to the starting position. Then we can use "},{"type":"inlineCode","text":"process.stdout.write"},{"type":"plain","text":" to print out current progress without "},{"type":"inlineCode","text":"\\\\n"},{"type":"plain","text":" in "},{"type":"inlineCode","text":"console.log"},{"type":"plain","text":" implementation that causes changing line."}]},{"type":"code","lang":"js","text":"let progress = 0;\nlet req = https.get(\"url/to/your/file\", (res, err) =\u003e {\n  res.on(\"data\", (chunk) =\u003e {\n    progress += chunk.length;\n    const dlPercentage = ((progress / fileSize) * 100).toFixed(2);\n    readline.clearLine();\n    readline.cursorTo(0);\n    process.stdout.write(`Downloading... ${dlPercentage}%`);\n  });\n});"}],"postMetadata":{"id":"download-progress-tool-in-terminal-using-nodejs","title":"Download Progress Tool in Terminal Using Node.JS","description":"","category":"Programming","tags":[],"publishDate":"2019-06-07","pathname":"download-progress-tool-in-terminal-using-nodejs"},"last5posts":[{"id":"a-redemption-three-years-later","title":"A Redemption Three Years Later","description":"CD PROJECT RED made a promise about Night City, which they broke. Three years later they had another attempt, and to me, it was their redemption.","category":"Gaming","tags":[],"publishDate":"2025-01-13","pathname":"a-redemption-three-years-later"},{"id":"s14-recap","title":"S14 Recap","description":"I did not play a lot of league during 2024, but I had a few unforgettable moments nonetheless.","category":"League of Legends","tags":[],"publishDate":"2025-01-07","pathname":"s14-recap"},{"id":"thoughts-on-building-a-game-with-xstate","title":"Thoughts on Building a Game with XState","description":"After hearing about XState's good reputation for years, I used it to build the prototype for my game. These are my thoughts.","category":"Game Development","tags":[],"publishDate":"2025-01-04","pathname":"thoughts-on-building-a-game-with-xstate"},{"id":"under-the-hood-diablo-ii-item-generation","title":"Under the Hood: Diablo II Item Generation","description":"A system design research turned into a reconciliation with a game I didn't know I was so in love with, so I wrote a research note to express my appreciation.","category":"Game Development","tags":[],"publishDate":"2024-11-08","pathname":"under-the-hood-diablo-ii-item-generation"},{"id":"site-patch-notes-2024-redesign","title":"Site Patch Notes: 2024 Redesign","description":"The 2024 redesign is finally here! I went on a journey of learning editorial design, and did an overhaul to this site's design, both functionality-wise and visual-wise.","category":"Meta","tags":[],"publishDate":"2024-08-18","pathname":"site-patch-notes-2024-redesign"}],"categoryPosts":[{"id":"a-rather-easy-way-to-implement-quicksort-in-js","title":"A Rather Easy Way to Implement Quicksort in JavaScript","description":"My attempt to implement quicksort.","category":"Programming","tags":[],"publishDate":"2019-05-23","pathname":"a-rather-easy-way-to-implement-quicksort-in-js"}],"categories":[{"name":"Gaming","count":13},{"name":"League of Legends","count":9},{"name":"Game Development","count":7},{"name":"Meta","count":5},{"name":"Life","count":6},{"name":"Web Development","count":4},{"name":"HKT48","count":4},{"name":"Programming","count":3},{"name":"Movie","count":2}]},"__N_SSG":true},"page":"/blog/[pathname]","query":{"pathname":"download-progress-tool-in-terminal-using-nodejs"},"buildId":"mNBmNpj4_6w1yX4RC8S-S","isFallback":false,"gsp":true,"scriptLoader":[]}</script><script>(function(){var el=document.createElement('link');el.href='/subfont/fallback-1f9f028477.css';el.rel='stylesheet';document.body.appendChild(el)}())</script><noscript><link rel="stylesheet" href="/subfont/fallback-1f9f028477.css"></noscript></body></html>