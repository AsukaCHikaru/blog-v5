<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>Refactor Blog: (2) SSR | The work is undone.</title><meta name="description" content="asukachikaru&#x27;s blog"/><meta property="og:title" content="Refactor Blog: (2) SSR | The work is undone."/><meta property="twitter:title" content="Refactor Blog: (2) SSR | The work is undone."/><meta name="next-head-count" content="6"/><link rel="preload" href="/blog-v5/_next/static/css/259239e739d7771b.css" as="style"/><link rel="stylesheet" href="/blog-v5/_next/static/css/259239e739d7771b.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/blog-v5/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/blog-v5/_next/static/chunks/webpack-8cffa0c9b644b115.js" defer=""></script><script src="/blog-v5/_next/static/chunks/framework-114634acb84f8baa.js" defer=""></script><script src="/blog-v5/_next/static/chunks/main-1383b5636e70c1aa.js" defer=""></script><script src="/blog-v5/_next/static/chunks/pages/_app-891652dd44e1e4e1.js" defer=""></script><script src="/blog-v5/_next/static/chunks/851-9acd1ec9a820dfa8.js" defer=""></script><script src="/blog-v5/_next/static/chunks/pages/post/%5Bpathname%5D-8eabb2d195eb2bdc.js" defer=""></script><script src="/blog-v5/_next/static/oBuLsNVlKeyUIVLQulplq/_buildManifest.js" defer=""></script><script src="/blog-v5/_next/static/oBuLsNVlKeyUIVLQulplq/_ssgManifest.js" defer=""></script></head><link rel="preload" href="/fonts/NotoSerifJP-Regular.woff2" as="font" type="font/woff2"/><body><div id="__next"><div class="max-w-3xl mx-auto"><div class="mt-8 mb-4"><h1 class="mb-2 text-6xl font-semibold">Refactor Blog: (2) SSR</h1><div class="text-xl"><span class="inline-block h-6 leading-6 mr-2 pr-2 border-r border-r-foreground dark:border-r-background">Mar. 26, 2021</span><span class="mr-2 text-lg"><a href="/blog-v5/tag/TypeScript/">#<!-- -->TypeScript</a></span><span class="mr-2 text-lg"><a href="/blog-v5/tag/JavaScript/">#<!-- -->JavaScript</a></span><span class="mr-2 text-lg"><a href="/blog-v5/tag/ReactJS/">#<!-- -->ReactJS</a></span><span class="mr-2 text-lg"><a href="/blog-v5/tag/HTML/">#<!-- -->HTML</a></span></div></div><div class="mb-2 text-lg"><p><span>One of the reasons I choose Gatsby last time I wrote my blog site is to have SSR. SEO matters, isn&#x27;t it?</span></p></div><div class="mb-2 text-lg"><p><span>I gained experience setting up SSR in my job, and this is how I apply that experience in my project.</span></p></div><div class="mb-2 text-lg"><h2 class="mt-6 text-3xl">The Idea</h2></div><div class="mb-2 text-lg"><p><span>First, let&#x27;s talk about React (and most of the MVVM frameworks) app without SSR. They are an HTML template with a js file. Everything about the app is in the js file; the HTML is merely a host for the app.</span></p></div><div class="mb-2 text-lg"><p><span>When the user&#x27;s browser requests data of the app from the server, the HTML is provided. A blank HTML page with some metadata is rendered.</span></p></div><div class="mb-2 text-lg"><p><span>Then the HTML requests the data of the js file from the </span><code class="px-1 font-courier text-red-500 bg-gray-700 rounded-sm">&lt;script&gt;</code><span> tag. The js file is fetched then executed. The logic inside starts working. Then the app is created and attached to a specific HTML element.</span></p></div><div class="mb-2 text-lg"><p><span>The problem is that search engines can&#x27;t observe the actual app in the first render. Therefore, for the search engines, the app is always a blank page.</span></p></div><div class="mb-2 text-lg"><p><span>The solution is SSR -- server-side rendering. When the app is requested, the server runs the app, prints them into strings, then sends them with the HTML. For the browsers or the search engines, they get the whole app in the first render.</span></p></div><div class="mb-2 text-lg"><h2 class="mt-6 text-3xl">Dependencies</h2></div><div class="mb-2 text-lg"><ul class="list-disc list-inside"><li><a class="text-blue-400 underline" href="http://expressjs.com/" rel="noreferrer noopener" target="_blank">express</a><span> for handling requests and responses</span></li></ul></div><div class="mb-2 text-lg"><h2 class="mt-6 text-3xl">Setting up the server</h2></div><div class="mb-2 text-lg"><p><span>Receive requests and send HTML. The HTML will be a string instead of a file for inserting stringified app.</span></p></div><div class="mb-2 text-lg"><pre class="px-1 bg-gray-700 whitespace-pre-wrap rounded-sm"><code class="font-courier">import * as Express from &quot;express&quot;;

const APP_PORT = process.env.PORT || 3000;
const app = Express();
const renderer = () =&gt; {
	app.get(&quot;*&quot;, (req: Express.Request, res: Express.Response) =&gt; {
		res.send(`
			&lt;!DOCTYPE HTML&gt;
			&lt;html&gt;
				&lt;head&gt;
					&lt;!-- insert metadata here --&gt;
				&lt;/head&gt;
				&lt;body&gt;
					&lt;div id=&quot;app-root&quot;&gt;&lt;/div&gt;
				&lt;/body&gt;
			&lt;/html&gt;
		`);
	});
};

app.use(renderer);
app.listen(APP_PORT, () =&gt; {
	console.log(`Server is listening on ${APP_PORT}`);
});</code></pre></div><div class="mb-2 text-lg"><h2 class="mt-6 text-3xl">Library setups</h2></div><div class="mb-2 text-lg"><p><span>I&#x27;m only using the major libraries for this app. Fortunately, some of them provide APIs for SSR setup. The common idea of libraries&#x27; SSR setup is getting the stringified part of each library from their API, then passing them into the HTML template.</span></p></div><div class="mb-2 text-lg"><h3 class="mt-6 text-2xl">React</h3></div><div class="mb-2 text-lg"><p><a class="text-blue-400 underline" href="https://reactjs.org/docs/react-dom-server.html#gatsby-focus-wrapper" rel="noreferrer noopener" target="_blank">Document</a></p></div><div class="mb-2 text-lg"><p><span>React&#x27;s API for SSR is </span><code class="px-1 font-courier text-red-500 bg-gray-700 rounded-sm">ReactDOMServer.renderToString(element)</code><span>. Pass the app in JSX format as the element parameter.</span></p></div><div class="mb-2 text-lg"><pre class="px-1 bg-gray-700 whitespace-pre-wrap rounded-sm"><code class="font-courier">import * as React from &quot;react&quot;;
import * as ReactDOMServer from &quot;react-dom/server&quot;;

import { App } from &quot;../client/App&quot;;

let htmlBody;

try {
	htmlBody = ReactDOMServer.renderToString(&lt;App /&gt;);
} catch(error) {
	console.error(error);
}</code></pre></div><div class="mb-2 text-lg"><h3 class="mt-6 text-2xl">React Helmet</h3></div><div class="mb-2 text-lg"><p><a class="text-blue-400 underline" href="https://github.com/nfl/react-helmet#server-usage" rel="noreferrer noopener" target="_blank">Document</a></p></div><div class="mb-2 text-lg"><p><span>Helmet&#x27;s API for SSR is </span><code class="px-1 font-courier text-red-500 bg-gray-700 rounded-sm">Helmet.renderStatic()</code><span>. You have to call it after </span><code class="px-1 font-courier text-red-500 bg-gray-700 rounded-sm">ReactDOMServer.renderToString</code><span>.</span></p></div><div class="mb-2 text-lg"><pre class="px-1 bg-gray-700 whitespace-pre-wrap rounded-sm"><code class="font-courier">import { Helmet } from &quot;react-helmet&quot;;

let htmlBody;
let helmet;

try {
	htmlBody = ReactDOMServer.renderToString(&lt;App /&gt;);
	helmet = Helmet.renderStatic();
} catch(error) {
	console.error(error);
}</code></pre></div><div class="mb-2 text-lg"><h3 class="mt-6 text-2xl">React Router DOM</h3></div><div class="mb-2 text-lg"><p><a class="text-blue-400 underline" href="https://reactrouter.com/web/guides/server-rendering" rel="noreferrer noopener" target="_blank">Document</a></p></div><div class="mb-2 text-lg"><p><span>Wrap the app with a </span><code class="px-1 font-courier text-red-500 bg-gray-700 rounded-sm">StaticRouter</code><span>.</span></p></div><div class="mb-2 text-lg"><pre class="px-1 bg-gray-700 whitespace-pre-wrap rounded-sm"><code class="font-courier">import { StaticRouter } from &quot;react-router-dom&quot;;

let htmlBody;
let context;

app.get(&quot;*&quot;, (req: Express.Request, res: Express.Response) =&gt; {
	try {
		htmlBody = ReactDOMServer.renderToString(
			&lt;StaticRouter location={req.url} context={context}&gt;
				&lt;App /&gt;
			&lt;/StaticRouter&gt;
		);
	} catch(error) {
		console.error(error);
	}
};</code></pre></div><div class="mb-2 text-lg"><h3 class="mt-6 text-2xl">styled-components</h3></div><div class="mb-2 text-lg"><p><a class="text-blue-400 underline" href="https://styled-components.com/docs/advanced#server-side-rendering" rel="noreferrer noopener" target="_blank">Document</a></p></div><div class="mb-2 text-lg"><p><span>Use </span><code class="px-1 font-courier text-red-500 bg-gray-700 rounded-sm">sheet.collectStyles</code><span> to wrap the app, then use </span><code class="px-1 font-courier text-red-500 bg-gray-700 rounded-sm">sheet.getStyleTags</code><span> to collect all of the app&#x27;s styles.</span></p></div><div class="mb-2 text-lg"><p><span>Finally, pass the styles into the HTML&#x27;s head.</span></p></div><div class="mb-2 text-lg"><pre class="px-1 bg-gray-700 whitespace-pre-wrap rounded-sm"><code class="font-courier">import { ServerStyleSheet } from &quot;styled-components&quot;;

const sheet = new ServerStyleSheet();
let htmlBody = &quot;&quot;;
let styleTags = &quot;&quot;;

try {
	htmlBody = ReactDOMServer.renderToString(
		sheet.collectStyles(
			&lt;App /&gt;
		)
	);
	styleTags = sheet.getStyleTags();
} catch (error) {
	console.error(error);
} finally {
	sheet.seal();
}</code></pre></div><div class="mb-2 text-lg"><h3 class="mt-6 text-2xl">Redux</h3></div><div class="mb-2 text-lg"><p><a class="text-blue-400 underline" href="https://redux.js.org/recipes/server-rendering" rel="noreferrer noopener" target="_blank">Document</a></p></div><div class="mb-2 text-lg"><p><span>Redux&#x27;s SSR setup is the most complex one. The contents of the store have to be prepared and passed to the HTML during the request.</span></p></div><div class="mb-2 text-lg"><p><span>The way to prepare the store is different for each application. For my blog, I fetch the post or the post list data for the respective request URL, then convert the data to the store type.</span></p></div><div class="mb-2 text-lg"><p><span>Once the store is prepared, wrap the app with a </span><code class="px-1 font-courier text-red-500 bg-gray-700 rounded-sm">Provider</code><span>, and get the </span><code class="px-1 font-courier text-red-500 bg-gray-700 rounded-sm">initialState</code><span> with the API Redux provided.</span></p></div><div class="mb-2 text-lg"><pre class="px-1 bg-gray-700 whitespace-pre-wrap rounded-sm"><code class="font-courier">import { createStore } from &quot;redux&quot;;
import { Provider } from &quot;react-redux&quot;;

import { rootReducer, RootState } from &quot;../client/service/reducer&quot;;

app.get(&quot;*&quot;, (req: Express.Request, res: Express.Response) =&gt; {
	// pass request because store is likely dependent on request URL
	const yourStore = yourStoreInitiator(req);
	const preloadedStore: RootState = {
		// your store state
	};
	
	let htmlBody = &quot;&quot;;
	const store = createStore(rootReducer, preloadedState);
	
	try {
		htmlBody = ReactDOMServer.renderToString(
			&lt;Provider store={store}&gt;
				&lt;App /&gt;
			&lt;/Provider&gt;
		);
	} catch (error) {
		console.error(error);
	}
	
	// store.getState() returns object so we have to manually stringify it
	const initialState = JSON.stringify(store.getState());
};</code></pre></div><div class="mb-2 text-lg"><h3 class="mt-6 text-2xl">HTML handler</h3></div><div class="mb-2 text-lg"><p><span>Since the HTML is frequently edited with several library parts, an isolated handler makes it easier.</span></p></div><div class="mb-2 text-lg"><pre class="px-1 bg-gray-700 whitespace-pre-wrap rounded-sm"><code class="font-courier">const getFullHTML = (
  htmlBody: string,
  styleTags: string,
  initialState: string,
  helmet?: HelmetData
) =&gt; {
  return `
    &lt;!DOCTYPE html&gt;
    &lt;html ${helmet?.htmlAttributes.toString()}&gt;
      &lt;head&gt;
        &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot;&gt;
        ${styleTags}
        ${helmet?.title.toString()}
        ${helmet?.meta.toString()}
        ${helmet?.link.toString()}
        &lt;style&gt;
          @import url(&#x27;https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@400;700;900&amp;display=swap&#x27;);
          @import url(&#x27;https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@100;400&amp;display=swap&#x27;);
        &lt;/style&gt;
      &lt;/head&gt;
      &lt;body ${helmet?.bodyAttributes.toString()}&gt;
        &lt;div id=&quot;app-root&quot;&gt;${htmlBody}&lt;/div&gt;
        &lt;script&gt;window.__INITIAL_STATE__ = ${initialState}&lt;/script&gt;
        &lt;script defer src=&quot;main.bundle.js&quot; type=&quot;text/javascript&quot; charset=&quot;utf-8&quot;&gt;&lt;/script&gt;
        &lt;script defer src=&quot;vendor.bundle.js&quot; type=&quot;text/javascript&quot; charset=&quot;utf-8&quot;&gt;&lt;/script&gt;
      &lt;/body&gt;
    &lt;/html&gt;
  `;
};</code></pre></div><div class="mb-2 text-lg"><h3 class="mt-6 text-2xl">Combine each part</h3></div><div class="mb-2 text-lg"><p><span>Finally, combine all of the setups above.</span></p></div><div class="mb-2 text-lg"><pre class="px-1 bg-gray-700 whitespace-pre-wrap rounded-sm"><code class="font-courier">import * as Express from &quot;express&quot;;
import * as React from &quot;react&quot;;
import * as ReactDOMServer from &quot;react-dom/server&quot;;
import { Helmet, HelmetData } from &quot;react-helmet&quot;;
import { Provider } from &quot;react-redux&quot;;
import { StaticRouter } from &quot;react-router-dom&quot;;
import { createStore } from &quot;redux&quot;;
import { ServerStyleSheet } from &quot;styled-components&quot;;

import { App } from &quot;../client/App&quot;;
import { rootReducer, RootState } from &quot;../client/service/reducer&quot;;

export const renderer = (
	req: Express.Request,
	res: Express.Response,
	next: Express.NextFunction,
) =&gt; {
	app.get(&quot;*&quot;, (req: Express.Request, res: Express.Response) =&gt; {
	const yourStore = yourStoreInitiator(req);
	const preloadedStore: RootState = { /* your state */ };
	
	let htmlBody = &quot;&quot;;
	const context = {};
  const sheet = new ServerStyleSheet();
  let styleTags = &quot;&quot;;
	const store = createStore(rootReducer, preloadedState);
	let helmet;
	
	try {
	  htmlBody = ReactDOMServer.renderToString(
      sheet.collectStyles(
        &lt;Provider store={store}&gt;
	        &lt;StaticRouter location={req.url} context={context}&gt;
            &lt;App /&gt;
	        &lt;/StaticRouter&gt;
        &lt;/Provider&gt;
      )
    );
    helmet = Helmet.renderStatic();
    styleTags = sheet.getStyleTags();
  } catch (error) {
    console.error(error);
  } finally {
    sheet.seal();
  }
  const initialState = JSON.stringify(store.getState());

  const fullHTML = getFullHTML(htmlBody, styleTags, initialState, helmet);
	res.send(fullHTML);
};</code></pre></div><div class="mb-2 text-lg"><p><span>You can use </span><code class="px-1 font-courier text-red-500 bg-gray-700 rounded-sm">curl -X GET localhost:3000</code><span>  to check if the express server is returning the whole app in the first easily.</span></p></div><div class="mt-5 mb-5 text-center"><a href="https://asukachikaru.com" rel="noopener noreferrer" target="_blank">asukachikaru.com</a> <!-- -->2018-</div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"list":{"object":"list","results":[{"object":"block","id":"b756bcd2-fee3-4895-bd4a-cc0736e07054","parent":{"type":"page_id","page_id":"dcded2c7-7701-4feb-b9ea-611166bbec33"},"created_time":"2021-03-08T08:24:00.000Z","last_edited_time":"2021-03-08T08:24:00.000Z","created_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"last_edited_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"color":"default","text":[{"type":"text","text":{"content":"One of the reasons I choose Gatsby last time I wrote my blog site is to have SSR. SEO matters, isn't it?","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"One of the reasons I choose Gatsby last time I wrote my blog site is to have SSR. SEO matters, isn't it?","href":null}]}},{"object":"block","id":"2f435c1c-62b9-4973-b347-9f83d564ea80","parent":{"type":"page_id","page_id":"dcded2c7-7701-4feb-b9ea-611166bbec33"},"created_time":"2021-03-08T08:24:00.000Z","last_edited_time":"2021-03-08T08:24:00.000Z","created_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"last_edited_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"color":"default","text":[{"type":"text","text":{"content":"I gained experience setting up SSR in my job, and this is how I apply that experience in my project.","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"I gained experience setting up SSR in my job, and this is how I apply that experience in my project.","href":null}]}},{"object":"block","id":"3425b781-7d62-4a09-998d-f9b7993378fd","parent":{"type":"page_id","page_id":"dcded2c7-7701-4feb-b9ea-611166bbec33"},"created_time":"2021-03-08T08:24:00.000Z","last_edited_time":"2021-03-08T08:24:00.000Z","created_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"last_edited_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"has_children":false,"archived":false,"type":"heading_1","heading_1":{"is_toggleable":false,"color":"default","text":[{"type":"text","text":{"content":"The Idea","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"The Idea","href":null}]}},{"object":"block","id":"82c70ce9-738f-4391-9488-76833f4b768e","parent":{"type":"page_id","page_id":"dcded2c7-7701-4feb-b9ea-611166bbec33"},"created_time":"2021-03-08T08:24:00.000Z","last_edited_time":"2021-03-08T08:24:00.000Z","created_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"last_edited_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"color":"default","text":[{"type":"text","text":{"content":"First, let's talk about React (and most of the MVVM frameworks) app without SSR. They are an HTML template with a js file. Everything about the app is in the js file; the HTML is merely a host for the app.","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"First, let's talk about React (and most of the MVVM frameworks) app without SSR. They are an HTML template with a js file. Everything about the app is in the js file; the HTML is merely a host for the app.","href":null}]}},{"object":"block","id":"edbdf3da-d88c-42a3-b6cc-a262217b33c7","parent":{"type":"page_id","page_id":"dcded2c7-7701-4feb-b9ea-611166bbec33"},"created_time":"2021-03-08T08:24:00.000Z","last_edited_time":"2021-03-08T08:24:00.000Z","created_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"last_edited_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"color":"default","text":[{"type":"text","text":{"content":"When the user's browser requests data of the app from the server, the HTML is provided. A blank HTML page with some metadata is rendered.","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"When the user's browser requests data of the app from the server, the HTML is provided. A blank HTML page with some metadata is rendered.","href":null}]}},{"object":"block","id":"ddc97b81-91f0-4d26-97df-633625261dea","parent":{"type":"page_id","page_id":"dcded2c7-7701-4feb-b9ea-611166bbec33"},"created_time":"2021-03-08T08:24:00.000Z","last_edited_time":"2021-03-08T08:25:00.000Z","created_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"last_edited_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"color":"default","text":[{"type":"text","text":{"content":"Then the HTML requests the data of the js file from the ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"Then the HTML requests the data of the js file from the ","href":null},{"type":"text","text":{"content":"\u003cscript\u003e","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"\u003cscript\u003e","href":null},{"type":"text","text":{"content":" tag. The js file is fetched then executed. The logic inside starts working. Then the app is created and attached to a specific HTML element.","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" tag. The js file is fetched then executed. The logic inside starts working. Then the app is created and attached to a specific HTML element.","href":null}]}},{"object":"block","id":"0ba43d45-d483-460e-8737-832f074146bd","parent":{"type":"page_id","page_id":"dcded2c7-7701-4feb-b9ea-611166bbec33"},"created_time":"2021-03-08T08:24:00.000Z","last_edited_time":"2021-03-08T08:24:00.000Z","created_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"last_edited_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"color":"default","text":[{"type":"text","text":{"content":"The problem is that search engines can't observe the actual app in the first render. Therefore, for the search engines, the app is always a blank page.","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"The problem is that search engines can't observe the actual app in the first render. Therefore, for the search engines, the app is always a blank page.","href":null}]}},{"object":"block","id":"03aba67b-3804-40a2-8296-a41ecd63be62","parent":{"type":"page_id","page_id":"dcded2c7-7701-4feb-b9ea-611166bbec33"},"created_time":"2021-03-08T08:24:00.000Z","last_edited_time":"2021-03-08T08:24:00.000Z","created_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"last_edited_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"color":"default","text":[{"type":"text","text":{"content":"The solution is SSR -- server-side rendering. When the app is requested, the server runs the app, prints them into strings, then sends them with the HTML. For the browsers or the search engines, they get the whole app in the first render.","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"The solution is SSR -- server-side rendering. When the app is requested, the server runs the app, prints them into strings, then sends them with the HTML. For the browsers or the search engines, they get the whole app in the first render.","href":null}]}},{"object":"block","id":"94b454c2-92d4-40d2-b2e7-82ac317989b6","parent":{"type":"page_id","page_id":"dcded2c7-7701-4feb-b9ea-611166bbec33"},"created_time":"2021-03-08T08:24:00.000Z","last_edited_time":"2021-03-08T08:24:00.000Z","created_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"last_edited_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"has_children":false,"archived":false,"type":"heading_1","heading_1":{"is_toggleable":false,"color":"default","text":[{"type":"text","text":{"content":"Dependencies","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"Dependencies","href":null}]}},{"object":"block","id":"4a4298b9-e174-4c0a-9e26-ae7ded41d22b","parent":{"type":"page_id","page_id":"dcded2c7-7701-4feb-b9ea-611166bbec33"},"created_time":"2021-03-08T08:24:00.000Z","last_edited_time":"2021-03-08T08:55:00.000Z","created_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"last_edited_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"has_children":false,"archived":false,"type":"bulleted_list_item","bulleted_list_item":{"color":"default","text":[{"type":"text","text":{"content":"express","link":{"url":"http://expressjs.com/"}},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"express","href":"http://expressjs.com/"},{"type":"text","text":{"content":" for handling requests and responses","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" for handling requests and responses","href":null}]}},{"object":"block","id":"9a39d6f6-c320-404a-b122-087fafebf286","parent":{"type":"page_id","page_id":"dcded2c7-7701-4feb-b9ea-611166bbec33"},"created_time":"2021-03-08T08:24:00.000Z","last_edited_time":"2021-03-08T08:24:00.000Z","created_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"last_edited_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"has_children":false,"archived":false,"type":"heading_1","heading_1":{"is_toggleable":false,"color":"default","text":[{"type":"text","text":{"content":"Setting up the server","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"Setting up the server","href":null}]}},{"object":"block","id":"27b2d38b-6489-4643-8ba1-9eee42fcbdd2","parent":{"type":"page_id","page_id":"dcded2c7-7701-4feb-b9ea-611166bbec33"},"created_time":"2021-03-08T08:24:00.000Z","last_edited_time":"2021-03-08T08:24:00.000Z","created_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"last_edited_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"color":"default","text":[{"type":"text","text":{"content":"Receive requests and send HTML. The HTML will be a string instead of a file for inserting stringified app.","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"Receive requests and send HTML. The HTML will be a string instead of a file for inserting stringified app.","href":null}]}},{"object":"block","id":"f6403c84-b8be-418f-a0a1-14f604f910fa","parent":{"type":"page_id","page_id":"dcded2c7-7701-4feb-b9ea-611166bbec33"},"created_time":"2021-03-08T08:24:00.000Z","last_edited_time":"2021-03-08T08:34:00.000Z","created_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"last_edited_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"has_children":false,"archived":false,"type":"code","code":{"caption":[],"language":"typescript","text":[{"type":"text","text":{"content":"import * as Express from \"express\";\n\nconst APP_PORT = process.env.PORT || 3000;\nconst app = Express();\nconst renderer = () =\u003e {\n\tapp.get(\"*\", (req: Express.Request, res: Express.Response) =\u003e {\n\t\tres.send(`\n\t\t\t\u003c!DOCTYPE HTML\u003e\n\t\t\t\u003chtml\u003e\n\t\t\t\t\u003chead\u003e\n\t\t\t\t\t\u003c!-- insert metadata here --\u003e\n\t\t\t\t\u003c/head\u003e\n\t\t\t\t\u003cbody\u003e\n\t\t\t\t\t\u003cdiv id=\"app-root\"\u003e\u003c/div\u003e\n\t\t\t\t\u003c/body\u003e\n\t\t\t\u003c/html\u003e\n\t\t`);\n\t});\n};\n\napp.use(renderer);\napp.listen(APP_PORT, () =\u003e {\n\tconsole.log(`Server is listening on ${APP_PORT}`);\n});","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"import * as Express from \"express\";\n\nconst APP_PORT = process.env.PORT || 3000;\nconst app = Express();\nconst renderer = () =\u003e {\n\tapp.get(\"*\", (req: Express.Request, res: Express.Response) =\u003e {\n\t\tres.send(`\n\t\t\t\u003c!DOCTYPE HTML\u003e\n\t\t\t\u003chtml\u003e\n\t\t\t\t\u003chead\u003e\n\t\t\t\t\t\u003c!-- insert metadata here --\u003e\n\t\t\t\t\u003c/head\u003e\n\t\t\t\t\u003cbody\u003e\n\t\t\t\t\t\u003cdiv id=\"app-root\"\u003e\u003c/div\u003e\n\t\t\t\t\u003c/body\u003e\n\t\t\t\u003c/html\u003e\n\t\t`);\n\t});\n};\n\napp.use(renderer);\napp.listen(APP_PORT, () =\u003e {\n\tconsole.log(`Server is listening on ${APP_PORT}`);\n});","href":null}]}},{"object":"block","id":"cb27844b-a8c5-446a-bd90-a7a54dea1652","parent":{"type":"page_id","page_id":"dcded2c7-7701-4feb-b9ea-611166bbec33"},"created_time":"2021-03-08T08:24:00.000Z","last_edited_time":"2021-03-08T08:25:00.000Z","created_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"last_edited_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"has_children":false,"archived":false,"type":"heading_1","heading_1":{"is_toggleable":false,"color":"default","text":[{"type":"text","text":{"content":"Library setups","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"Library setups","href":null}]}},{"object":"block","id":"6f13b4a7-13d8-4124-b1af-b46656b176e0","parent":{"type":"page_id","page_id":"dcded2c7-7701-4feb-b9ea-611166bbec33"},"created_time":"2021-03-08T08:24:00.000Z","last_edited_time":"2021-03-08T08:24:00.000Z","created_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"last_edited_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"color":"default","text":[{"type":"text","text":{"content":"I'm only using the major libraries for this app. Fortunately, some of them provide APIs for SSR setup. The common idea of libraries' SSR setup is getting the stringified part of each library from their API, then passing them into the HTML template.","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"I'm only using the major libraries for this app. Fortunately, some of them provide APIs for SSR setup. The common idea of libraries' SSR setup is getting the stringified part of each library from their API, then passing them into the HTML template.","href":null}]}},{"object":"block","id":"55485641-5fdc-4ec3-af54-abada4de4a30","parent":{"type":"page_id","page_id":"dcded2c7-7701-4feb-b9ea-611166bbec33"},"created_time":"2021-03-08T08:24:00.000Z","last_edited_time":"2021-03-08T08:25:00.000Z","created_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"last_edited_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"has_children":false,"archived":false,"type":"heading_2","heading_2":{"is_toggleable":false,"color":"default","text":[{"type":"text","text":{"content":"React","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"React","href":null}]}},{"object":"block","id":"2c2cb683-5f4a-4b94-88de-4c4238411620","parent":{"type":"page_id","page_id":"dcded2c7-7701-4feb-b9ea-611166bbec33"},"created_time":"2021-03-08T08:50:00.000Z","last_edited_time":"2021-03-08T08:50:00.000Z","created_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"last_edited_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"color":"default","text":[{"type":"text","text":{"content":"Document","link":{"url":"https://reactjs.org/docs/react-dom-server.html#gatsby-focus-wrapper"}},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"Document","href":"https://reactjs.org/docs/react-dom-server.html#gatsby-focus-wrapper"}]}},{"object":"block","id":"ec2c4412-b9ad-4032-a5c9-ebabb4c58e8f","parent":{"type":"page_id","page_id":"dcded2c7-7701-4feb-b9ea-611166bbec33"},"created_time":"2021-03-08T08:24:00.000Z","last_edited_time":"2021-03-08T08:25:00.000Z","created_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"last_edited_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"color":"default","text":[{"type":"text","text":{"content":"React's API for SSR is ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"React's API for SSR is ","href":null},{"type":"text","text":{"content":"ReactDOMServer.renderToString(element)","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"ReactDOMServer.renderToString(element)","href":null},{"type":"text","text":{"content":". Pass the app in JSX format as the element parameter.","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":". Pass the app in JSX format as the element parameter.","href":null}]}},{"object":"block","id":"eefec9a6-1f0a-4d01-ba65-22af7ef18d22","parent":{"type":"page_id","page_id":"dcded2c7-7701-4feb-b9ea-611166bbec33"},"created_time":"2021-03-08T08:25:00.000Z","last_edited_time":"2021-03-08T08:56:00.000Z","created_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"last_edited_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"has_children":false,"archived":false,"type":"code","code":{"caption":[],"language":"typescript","text":[{"type":"text","text":{"content":"import * as React from \"react\";\nimport * as ReactDOMServer from \"react-dom/server\";\n\nimport { App } from \"../client/App\";\n\nlet htmlBody;\n\ntry {\n\thtmlBody = ReactDOMServer.renderToString(\u003cApp /\u003e);\n} catch(error) {\n\tconsole.error(error);\n}","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"import * as React from \"react\";\nimport * as ReactDOMServer from \"react-dom/server\";\n\nimport { App } from \"../client/App\";\n\nlet htmlBody;\n\ntry {\n\thtmlBody = ReactDOMServer.renderToString(\u003cApp /\u003e);\n} catch(error) {\n\tconsole.error(error);\n}","href":null}]}},{"object":"block","id":"226eae2c-fc01-46cf-b322-a57666bac423","parent":{"type":"page_id","page_id":"dcded2c7-7701-4feb-b9ea-611166bbec33"},"created_time":"2021-03-08T08:24:00.000Z","last_edited_time":"2021-03-08T08:25:00.000Z","created_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"last_edited_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"has_children":false,"archived":false,"type":"heading_2","heading_2":{"is_toggleable":false,"color":"default","text":[{"type":"text","text":{"content":"React Helmet","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"React Helmet","href":null}]}},{"object":"block","id":"57256611-aaf2-4aef-8240-a60ca6920d81","parent":{"type":"page_id","page_id":"dcded2c7-7701-4feb-b9ea-611166bbec33"},"created_time":"2021-03-08T08:50:00.000Z","last_edited_time":"2021-03-08T08:50:00.000Z","created_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"last_edited_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"color":"default","text":[{"type":"text","text":{"content":"Document","link":{"url":"https://github.com/nfl/react-helmet#server-usage"}},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"Document","href":"https://github.com/nfl/react-helmet#server-usage"}]}},{"object":"block","id":"a01ee595-b753-444f-8aea-751abbeff9f9","parent":{"type":"page_id","page_id":"dcded2c7-7701-4feb-b9ea-611166bbec33"},"created_time":"2021-03-08T08:24:00.000Z","last_edited_time":"2021-03-08T08:26:00.000Z","created_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"last_edited_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"color":"default","text":[{"type":"text","text":{"content":"Helmet's API for SSR is ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"Helmet's API for SSR is ","href":null},{"type":"text","text":{"content":"Helmet.renderStatic()","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"Helmet.renderStatic()","href":null},{"type":"text","text":{"content":". You have to call it after ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":". You have to call it after ","href":null},{"type":"text","text":{"content":"ReactDOMServer.renderToString","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"ReactDOMServer.renderToString","href":null},{"type":"text","text":{"content":".","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":".","href":null}]}},{"object":"block","id":"bdaadee3-5eeb-472c-8f77-7e352db1c84d","parent":{"type":"page_id","page_id":"dcded2c7-7701-4feb-b9ea-611166bbec33"},"created_time":"2021-03-08T08:26:00.000Z","last_edited_time":"2021-03-08T08:56:00.000Z","created_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"last_edited_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"has_children":false,"archived":false,"type":"code","code":{"caption":[],"language":"typescript","text":[{"type":"text","text":{"content":"import { Helmet } from \"react-helmet\";\n\nlet htmlBody;\nlet helmet;\n\ntry {\n\thtmlBody = ReactDOMServer.renderToString(\u003cApp /\u003e);\n\thelmet = Helmet.renderStatic();\n} catch(error) {\n\tconsole.error(error);\n}","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"import { Helmet } from \"react-helmet\";\n\nlet htmlBody;\nlet helmet;\n\ntry {\n\thtmlBody = ReactDOMServer.renderToString(\u003cApp /\u003e);\n\thelmet = Helmet.renderStatic();\n} catch(error) {\n\tconsole.error(error);\n}","href":null}]}},{"object":"block","id":"4d1a56d4-875d-4a3b-b6c2-54b37178e05a","parent":{"type":"page_id","page_id":"dcded2c7-7701-4feb-b9ea-611166bbec33"},"created_time":"2021-03-08T08:24:00.000Z","last_edited_time":"2021-03-08T08:26:00.000Z","created_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"last_edited_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"has_children":false,"archived":false,"type":"heading_2","heading_2":{"is_toggleable":false,"color":"default","text":[{"type":"text","text":{"content":"React Router DOM","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"React Router DOM","href":null}]}},{"object":"block","id":"9cc3e9b3-94a4-4a93-9caa-4efd713e3db8","parent":{"type":"page_id","page_id":"dcded2c7-7701-4feb-b9ea-611166bbec33"},"created_time":"2021-03-08T08:50:00.000Z","last_edited_time":"2021-03-08T08:51:00.000Z","created_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"last_edited_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"color":"default","text":[{"type":"text","text":{"content":"Document","link":{"url":"https://reactrouter.com/web/guides/server-rendering"}},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"Document","href":"https://reactrouter.com/web/guides/server-rendering"}]}},{"object":"block","id":"ffc16dc0-975f-4d15-8358-f413cce98527","parent":{"type":"page_id","page_id":"dcded2c7-7701-4feb-b9ea-611166bbec33"},"created_time":"2021-03-08T08:24:00.000Z","last_edited_time":"2021-03-08T08:26:00.000Z","created_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"last_edited_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"color":"default","text":[{"type":"text","text":{"content":"Wrap the app with a ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"Wrap the app with a ","href":null},{"type":"text","text":{"content":"StaticRouter","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"StaticRouter","href":null},{"type":"text","text":{"content":".","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":".","href":null}]}},{"object":"block","id":"5e50e364-7761-4a63-b2e2-bb73ad70eef4","parent":{"type":"page_id","page_id":"dcded2c7-7701-4feb-b9ea-611166bbec33"},"created_time":"2021-03-08T08:26:00.000Z","last_edited_time":"2021-03-08T08:56:00.000Z","created_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"last_edited_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"has_children":false,"archived":false,"type":"code","code":{"caption":[],"language":"typescript","text":[{"type":"text","text":{"content":"import { StaticRouter } from \"react-router-dom\";\n\nlet htmlBody;\nlet context;\n\napp.get(\"*\", (req: Express.Request, res: Express.Response) =\u003e {\n\ttry {\n\t\thtmlBody = ReactDOMServer.renderToString(\n\t\t\t\u003cStaticRouter location={req.url} context={context}\u003e\n\t\t\t\t\u003cApp /\u003e\n\t\t\t\u003c/StaticRouter\u003e\n\t\t);\n\t} catch(error) {\n\t\tconsole.error(error);\n\t}\n};","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"import { StaticRouter } from \"react-router-dom\";\n\nlet htmlBody;\nlet context;\n\napp.get(\"*\", (req: Express.Request, res: Express.Response) =\u003e {\n\ttry {\n\t\thtmlBody = ReactDOMServer.renderToString(\n\t\t\t\u003cStaticRouter location={req.url} context={context}\u003e\n\t\t\t\t\u003cApp /\u003e\n\t\t\t\u003c/StaticRouter\u003e\n\t\t);\n\t} catch(error) {\n\t\tconsole.error(error);\n\t}\n};","href":null}]}},{"object":"block","id":"18162fcb-2a0f-4a3a-acc4-59af0b07f9f0","parent":{"type":"page_id","page_id":"dcded2c7-7701-4feb-b9ea-611166bbec33"},"created_time":"2021-03-08T08:24:00.000Z","last_edited_time":"2021-03-08T08:27:00.000Z","created_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"last_edited_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"has_children":false,"archived":false,"type":"heading_2","heading_2":{"is_toggleable":false,"color":"default","text":[{"type":"text","text":{"content":"styled-components","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"styled-components","href":null}]}},{"object":"block","id":"8009e26b-1376-4715-a2fb-59e0762da6de","parent":{"type":"page_id","page_id":"dcded2c7-7701-4feb-b9ea-611166bbec33"},"created_time":"2021-03-08T08:51:00.000Z","last_edited_time":"2021-03-08T08:51:00.000Z","created_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"last_edited_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"color":"default","text":[{"type":"text","text":{"content":"Document","link":{"url":"https://styled-components.com/docs/advanced#server-side-rendering"}},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"Document","href":"https://styled-components.com/docs/advanced#server-side-rendering"}]}},{"object":"block","id":"e967e185-b0e5-409b-87de-0949d83ef2f9","parent":{"type":"page_id","page_id":"dcded2c7-7701-4feb-b9ea-611166bbec33"},"created_time":"2021-03-08T08:24:00.000Z","last_edited_time":"2021-03-08T08:27:00.000Z","created_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"last_edited_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"color":"default","text":[{"type":"text","text":{"content":"Use ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"Use ","href":null},{"type":"text","text":{"content":"sheet.collectStyles","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"sheet.collectStyles","href":null},{"type":"text","text":{"content":" to wrap the app, then use ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" to wrap the app, then use ","href":null},{"type":"text","text":{"content":"sheet.getStyleTags","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"sheet.getStyleTags","href":null},{"type":"text","text":{"content":" to collect all of the app's styles.","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" to collect all of the app's styles.","href":null}]}},{"object":"block","id":"68e7216d-f75d-4295-9e32-f27a22ddd9a9","parent":{"type":"page_id","page_id":"dcded2c7-7701-4feb-b9ea-611166bbec33"},"created_time":"2021-03-08T08:24:00.000Z","last_edited_time":"2021-03-08T08:24:00.000Z","created_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"last_edited_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"color":"default","text":[{"type":"text","text":{"content":"Finally, pass the styles into the HTML's head.","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"Finally, pass the styles into the HTML's head.","href":null}]}},{"object":"block","id":"5427156f-2504-4b32-a560-a05c8642774f","parent":{"type":"page_id","page_id":"dcded2c7-7701-4feb-b9ea-611166bbec33"},"created_time":"2021-03-08T08:27:00.000Z","last_edited_time":"2021-03-08T08:56:00.000Z","created_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"last_edited_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"has_children":false,"archived":false,"type":"code","code":{"caption":[],"language":"typescript","text":[{"type":"text","text":{"content":"import { ServerStyleSheet } from \"styled-components\";\n\nconst sheet = new ServerStyleSheet();\nlet htmlBody = \"\";\nlet styleTags = \"\";\n\ntry {\n\thtmlBody = ReactDOMServer.renderToString(\n\t\tsheet.collectStyles(\n\t\t\t\u003cApp /\u003e\n\t\t)\n\t);\n\tstyleTags = sheet.getStyleTags();\n} catch (error) {\n\tconsole.error(error);\n} finally {\n\tsheet.seal();\n}","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"import { ServerStyleSheet } from \"styled-components\";\n\nconst sheet = new ServerStyleSheet();\nlet htmlBody = \"\";\nlet styleTags = \"\";\n\ntry {\n\thtmlBody = ReactDOMServer.renderToString(\n\t\tsheet.collectStyles(\n\t\t\t\u003cApp /\u003e\n\t\t)\n\t);\n\tstyleTags = sheet.getStyleTags();\n} catch (error) {\n\tconsole.error(error);\n} finally {\n\tsheet.seal();\n}","href":null}]}},{"object":"block","id":"e08b34f6-ae56-4f6c-ac21-4e7f6090d4fd","parent":{"type":"page_id","page_id":"dcded2c7-7701-4feb-b9ea-611166bbec33"},"created_time":"2021-03-08T08:29:00.000Z","last_edited_time":"2021-03-08T08:29:00.000Z","created_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"last_edited_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"has_children":false,"archived":false,"type":"heading_2","heading_2":{"is_toggleable":false,"color":"default","text":[{"type":"text","text":{"content":"Redux","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"Redux","href":null}]}},{"object":"block","id":"997a7913-928d-4e36-98ad-3527968eebc7","parent":{"type":"page_id","page_id":"dcded2c7-7701-4feb-b9ea-611166bbec33"},"created_time":"2021-03-08T08:51:00.000Z","last_edited_time":"2021-03-08T08:51:00.000Z","created_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"last_edited_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"color":"default","text":[{"type":"text","text":{"content":"Document","link":{"url":"https://redux.js.org/recipes/server-rendering"}},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"Document","href":"https://redux.js.org/recipes/server-rendering"}]}},{"object":"block","id":"20a63bd8-64da-479d-a069-1fc5ea11d26e","parent":{"type":"page_id","page_id":"dcded2c7-7701-4feb-b9ea-611166bbec33"},"created_time":"2021-03-08T08:24:00.000Z","last_edited_time":"2021-03-08T08:29:00.000Z","created_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"last_edited_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"color":"default","text":[{"type":"text","text":{"content":"Redux's SSR setup is the most complex one. The contents of the store have to be prepared and passed to the HTML during the request.","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"Redux's SSR setup is the most complex one. The contents of the store have to be prepared and passed to the HTML during the request.","href":null}]}},{"object":"block","id":"b27f1616-f5ec-4e48-9911-9ea57a60eead","parent":{"type":"page_id","page_id":"dcded2c7-7701-4feb-b9ea-611166bbec33"},"created_time":"2021-03-08T08:24:00.000Z","last_edited_time":"2021-03-08T08:24:00.000Z","created_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"last_edited_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"color":"default","text":[{"type":"text","text":{"content":"The way to prepare the store is different for each application. For my blog, I fetch the post or the post list data for the respective request URL, then convert the data to the store type.","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"The way to prepare the store is different for each application. For my blog, I fetch the post or the post list data for the respective request URL, then convert the data to the store type.","href":null}]}},{"object":"block","id":"ef7fadd8-d451-4ad5-a8fb-0782c870f23f","parent":{"type":"page_id","page_id":"dcded2c7-7701-4feb-b9ea-611166bbec33"},"created_time":"2021-03-08T08:24:00.000Z","last_edited_time":"2021-03-08T08:36:00.000Z","created_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"last_edited_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"color":"default","text":[{"type":"text","text":{"content":"Once the store is prepared, wrap the app with a ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"Once the store is prepared, wrap the app with a ","href":null},{"type":"text","text":{"content":"Provider","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"Provider","href":null},{"type":"text","text":{"content":", and get the ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":", and get the ","href":null},{"type":"text","text":{"content":"initialState","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"initialState","href":null},{"type":"text","text":{"content":" with the API Redux provided.","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":" with the API Redux provided.","href":null}]}},{"object":"block","id":"6e514dab-2c54-4447-b672-455171bb054c","parent":{"type":"page_id","page_id":"dcded2c7-7701-4feb-b9ea-611166bbec33"},"created_time":"2021-03-08T08:29:00.000Z","last_edited_time":"2021-03-08T08:41:00.000Z","created_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"last_edited_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"has_children":false,"archived":false,"type":"code","code":{"caption":[],"language":"typescript","text":[{"type":"text","text":{"content":"import { createStore } from \"redux\";\nimport { Provider } from \"react-redux\";\n\nimport { rootReducer, RootState } from \"../client/service/reducer\";\n\napp.get(\"*\", (req: Express.Request, res: Express.Response) =\u003e {\n\t// pass request because store is likely dependent on request URL\n\tconst yourStore = yourStoreInitiator(req);\n\tconst preloadedStore: RootState = {\n\t\t// your store state\n\t};\n\t\n\tlet htmlBody = \"\";\n\tconst store = createStore(rootReducer, preloadedState);\n\t\n\ttry {\n\t\thtmlBody = ReactDOMServer.renderToString(\n\t\t\t\u003cProvider store={store}\u003e\n\t\t\t\t\u003cApp /\u003e\n\t\t\t\u003c/Provider\u003e\n\t\t);\n\t} catch (error) {\n\t\tconsole.error(error);\n\t}\n\t\n\t// store.getState() returns object so we have to manually stringify it\n\tconst initialState = JSON.stringify(store.getState());\n};","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"import { createStore } from \"redux\";\nimport { Provider } from \"react-redux\";\n\nimport { rootReducer, RootState } from \"../client/service/reducer\";\n\napp.get(\"*\", (req: Express.Request, res: Express.Response) =\u003e {\n\t// pass request because store is likely dependent on request URL\n\tconst yourStore = yourStoreInitiator(req);\n\tconst preloadedStore: RootState = {\n\t\t// your store state\n\t};\n\t\n\tlet htmlBody = \"\";\n\tconst store = createStore(rootReducer, preloadedState);\n\t\n\ttry {\n\t\thtmlBody = ReactDOMServer.renderToString(\n\t\t\t\u003cProvider store={store}\u003e\n\t\t\t\t\u003cApp /\u003e\n\t\t\t\u003c/Provider\u003e\n\t\t);\n\t} catch (error) {\n\t\tconsole.error(error);\n\t}\n\t\n\t// store.getState() returns object so we have to manually stringify it\n\tconst initialState = JSON.stringify(store.getState());\n};","href":null}]}},{"object":"block","id":"78400d53-273e-4e64-ac10-785d62ae4c90","parent":{"type":"page_id","page_id":"dcded2c7-7701-4feb-b9ea-611166bbec33"},"created_time":"2021-03-08T08:24:00.000Z","last_edited_time":"2021-03-08T08:49:00.000Z","created_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"last_edited_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"has_children":false,"archived":false,"type":"heading_2","heading_2":{"is_toggleable":false,"color":"default","text":[{"type":"text","text":{"content":"HTML handler","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"HTML handler","href":null}]}},{"object":"block","id":"da2ebbda-64f2-4deb-a8ca-cd620e861d4b","parent":{"type":"page_id","page_id":"dcded2c7-7701-4feb-b9ea-611166bbec33"},"created_time":"2021-03-08T08:24:00.000Z","last_edited_time":"2021-03-08T08:24:00.000Z","created_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"last_edited_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"color":"default","text":[{"type":"text","text":{"content":"Since the HTML is frequently edited with several library parts, an isolated handler makes it easier.","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"Since the HTML is frequently edited with several library parts, an isolated handler makes it easier.","href":null}]}},{"object":"block","id":"b8310396-2f85-453b-8d0f-4d84ca652e75","parent":{"type":"page_id","page_id":"dcded2c7-7701-4feb-b9ea-611166bbec33"},"created_time":"2021-03-08T08:24:00.000Z","last_edited_time":"2021-03-08T08:31:00.000Z","created_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"last_edited_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"has_children":false,"archived":false,"type":"code","code":{"caption":[],"language":"typescript","text":[{"type":"text","text":{"content":"const getFullHTML = (\n  htmlBody: string,\n  styleTags: string,\n  initialState: string,\n  helmet?: HelmetData\n) =\u003e {\n  return `\n    \u003c!DOCTYPE html\u003e\n    \u003chtml ${helmet?.htmlAttributes.toString()}\u003e\n      \u003chead\u003e\n        \u003cmeta name=\"viewport\" content=\"width=device-width, initial-scale=1\"\u003e\n        ${styleTags}\n        ${helmet?.title.toString()}\n        ${helmet?.meta.toString()}\n        ${helmet?.link.toString()}\n        \u003cstyle\u003e\n          @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@400;700;900\u0026display=swap');\n          @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@100;400\u0026display=swap');\n        \u003c/style\u003e\n      \u003c/head\u003e\n      \u003cbody ${helmet?.bodyAttributes.toString()}\u003e\n        \u003cdiv id=\"app-root\"\u003e${htmlBody}\u003c/div\u003e\n        \u003cscript\u003ewindow.__INITIAL_STATE__ = ${initialState}\u003c/script\u003e\n        \u003cscript defer src=\"main.bundle.js\" type=\"text/javascript\" charset=\"utf-8\"\u003e\u003c/script\u003e\n        \u003cscript defer src=\"vendor.bundle.js\" type=\"text/javascript\" charset=\"utf-8\"\u003e\u003c/script\u003e\n      \u003c/body\u003e\n    \u003c/html\u003e\n  `;\n};","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"const getFullHTML = (\n  htmlBody: string,\n  styleTags: string,\n  initialState: string,\n  helmet?: HelmetData\n) =\u003e {\n  return `\n    \u003c!DOCTYPE html\u003e\n    \u003chtml ${helmet?.htmlAttributes.toString()}\u003e\n      \u003chead\u003e\n        \u003cmeta name=\"viewport\" content=\"width=device-width, initial-scale=1\"\u003e\n        ${styleTags}\n        ${helmet?.title.toString()}\n        ${helmet?.meta.toString()}\n        ${helmet?.link.toString()}\n        \u003cstyle\u003e\n          @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@400;700;900\u0026display=swap');\n          @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@100;400\u0026display=swap');\n        \u003c/style\u003e\n      \u003c/head\u003e\n      \u003cbody ${helmet?.bodyAttributes.toString()}\u003e\n        \u003cdiv id=\"app-root\"\u003e${htmlBody}\u003c/div\u003e\n        \u003cscript\u003ewindow.__INITIAL_STATE__ = ${initialState}\u003c/script\u003e\n        \u003cscript defer src=\"main.bundle.js\" type=\"text/javascript\" charset=\"utf-8\"\u003e\u003c/script\u003e\n        \u003cscript defer src=\"vendor.bundle.js\" type=\"text/javascript\" charset=\"utf-8\"\u003e\u003c/script\u003e\n      \u003c/body\u003e\n    \u003c/html\u003e\n  `;\n};","href":null}]}},{"object":"block","id":"a1bc50c3-f9ba-47fb-92e2-b5cbf70b4ed3","parent":{"type":"page_id","page_id":"dcded2c7-7701-4feb-b9ea-611166bbec33"},"created_time":"2021-03-08T08:24:00.000Z","last_edited_time":"2021-03-08T08:31:00.000Z","created_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"last_edited_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"has_children":false,"archived":false,"type":"heading_2","heading_2":{"is_toggleable":false,"color":"default","text":[{"type":"text","text":{"content":"Combine each part","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"Combine each part","href":null}]}},{"object":"block","id":"124fec1d-2195-4ccb-a594-ed2ea67982d5","parent":{"type":"page_id","page_id":"dcded2c7-7701-4feb-b9ea-611166bbec33"},"created_time":"2021-03-08T08:24:00.000Z","last_edited_time":"2021-03-08T08:24:00.000Z","created_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"last_edited_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"color":"default","text":[{"type":"text","text":{"content":"Finally, combine all of the setups above.","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"Finally, combine all of the setups above.","href":null}]}},{"object":"block","id":"f9b0a8bd-c6d5-41d5-8088-83c78e0d3567","parent":{"type":"page_id","page_id":"dcded2c7-7701-4feb-b9ea-611166bbec33"},"created_time":"2021-03-08T08:24:00.000Z","last_edited_time":"2021-03-08T08:49:00.000Z","created_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"last_edited_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"has_children":false,"archived":false,"type":"code","code":{"caption":[],"language":"typescript","text":[{"type":"text","text":{"content":"import * as Express from \"express\";\nimport * as React from \"react\";\nimport * as ReactDOMServer from \"react-dom/server\";\nimport { Helmet, HelmetData } from \"react-helmet\";\nimport { Provider } from \"react-redux\";\nimport { StaticRouter } from \"react-router-dom\";\nimport { createStore } from \"redux\";\nimport { ServerStyleSheet } from \"styled-components\";\n\nimport { App } from \"../client/App\";\nimport { rootReducer, RootState } from \"../client/service/reducer\";\n\nexport const renderer = (\n\treq: Express.Request,\n\tres: Express.Response,\n\tnext: Express.NextFunction,\n) =\u003e {\n\tapp.get(\"*\", (req: Express.Request, res: Express.Response) =\u003e {\n\tconst yourStore = yourStoreInitiator(req);\n\tconst preloadedStore: RootState = { /* your state */ };\n\t\n\tlet htmlBody = \"\";\n\tconst context = {};\n  const sheet = new ServerStyleSheet();\n  let styleTags = \"\";\n\tconst store = createStore(rootReducer, preloadedState);\n\tlet helmet;\n\t\n\ttry {\n\t  htmlBody = ReactDOMServer.renderToString(\n      sheet.collectStyles(\n        \u003cProvider store={store}\u003e\n\t        \u003cStaticRouter location={req.url} context={context}\u003e\n            \u003cApp /\u003e\n\t        \u003c/StaticRouter\u003e\n        \u003c/Provider\u003e\n      )\n    );\n    helmet = Helmet.renderStatic();\n    styleTags = sheet.getStyleTags();\n  } catch (error) {\n    console.error(error);\n  } finally {\n    sheet.seal();\n  }\n  const initialState = JSON.stringify(store.getState());\n\n  const fullHTML = getFullHTML(htmlBody, styleTags, initialState, helmet);\n\tres.send(fullHTML);\n};","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"import * as Express from \"express\";\nimport * as React from \"react\";\nimport * as ReactDOMServer from \"react-dom/server\";\nimport { Helmet, HelmetData } from \"react-helmet\";\nimport { Provider } from \"react-redux\";\nimport { StaticRouter } from \"react-router-dom\";\nimport { createStore } from \"redux\";\nimport { ServerStyleSheet } from \"styled-components\";\n\nimport { App } from \"../client/App\";\nimport { rootReducer, RootState } from \"../client/service/reducer\";\n\nexport const renderer = (\n\treq: Express.Request,\n\tres: Express.Response,\n\tnext: Express.NextFunction,\n) =\u003e {\n\tapp.get(\"*\", (req: Express.Request, res: Express.Response) =\u003e {\n\tconst yourStore = yourStoreInitiator(req);\n\tconst preloadedStore: RootState = { /* your state */ };\n\t\n\tlet htmlBody = \"\";\n\tconst context = {};\n  const sheet = new ServerStyleSheet();\n  let styleTags = \"\";\n\tconst store = createStore(rootReducer, preloadedState);\n\tlet helmet;\n\t\n\ttry {\n\t  htmlBody = ReactDOMServer.renderToString(\n      sheet.collectStyles(\n        \u003cProvider store={store}\u003e\n\t        \u003cStaticRouter location={req.url} context={context}\u003e\n            \u003cApp /\u003e\n\t        \u003c/StaticRouter\u003e\n        \u003c/Provider\u003e\n      )\n    );\n    helmet = Helmet.renderStatic();\n    styleTags = sheet.getStyleTags();\n  } catch (error) {\n    console.error(error);\n  } finally {\n    sheet.seal();\n  }\n  const initialState = JSON.stringify(store.getState());\n\n  const fullHTML = getFullHTML(htmlBody, styleTags, initialState, helmet);\n\tres.send(fullHTML);\n};","href":null}]}},{"object":"block","id":"f9d43600-db7e-455c-97b7-f91c19e0ee48","parent":{"type":"page_id","page_id":"dcded2c7-7701-4feb-b9ea-611166bbec33"},"created_time":"2021-03-08T08:51:00.000Z","last_edited_time":"2021-03-08T08:54:00.000Z","created_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"last_edited_by":{"object":"user","id":"63312095-c98b-48c5-9a66-1cfd309ed6bd"},"has_children":false,"archived":false,"type":"paragraph","paragraph":{"color":"default","text":[{"type":"text","text":{"content":"You can use ","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"You can use ","href":null},{"type":"text","text":{"content":"curl -X GET localhost:3000","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":true,"color":"default"},"plain_text":"curl -X GET localhost:3000","href":null},{"type":"text","text":{"content":"  to check if the express server is returning the whole app in the first easily.","link":null},"annotations":{"bold":false,"italic":false,"strikethrough":false,"underline":false,"code":false,"color":"default"},"plain_text":"  to check if the express server is returning the whole app in the first easily.","href":null}]}}],"next_cursor":null,"has_more":false},"postSummary":{"id":"dcded2c7-7701-4feb-b9ea-611166bbec33","title":"Refactor Blog: (2) SSR","category":"programming","language":["enUS"],"tags":["TypeScript","JavaScript","ReactJS","HTML"],"publishDate":"2021-03-26","pathname":"refactor-blog-2-ssr","zhTwLink":null}},"__N_SSG":true},"page":"/post/[pathname]","query":{"pathname":"refactor-blog-2-ssr"},"buildId":"oBuLsNVlKeyUIVLQulplq","assetPrefix":"/blog-v5","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>